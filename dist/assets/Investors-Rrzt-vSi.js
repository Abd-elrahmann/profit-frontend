import{j as e,D as ce,y as de,T as s,I as H,z as Ye,E as xe,P as U,B as d,_ as te,F as he,d as w,a3 as Ie,a4 as Se,a7 as ie,r as u,e as P,a8 as Ge,n as $,h as E,A as _,a1 as h,a as m,$ as Qe,C as ee,G as Ve,K as oe,V as K,X as je,L as Je,N as Ze,O as et,Q,R as S,U as tt,W as rt,a6 as at,a9 as nt,aa as st,ab as ye}from"./index-2TEkS4Tk.js";import{F as ot,l as it}from"./lodash-CxsAddGS.js";import{D as ve}from"./DeleteModal-CWdUgVUc.js";import{P as Ce,C as lt,F as ct}from"./FileSaver.min-Pkg9k45W.js";import{A as Pe,S as dt}from"./Search-Be34rJ9a.js";import{I as xt}from"./InputAdornment-BbJSv7Lk.js";import{C as V,a as J}from"./CardContent-DkLJ4Reg.js";import{E as ht}from"./Edit-DJkzKNbs.js";import{S as ut}from"./Save-ue_qOb6O.js";import{T as pt,a as Z}from"./Tabs-BxNyk1aI.js";import"./LastPage-TR1pquDU.js";import"./KeyboardArrowRight-D-ZOxJ7W.js";const ft=({open:r,onClose:x,contractHtml:g,onGeneratePDF:n,loading:b=!1,contractTitle:p="معاينة العقد"})=>e.jsxs(ce,{open:r,onClose:x,maxWidth:"sm",fullScreen:!0,fullWidth:!0,dir:"rtl",PaperProps:{sx:{borderRadius:2,maxHeight:"100vh"}},children:[e.jsxs(de,{className:"no-print",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1,borderBottom:"1px solid #e0e0e0","@media print":{display:"none !important"}},children:[e.jsx(s,{variant:"h6",fontWeight:"bold",children:p}),e.jsx(H,{onClick:x,size:"small",children:e.jsx(Ye,{})})]}),e.jsx(xe,{sx:{p:0,"@media print":{p:0,m:0}},children:e.jsx(U,{id:"contract-preview",sx:{m:3,p:4,minHeight:"500px",bgcolor:"white",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",border:"1px solid #e0e0e0","@media print":{m:0,p:2,boxShadow:"none",border:"none",minHeight:"auto"}},children:g?e.jsx(d,{dangerouslySetInnerHTML:{__html:g},sx:{"& *":{fontFamily:'"Noto Sans Arabic", "Cairo", "Segoe UI", sans-serif !important',lineHeight:1.8},"& h1, & h2, & h3":{textAlign:"center",color:"#1976d2",marginBottom:"20px"},"& p":{marginBottom:"15px",textAlign:"justify"},"& strong":{color:"#1976d2",fontWeight:"bold"}}}):e.jsxs(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px",flexDirection:"column",color:"text.secondary"},children:[e.jsx(s,{variant:"h6",mb:2,children:"لا يوجد محتوى للعرض"}),e.jsx(s,{variant:"body2",children:"يرجى التأكد من وجود قالب العقد وبيانات المستثمر"})]})})}),e.jsx(te,{className:"no-print"}),e.jsxs(he,{className:"no-print",sx:{p:3,gap:2,flexDirection:"row-reverse",bgcolor:"#fafafa","@media print":{display:"none !important"}},children:[e.jsx(w,{onClick:x,disabled:b,variant:"outlined",sx:{minWidth:"100px",borderColor:"grey.300",color:"text.secondary","&:hover":{borderColor:"grey.400",bgcolor:"grey.50"}},children:"إغلاق"}),e.jsx(w,{variant:"outlined",startIcon:e.jsx(Ie,{sx:{marginLeft:"10px"}}),onClick:()=>window.print(),disabled:b||!g,sx:{minWidth:"120px",borderColor:"#1976d2",color:"#1976d2","&:hover":{borderColor:"#1565c0",bgcolor:"#e3f2fd"}},children:"طباعة"}),e.jsx(w,{variant:"contained",startIcon:e.jsx(Se,{sx:{marginLeft:"10px"}}),onClick:n,disabled:b||!g,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},minWidth:"140px"},children:b?"جاري الحفظ...":"حفظ كـ PDF"})]})]}),le=r=>{const x=["","واحد","اثنان","ثلاثة","أربعة","خمسة","ستة","سبعة","ثمانية","تسعة"],g=["","","عشرون","ثلاثون","أربعون","خمسون","ستون","سبعون","ثمانون","تسعون"],n=["عشرة","أحد عشر","اثنا عشر","ثلاثة عشر","أربعة عشر","خمسة عشر","ستة عشر","سبعة عشر","ثمانية عشر","تسعة عشر"],b=["","مائة","مائتان","ثلاثمائة","أربعمائة","خمسمائة","ستمائة","سبعمائة","ثمانمائة","تسعمائة"];if(r===0)return"صفر";if(r<0)return"سالب "+le(-r);let p="";if(r>=1e3){const a=Math.floor(r/1e3);a===1?p+="ألف":a===2?p+="ألفان":a<11?p+=x[a]+" آلاف":p+=le(a)+" ألف",r%=1e3,r>0?p+=" و ":p+=" "}if(r>=100){const a=Math.floor(r/100);p+=b[a],r%=100,r>0&&(p+=" و ")}if(r>=20){const a=Math.floor(r/10),f=r%10;p+=g[a],f>0&&(p+=" و"+x[f])}else r>=10?p+=n[r-10]:r>0&&(p+=x[r]);return p.trim()},gt=()=>{const r=new Date,x=r.toLocaleDateString("ar-SA"),g=Math.floor((r.getFullYear()-622)*1.030684)+1,n=`${r.getDate()}/${r.getMonth()+1}/${g}`;return{gregorianDate:x,hijriDate:n}},mt=ie.forwardRef(({investorData:r,templateContent:x,onContractGenerated:g,contractType:n="MUDARABAH"},b)=>{const[p,a]=u.useState(!1),[f,L]=u.useState(""),[T,z]=u.useState(!1),k=u.useCallback(async()=>{if(!r||!x){P("بيانات المستثمر أو قالب العقد غير متوفر");return}try{console.log("Investor Data:",r),console.log("Template Content:",x);const{gregorianDate:o,hijriDate:j}=gt(),y=le(r.capitalAmount);console.log("Capital in words:",y),console.log("Dates:",{gregorianDate:o,hijriDate:j});let A=x.replace(/{{اسم_العميل}}/g,r.name||"").replace(/{{رقم_هوية_العميل}}/g,r.nationalId||"").replace(/{{عنوان_العميل}}/g,r.address||"").replace(/{{هاتف_العميل}}/g,r.phone||"").replace(/{{بريد_العميل}}/g,r.email||"").replace(/{{رأس_المال}}/g,r.capitalAmount?.toLocaleString("ar-SA")||"0").replace(/{{رأس_المال_كتابة}}/g,y).replace(/{{المبلغ_رقما}}/g,r.capitalAmount?.toLocaleString("ar-SA")||"0").replace(/{{المبلغ_كتابة}}/g,y).replace(/{{نسبة_أرباح_المنشأة}}/g,String(r.orgProfitPercent||"0")).replace(/{{نسبة_أرباح_المستثمر}}/g,String(r.partnerProfitPercent||"0")).replace(/{{التاريخ_الهجري}}/g,j).replace(/{{التاريخ_الميلادي}}/g,o).replace(/{{تاريخ_العقد_هجري}}/g,j).replace(/{{تاريخ_العقد_ميلادي}}/g,o).replace(/{{اسم_رب_المال}}/g,r.name||"").replace(/{{هوية_رب_المال}}/g,r.nationalId||"").replace(/{{عنوان_رب_المال}}/g,r.address||"").replace(/{{اسم_المضارب_1}}/g,"ربيش سالم ناصر الهمامي").replace(/{{هوية_المضارب_1}}/g,"1116369545").replace(/{{عنوان_المضارب_1}}/g,"المملكة العربية السعودية - شرورة").replace(/{{اسم_المضارب_2}}/g,"مبارك سالم ناصر الهمامي").replace(/{{هوية_المضارب_2}}/g,"1116369511").replace(/{{عنوان_المضارب_2}}/g,"المملكة العربية السعودية - شرورة").replace(/{{مدينة_العقد}}/g,"الرياض").replace(/{{اسم_الدائن}}/g,r.name||"").replace(/{{اسم_المدين}}/g,r.name||"").replace(/{{رقم_السند}}/g,`${Date.now()}`).replace(/{{تاريخ_الانشاء}}/g,o).replace(/{{تاريخ_الاستحقاق}}/g,o).replace(/{{مدينة_الاصدار}}/g,"الرياض").replace(/{{مدينة_الوفاء}}/g,"الرياض").replace(/{{سبب_انشاء_السند}}/g,"استثمار في المضاربة").replace(/{{قيمة_السند_رقما}}/g,r.capitalAmount?.toLocaleString()||"0").replace(/{{قيمة_السند_كتابة}}/g,y);console.log("Filled Template:",A),L(A),a(!0)}catch(o){console.error("Error generating contract:",o),P("حدث خطأ أثناء توليد العقد")}},[r,x]),D=u.useCallback(async()=>{if(!f){P("لا يوجد محتوى عقد لتحويله إلى PDF");return}z(!0);try{const o=document.getElementById("contract-preview");if(!o)throw new Error("عنصر معاينة العقد غير موجود");const j={margin:[5,5,5,5],filename:`mudarabah_contract_${Date.now()}.pdf`,image:{type:"jpeg",quality:1},html2canvas:{scale:3,useCORS:!0,letterRendering:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff"},jsPDF:{unit:"mm",format:"a4",orientation:"portrait",compress:!1,hotfixes:["px_scaling"]}},y=await Ge().from(o).set(j).outputPdf("blob");await W(y),$("تم إنشاء وحفظ العقد بنجاح"),a(!1),g&&g(y)}catch(o){console.error("Error generating PDF:",o),P("حدث خطأ أثناء إنشاء ملف PDF"),E(o)}finally{z(!1)}},[f,r,g]),W=async o=>{try{const j=new FormData;return j.append("file",o,`mudarabah_contract_${Date.now()}.pdf`),j.append("investorId",r.id),j.append("contractType",n),(await _.post(`/api/partners/upload/${r.id}`,j,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(j){throw console.error("Error uploading PDF:",j),j}};return ie.useImperativeHandle(b,()=>({generateContract:k})),e.jsx(e.Fragment,{children:e.jsx(ft,{open:p,onClose:()=>a(!1),contractHtml:f,onGeneratePDF:D,loading:T,contractTitle:`معاينة عقد المضاربة - ${r?.name||""}`})})}),bt=({open:r,onClose:x,onSuccess:g})=>{const[n,b]=u.useState({name:"",nationalId:"",address:"",phone:"",email:"",orgProfitPercent:"",capitalAmount:""}),[p,a]=u.useState(!1),[f,L]=u.useState({}),[T,z]=u.useState(!0),[k,D]=u.useState(null),[W,o]=u.useState(""),j=u.useRef(null),y=i=>M=>{b(R=>({...R,[i]:M.target.value})),f[i]&&L(R=>({...R,[i]:""}))},A=()=>{const i={};return n.name.trim()||(i.name="الاسم مطلوب"),n.nationalId.trim()||(i.nationalId="رقم الهوية مطلوب"),n.address.trim()||(i.address="العنوان مطلوب"),n.phone.trim()||(i.phone="رقم الجوال مطلوب"),n.orgProfitPercent||(i.orgProfitPercent="نسبة أرباح المنشأة مطلوبة"),n.capitalAmount||(i.capitalAmount="رأس المال مطلوب"),n.nationalId&&!/^\d{14}$/.test(n.nationalId)&&(i.nationalId="رقم الهوية يجب أن يكون 14 رقمًا"),n.phone&&!/^[0-9]{10}$/.test(n.phone)&&(i.phone="رقم الجوال يجب أن يحتوي على 10 أرقام"),n.orgProfitPercent&&(n.orgProfitPercent<0||n.orgProfitPercent>100)&&(i.orgProfitPercent="النسبة يجب أن تكون بين 0 و 100"),n.capitalAmount&&n.capitalAmount<=0&&(i.capitalAmount="رأس المال يجب أن يكون أكبر من صفر"),L(i),Object.keys(i).length===0};ie.useEffect(()=>{r&&T&&C()},[r,T]);const C=async()=>{try{const i=await _.get("/api/templates/mudarabah");o(i.data.content||"")}catch(i){console.warn("Could not fetch Mudarabah template:",i)}},X=async()=>{if(A()){a(!0);try{const i=await _.post("/api/partners",{...n,orgProfitPercent:parseInt(n.orgProfitPercent),capitalAmount:parseInt(n.capitalAmount)}),M={...i.data.partner,partnerProfitPercent:i.data.partnerProfitPercent||100-parseInt(n.orgProfitPercent)};$("تم إضافة المستثمر بنجاح"),T&&W?(console.log("Setting investor data for contract generation:",M),console.log("Template content length:",W.length),D(M),setTimeout(()=>{j.current?(console.log("Triggering contract generation..."),j.current.generateContract()):console.error("Contract generator ref not available")},500)):(g(),F())}catch(i){P(i.response?.data?.message||"حدث خطأ أثناء إضافة المستثمر"),E(i)}finally{a(!1)}}},re=()=>{g(),F()},F=()=>{b({name:"",nationalId:"",address:"",phone:"",email:"",orgProfitPercent:"",capitalAmount:""}),L({}),D(null),o(""),x()};return e.jsxs(ce,{open:r,onClose:F,maxWidth:"sm",fullWidth:!0,dir:"rtl",children:[e.jsx(de,{sx:{pb:1},children:e.jsx(s,{variant:"h6",fontWeight:"bold",children:"إضافة مستثمر جديد"})}),e.jsx(te,{}),e.jsx(xe,{sx:{py:3},children:e.jsxs(d,{children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",mb:3,children:"المعلومات الشخصية"}),e.jsxs(h,{container:!0,spacing:2.5,children:[e.jsx(h,{item:!0,xs:12,children:e.jsx(m,{label:"الاسم الكامل",value:n.name,onChange:y("name"),fullWidth:!0,error:!!f.name,helperText:f.name,required:!0,size:"medium",sx:{width:"250px"}})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(m,{label:"رقم الهوية الوطنية",value:n.nationalId,onChange:y("nationalId"),fullWidth:!0,error:!!f.nationalId,helperText:f.nationalId,required:!0,inputProps:{maxLength:14},size:"medium",sx:{width:"250px"}})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(m,{label:"رقم الجوال",value:n.phone,onChange:y("phone"),fullWidth:!0,error:!!f.phone,helperText:f.phone,required:!0,placeholder:"05XXXXXXXX",inputProps:{maxLength:10},size:"medium",sx:{width:"250px"}})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(m,{label:"البريد الإلكتروني (اختياري)",type:"email",value:n.email,onChange:y("email"),fullWidth:!0,size:"medium",sx:{width:"250px"}})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(m,{label:"العنوان",value:n.address,onChange:y("address"),fullWidth:!0,error:!!f.address,helperText:f.address,required:!0,multiline:!0,rows:1,size:"medium",sx:{width:"520px"}})})]}),e.jsx(s,{variant:"subtitle1",fontWeight:"bold",mt:4,mb:3,children:"المعلومات المالية"}),e.jsxs(h,{container:!0,spacing:2.5,children:[e.jsx(h,{item:!0,xs:12,children:e.jsx(m,{label:"رأس المال (ريال)",type:"number",value:n.capitalAmount,onChange:y("capitalAmount"),fullWidth:!0,error:!!f.capitalAmount,helperText:f.capitalAmount,required:!0,InputProps:{inputProps:{min:0}},size:"medium",sx:{width:"250px"}})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(m,{label:"نسبة أرباح المنشأة (%)",type:"number",value:n.orgProfitPercent,onChange:y("orgProfitPercent"),fullWidth:!0,error:!!f.orgProfitPercent,helperText:f.orgProfitPercent,required:!0,InputProps:{inputProps:{min:0,max:100}},size:"medium",sx:{width:"250px"}})})]}),e.jsx(s,{variant:"subtitle1",fontWeight:"bold",mt:4,mb:2,children:"خيارات إضافية"}),e.jsx(ot,{control:e.jsx(Qe,{checked:T,onChange:i=>z(i.target.checked),color:"primary"}),label:"توليد عقد المضاربة تلقائياً بعد الحفظ",sx:{mb:2}})]})}),e.jsx(te,{}),e.jsxs(he,{sx:{p:2.5,gap:1,flexDirection:"row-reverse"},children:[e.jsx(w,{onClick:F,disabled:p,variant:"outlined",sx:{minWidth:"100px",borderColor:"grey.300",color:"text.secondary","&:hover":{borderColor:"grey.400",bgcolor:"grey.50"}},children:"إلغاء"}),e.jsx(w,{variant:"contained",onClick:X,disabled:p,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},minWidth:"100px"},children:p?e.jsx(ee,{size:24,color:"inherit"}):"إضافة"})]}),k&&W&&e.jsx(mt,{ref:j,investorData:k,templateContent:W,onContractGenerated:re,contractType:"MUDARABAH"})]})},jt=async(r=1,x="",g="")=>{let n=new URLSearchParams;x.trim()&&(/^\d+$/.test(x.trim())?n.append("nationalId",x.trim()):n.append("name",x.trim())),g.trim()&&n.append("isActive",g.trim()==="نشط"?"true":"false"),n.append("limit","10");const b=n.toString(),p=`/api/partners/all/${r}${b?`?${b}`:""}`;return(await _.get(p)).data},yt=async r=>(await _.get(`/api/partners/${r}`)).data,vt=async(r,x=1)=>(await _.get(`/api/partners/transaction/${r}/${x}`)).data,Ct=async(r,x)=>(await _.post(`/api/partners/transaction/${r}`,x)).data,Pt=async r=>(await _.delete(`/api/partners/transaction/${r}`)).data;function Lt(){const[r,x]=u.useState(0),[g,n]=u.useState(""),[b,p]=u.useState(""),[a,f]=u.useState(null),[L,T]=u.useState(!1),[z,k]=u.useState(!1),[D,W]=u.useState(null),[o,j]=u.useState(!1),[y,A]=u.useState(1),[C,X]=u.useState({}),[re,F]=u.useState(!1),[i,M]=u.useState({type:"DEPOSIT",amount:""}),[R,ue]=u.useState(1),[ae,ne]=u.useState(null),[we,se]=u.useState(!1),q=Ve(),{data:v,isLoading:pe,refetch:fe}=oe({queryKey:["investors",y,g,b],queryFn:()=>jt(y,g,b),retry:1}),{data:l}=oe({queryKey:["investor-details",a?.id],queryFn:()=>a?yt(a.id):null,enabled:!!a,retry:1}),{data:N,isLoading:Te}=oe({queryKey:["partner-transactions",a?.id,R],queryFn:()=>a?vt(a.id,R):null,enabled:!!a,retry:1}),We=it.debounce(t=>{n(t),A(1)},500),Ae=t=>{We(t.target.value)},_e=(t,c)=>{A(c)},De=(t,c)=>{ue(c)},Fe=(t,c)=>{x(c)},ke=t=>{f(t),j(!1),ue(1)},B=(t,c)=>{X(I=>({...I,[t]:c}))},ge=(t,c)=>{M(I=>({...I,[t]:c}))},Me=async()=>{try{const t={...C,capitalAmount:C.capitalAmount?parseInt(C.capitalAmount):void 0,orgProfitPercent:C.orgProfitPercent?parseInt(C.orgProfitPercent):void 0};await _.patch(`/api/partners/${a.id}`,t),q.invalidateQueries({queryKey:["investor-details",a.id]}),q.invalidateQueries({queryKey:["investors"]}),$("تم تحديث بيانات المستثمر بنجاح"),j(!1)}catch(t){P(t.response?.data?.message||"حدث خطأ أثناء تحديث البيانات"),E(t)}},Ee=()=>{T(!0)},Le=async t=>{try{await _.delete(`/api/partners/${t}`),a?.id===t&&f(null),k(!1),W(null),await fe(),$("تم حذف المستثمر بنجاح")}catch(c){P(c.response?.data?.message||"حدث خطأ أثناء حذف المستثمر"),E(c)}},Re=t=>{W(t),k(!0)},Oe=()=>{M({type:"DEPOSIT",amount:""}),F(!0)},$e=async()=>{try{if(!i.amount||parseFloat(i.amount)<=0){P("يرجى إدخال مبلغ صحيح");return}await Ct(a.id,{type:i.type,amount:parseFloat(i.amount)}),q.invalidateQueries({queryKey:["partner-transactions",a.id]}),q.invalidateQueries({queryKey:["investor-details",a.id]}),$("تم إضافة العملية المالية بنجاح"),F(!1),M({type:"DEPOSIT",amount:""})}catch(t){P(t.response?.data?.message||"حدث خطأ أثناء إضافة العملية المالية"),E(t)}},ze=async t=>{try{await Pt(t),q.invalidateQueries({queryKey:["partner-transactions",a.id]}),q.invalidateQueries({queryKey:["investor-details",a.id]}),$("تم حذف العملية المالية بنجاح"),se(!1),ne(null)}catch(c){P(c.response?.data?.message||"حدث خطأ أثناء حذف العملية المالية"),E(c)}},qe=t=>{ne(t),se(!0)},Be=async t=>{try{const I=await(await fetch(t)).blob(),O=l.mudarabahFileUrl.split("/").pop().split(".").pop(),G=`mudarabah_${l.name}.${O}`;ct.saveAs(I,G)}catch(c){P(c.response?.data?.message||"حدث خطأ أثناء تحميل الملف"),E(c)}},He=async t=>{try{const I=await(await fetch(t)).blob(),Y=URL.createObjectURL(I),O=window.open(Y,"_blank");O?.addEventListener("load",()=>{O.print(),O.addEventListener("afterprint",()=>{URL.revokeObjectURL(Y)})},{once:!0})}catch(c){P(c.response?.data?.message||"حدث خطأ أثناء محاولة الطباعة"),E(c)}},Ue=async t=>{try{const I=await(await fetch(t)).blob(),O=t.split("/").pop().split(".").pop(),G=`mudarabah_${l.name}.${O}`,be=new File([I],G,{type:I.type});if(navigator.canShare&&navigator.canShare({files:[be]})){await navigator.share({title:G,text:`مشاركة عقد المضاربة للعميل: ${l.name}`,files:[be]});return}await navigator.clipboard.writeText(t),$("جهازك لا يدعم مشاركة الملفات — تم نسخ رابط الملف ✅")}catch(c){console.error("Share error:",c),P("تعذرت مشاركة الملف")}};u.useEffect(()=>{v?.partners?.length>0&&!a?f(v.partners[0]):a&&v?.partners?.length>0?v.partners.some(c=>c.id===a.id)||f(v.partners[0]):a&&(!v?.partners||v.partners.length===0)&&f(null)},[v,a]),u.useEffect(()=>{l&&X({name:l.name||"",phone:l.phone||"",address:l.address||"",email:l.email||"",orgProfitPercent:l.orgProfitPercent||"",capitalAmount:l.capitalAmount||""})},[l]);const Ne=t=>t?"success":"error",me=t=>t?"نشط":"غير نشط",Ke=t=>{switch(t){case"DEPOSIT":return"إيداع";case"WITHDRAWAL":return"سحب";default:return t}},Xe=t=>{switch(t){case"DEPOSIT":return"success";case"WITHDRAWAL":return"error";default:return"default"}};return e.jsxs(d,{sx:{bgcolor:"#f6f6f8",minHeight:"100vh"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,bgcolor:"#fff",borderBottom:"1px solid #ddd"},children:[e.jsx(d,{children:e.jsx(s,{variant:"h5",fontWeight:"bold",children:"إدارة المستثمرين"})}),e.jsx(d,{sx:{display:"flex",gap:1},children:e.jsx(w,{variant:"contained",startIcon:e.jsx(Pe,{sx:{marginLeft:"10px"}}),onClick:Ee,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},fontWeight:"bold",borderRadius:2,px:2.5,py:1},children:"إضافة مستثمر جديد"})})]}),e.jsxs(d,{sx:{display:"flex",height:"calc(100vh - 120px)"},children:[e.jsxs(d,{sx:{width:"350px",borderRight:"1px solid #ddd",bgcolor:"#fafafa",height:"100%",overflowY:"auto",flexShrink:0},children:[e.jsxs(d,{sx:{p:3,borderBottom:"1px solid #ddd",bgcolor:"#fafafa"},children:[e.jsx(m,{placeholder:"البحث بالاسم أو رقم الهوية",fullWidth:!0,size:"small",onChange:Ae,InputProps:{startAdornment:e.jsx(xt,{position:"start",children:e.jsx(dt,{})})}}),e.jsxs(d,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:2},children:[e.jsx(K,{label:"الكل",color:b===""?"primary":"default",variant:"outlined",onClick:()=>{p(""),A(1)}}),e.jsx(K,{label:"نشط",color:b==="نشط"?"primary":"default",variant:"outlined",onClick:()=>{p(t=>t==="نشط"?"":"نشط"),A(1)}}),e.jsx(K,{label:"غير نشط",color:b==="غير نشط"?"primary":"default",variant:"outlined",onClick:()=>{p(t=>t==="غير نشط"?"":"غير نشط"),A(1)}})]})]}),v&&!pe&&e.jsx(d,{sx:{p:2,borderBottom:"1px solid #eee",bgcolor:"#f9f9f9"},children:e.jsxs(s,{variant:"body2",color:"black",children:["صفحة ",v.currentPage," من ",v.totalPages," - إجمالي ",v.totalPartners," مستثمر"]})}),pe?e.jsx(d,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(ee,{})}):v?.partners?.length===0?e.jsxs(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2,flexDirection:"column"},children:[e.jsx(s,{variant:"h6",color:"black",mb:1,children:"لا توجد مستثمرين"}),e.jsx(s,{variant:"body2",color:"black",children:g||b?"لم يتم العثور على مستثمرين مطابقين للبحث":"لا توجد مستثمرين مسجلين"})]}):v?.partners?.map(t=>{const c=a?.id===t.id;return e.jsx(V,{onClick:()=>ke(t),sx:{mb:1,mx:2,mt:2,cursor:"pointer",height:"100px",border:c?"2px solid #1E40AF":"1px solid #E5E7EB",bgcolor:c?"#EEF2FF":"background.paper",transition:"0.2s","&:hover":{bgcolor:"#F3F4F6"}},children:e.jsxs(J,{sx:{p:2},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(s,{fontWeight:"bold",children:t.name}),e.jsx(K,{label:me(t.isActive),size:"small",color:Ne(t.isActive)})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["رأس المال: ",t.capitalAmount?.toLocaleString()," ريال"]}),e.jsx(d,{display:"flex",justifyContent:"flex-end",mt:1,children:e.jsx(H,{size:"small",color:"error",onClick:I=>{I.stopPropagation(),Re(t)},children:e.jsx(je,{fontSize:"small"})})})]})},t.id)}),v&&v.totalPages>1&&e.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2,gap:2,borderTop:"1px solid #eee"},children:e.jsx(Ce,{count:v.totalPages,page:y,onChange:_e,color:"primary",size:"small",siblingCount:1,boundaryCount:1,sx:{"& .MuiPaginationItem-root":{fontSize:"0.875rem"}}})})]}),a&&l?e.jsxs(d,{sx:{flex:1,p:4,bgcolor:"#fff",overflowY:"auto"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(d,{children:[e.jsx(s,{variant:"h6",fontWeight:"bold",children:l.name}),e.jsxs(s,{color:"text.secondary",children:["رقم الهوية: ",l.nationalId]})]}),e.jsxs(d,{sx:{display:"flex",gap:2},children:[e.jsx(w,{variant:"outlined",startIcon:e.jsx(ht,{sx:{marginLeft:"10px"}}),onClick:()=>j(!o),children:o?"إلغاء التعديل":"تعديل"}),e.jsx(w,{variant:"contained",startIcon:e.jsx(ut,{sx:{marginLeft:"10px"}}),sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"}},disabled:!o,onClick:Me,children:"حفظ التغييرات"})]})]}),e.jsxs(h,{container:!0,spacing:2,mb:3,sx:{width:"100%"},children:[e.jsx(h,{item:!0,xs:12,md:4,children:e.jsx(V,{sx:{width:"250px"},children:e.jsxs(J,{children:[e.jsx(s,{color:"text.secondary",variant:"body1",children:"إجمالي مبلغ الاستثمار"}),e.jsxs(s,{variant:"h6",fontWeight:"bold",color:"success",children:[l.capitalAmount?.toLocaleString()," ريال"]})]})})}),e.jsx(h,{item:!0,xs:12,md:4,children:e.jsx(V,{sx:{width:"250px"},children:e.jsxs(J,{children:[e.jsx(s,{color:"text.secondary",variant:"body1",children:"نسبة أرباح المنشأة"}),e.jsxs(s,{variant:"h6",fontWeight:"bold",children:[l.orgProfitPercent,"%"]})]})})}),e.jsx(h,{item:!0,xs:12,md:4,children:e.jsx(V,{sx:{width:"250px"},children:e.jsxs(J,{children:[e.jsx(s,{color:"text.secondary",variant:"body1",children:"نسبة أرباح المستثمر"}),e.jsxs(s,{variant:"h6",fontWeight:"bold",children:[l.partnerProfitPercent,"%"]})]})})})]}),e.jsxs(pt,{value:r,onChange:Fe,textColor:"primary",indicatorColor:"primary",sx:{mb:3},children:[e.jsx(Z,{label:"التفاصيل الشخصية"}),e.jsx(Z,{label:"المعلومات المالية"}),e.jsx(Z,{label:"العمليات المالية"}),e.jsx(Z,{label:"المستندات"})]}),e.jsx(te,{sx:{mb:3}}),r===0&&e.jsx(d,{children:e.jsxs(U,{sx:{p:3,mb:3},children:[e.jsx(s,{variant:"h6",mb:3,children:"المعلومات الشخصية"}),e.jsxs(h,{container:!0,spacing:3,children:[e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"الاسم الكامل"}),e.jsx(m,{value:o?C.name:l.name,onChange:t=>B("name",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"البريد الإلكتروني"}),e.jsx(m,{value:o?C.email:l.email||"لا يوجد بريد إلكتروني",onChange:t=>B("email",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"رقم الهوية الوطنية"}),e.jsx(m,{value:l.nationalId,fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"رقم الجوال"}),e.jsx(m,{value:o?C.phone:l.phone,onChange:t=>B("phone",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(h,{item:!0,xs:12,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"العنوان"}),e.jsx(m,{value:o?C.address:l.address,onChange:t=>B("address",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"تاريخ الانضمام"}),e.jsx(m,{value:l.createdAt?new Date(l.createdAt).toLocaleDateString("en-US"):"",fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"الحالة"}),e.jsx(m,{value:me(l.isActive),fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]})]})]})}),r===1&&e.jsxs(U,{sx:{p:3},children:[e.jsx(s,{variant:"h6",mb:3,children:"المعلومات المالية"}),e.jsxs(h,{container:!0,spacing:3,children:[e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"رأس المال"}),e.jsx(m,{value:o?C.capitalAmount:l.capitalAmount?.toLocaleString(),onChange:t=>B("capitalAmount",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"نسبة أرباح المنشأة"}),e.jsx(m,{value:o?C.orgProfitPercent:l.orgProfitPercent,onChange:t=>B("orgProfitPercent",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"نسبة أرباح المستثمر"}),e.jsx(m,{value:l.partnerProfitPercent,fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"حساب رأس المال"}),e.jsx(m,{value:l.AccountEquity?.name,fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"حساب المستحقات"}),e.jsx(m,{value:l.AccountPayable?.name,fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]})]})]}),r===2&&e.jsxs(d,{children:[e.jsx(d,{sx:{mb:3,display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{variant:"contained",startIcon:e.jsx(Pe,{sx:{marginLeft:"10px"}}),onClick:Oe,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},fontWeight:"bold"},children:"إضافة عملية مالية"})}),e.jsxs(U,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(Je,{children:e.jsxs(Ze,{stickyHeader:!0,children:[e.jsx(et,{sx:{bgcolor:"#F3F4F6"},children:e.jsxs(Q,{children:[e.jsx(S,{align:"center",sx:{fontWeight:"bold"},children:"رقم المرجع"}),e.jsx(S,{align:"center",sx:{fontWeight:"bold"},children:"نوع العملية"}),e.jsx(S,{align:"center",sx:{fontWeight:"bold"},children:"المبلغ"}),e.jsx(S,{align:"center",sx:{fontWeight:"bold"},children:"التاريخ"}),e.jsx(S,{align:"center",sx:{fontWeight:"bold"},children:"الإجراءات"})]})}),e.jsx(tt,{children:Te?e.jsx(Q,{children:e.jsx(S,{colSpan:5,align:"center",children:e.jsx(ee,{size:20})})}):N?.transactions?.length===0?e.jsx(Q,{children:e.jsx(S,{colSpan:5,align:"center",children:e.jsx(s,{children:"لا توجد عمليات مالية"})})}):N?.transactions?.map(t=>e.jsxs(Q,{hover:!0,children:[e.jsx(S,{align:"center",children:t.reference}),e.jsx(S,{align:"center",children:e.jsx(K,{label:Ke(t.type),color:Xe(t.type),size:"small"})}),e.jsxs(S,{align:"center",sx:{color:t.type==="DEPOSIT"?"success.main":"error.main",fontWeight:"bold"},children:[t.amount?.toLocaleString()," ريال"]}),e.jsx(S,{align:"center",children:rt(t.date).format("DD/MM/YYYY HH:mm a")}),e.jsx(S,{align:"center",children:e.jsx(H,{color:"error",size:"small",onClick:()=>qe(t),children:e.jsx(je,{fontSize:"small"})})})]},t.id))})]})}),N&&N.totalPages>1&&e.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2,borderTop:"1px solid #eee"},children:e.jsx(Ce,{count:N.totalPages,page:R,onChange:De,color:"primary",size:"small",siblingCount:1,boundaryCount:1})})]})]}),r===3&&e.jsx(d,{children:e.jsxs(d,{sx:{mb:4},children:[e.jsx(s,{variant:"h6",sx:{mb:2},children:"المستندات المرفوعة"}),l.mudarabahFileUrl?e.jsx(h,{container:!0,spacing:2,children:e.jsx(h,{item:!0,xs:12,children:e.jsxs(U,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(lt,{color:"success",fontSize:"small"}),e.jsx(d,{children:e.jsx(s,{fontWeight:"500",children:"عقد المضاربة"})})]}),e.jsxs(d,{children:[e.jsx(H,{onClick:()=>He(l.mudarabahFileUrl),children:e.jsx(Ie,{})}),e.jsx(H,{onClick:()=>Be(l.mudarabahFileUrl),title:"تحميل",children:e.jsx(Se,{})}),e.jsx(H,{onClick:()=>Ue(l.mudarabahFileUrl),title:"مشاركة",children:e.jsx(at,{})})]})]})})}):e.jsx(U,{sx:{p:3,textAlign:"center",mb:3},children:e.jsx(s,{color:"text.secondary",children:"لا توجد مستندات مرفوعة"})})]})})]}):e.jsxs(d,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:2},children:[e.jsx(s,{variant:"h6",color:"text.secondary",children:a?"جاري تحميل البيانات...":"اختر مستثمراً لعرض التفاصيل"}),a&&e.jsx(ee,{size:40})]})]}),e.jsx(bt,{open:L,onClose:()=>T(!1),onSuccess:()=>{T(!1),fe()}}),e.jsx(ve,{open:z,onClose:()=>{k(!1),W(null)},onConfirm:()=>{D?.id?(console.log("Delete button clicked, investor ID:",D.id),Le(D.id)):console.error("No investor ID found for deletion")},title:"حذف المستثمر",message:`هل أنت متأكد من حذف المستثمر ${D?.name}؟`,ButtonText:"حذف"}),e.jsxs(ce,{open:re,onClose:()=>F(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(de,{children:e.jsx(s,{variant:"h6",fontWeight:"bold",children:"إضافة عملية مالية"})}),e.jsx(xe,{children:e.jsxs(nt,{spacing:3,sx:{mt:2},children:[e.jsx(st,{fullWidth:!0,size:"small",children:e.jsxs(m,{select:!0,label:"نوع العملية",value:i.type,onChange:t=>ge("type",t.target.value),children:[e.jsx(ye,{value:"DEPOSIT",children:"إيداع"}),e.jsx(ye,{value:"WITHDRAWAL",children:"سحب"})]})}),e.jsx(m,{label:"المبلغ",type:"number",value:i.amount,onChange:t=>ge("amount",t.target.value),fullWidth:!0})]})}),e.jsxs(he,{sx:{p:3,flexDirection:"row-reverse"},children:[e.jsx(w,{onClick:()=>F(!1),color:"inherit",children:"إلغاء"}),e.jsx(w,{onClick:$e,variant:"contained",sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"}},children:"حفظ"})]})]}),e.jsx(ve,{open:we,onClose:()=>{se(!1),ne(null)},onConfirm:()=>{ae?.id&&ze(ae.id)},title:"حذف العملية المالية",message:`هل أنت متأكد من حذف العملية المالية برقم المرجع ${ae?.reference}؟`,ButtonText:"حذف"})]})}export{Lt as default};
//# sourceMappingURL=Investors-Rrzt-vSi.js.map
