import{f as _,j as e,s as ee,g as ce,m as ue,r as n,i as Ae,k as ke,l as Ee,o as Me,p as Fe,q as ze,t as Be,v as Z,w as We,S as Oe,x as re,D as oe,y as ne,I as k,z as te,E as ae,B as g,a as D,T as b,d as L,C as N,F as pe,A as V,n as K,e as Y,G as Te,J as De,K as xe,P as he,L as fe,N as ge,O as me,Q as q,R as d,U as je,V as X,W as be,X as Ue,Y as $e}from"./index-2TEkS4Tk.js";import{F as ie,a as le,c as we,b as F,d as Le}from"./index.esm-Q7QO3LVB.js";import{I as G}from"./InputAdornment-BbJSv7Lk.js";import{V as H}from"./Visibility-RfWQbd6l.js";import{D as qe}from"./DeleteModal-CWdUgVUc.js";import{F as Ve,l as Ye}from"./lodash-CxsAddGS.js";import{A as ye,S as Ne}from"./Search-Be34rJ9a.js";import{g as Qe}from"./LogsApi-DfUh1fh-.js";import{T as Ce}from"./TablePagination-DstB3iTg.js";import{E as Ge}from"./Edit-DJkzKNbs.js";import"./KeyboardArrowRight-D-ZOxJ7W.js";import"./LastPage-TR1pquDU.js";const Ke=_(e.jsxs("g",{fillRule:"evenodd",children:[e.jsx("circle",{cx:"17",cy:"15.5",r:"1.12"}),e.jsx("path",{d:"M17 17.5c-.73 0-2.19.36-2.24 1.08.5.71 1.32 1.17 2.24 1.17s1.74-.46 2.24-1.17c-.05-.72-1.51-1.08-2.24-1.08"}),e.jsx("path",{d:"M18 11.09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55C13.18 21.99 14.97 23 17 23c3.31 0 6-2.69 6-6 0-2.97-2.16-5.43-5-5.91M11 17c0 .56.08 1.11.23 1.62-.24.11-.48.22-.73.3-3.17-1-5.5-4.24-5.5-7.74v-3.6l5.5-2.4 5.5 2.4v3.51c-2.84.48-5 2.94-5 5.91m6 4c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4"})]})),J=_(e.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"})),He=_(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),Je=_(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),Xe=ee("span",{name:"MuiRadioButtonIcon",shouldForwardProp:ce})({position:"relative",display:"flex"}),Ze=ee(He,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),_e=ee(Je,{name:"MuiRadioButtonIcon"})(ue(({theme:s})=>({left:0,position:"absolute",transform:"scale(0)",transition:s.transitions.create("transform",{easing:s.transitions.easing.easeIn,duration:s.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:s.transitions.create("transform",{easing:s.transitions.easing.easeOut,duration:s.transitions.duration.shortest})}}]})));function Pe(s){const{checked:o=!1,classes:r={},fontSize:i}=s,c={...s,checked:o};return e.jsxs(Xe,{className:r.root,ownerState:c,children:[e.jsx(Ze,{fontSize:i,className:r.background,ownerState:c}),e.jsx(_e,{fontSize:i,className:r.dot,ownerState:c})]})}const es=n.createContext(void 0);function ss(){return n.useContext(es)}function os(s){return ke("MuiRadio",s)}const de=Ae("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),ns=s=>{const{classes:o,color:r,size:i}=s,c={root:["root",`color${Z(r)}`,i!=="medium"&&`size${Z(i)}`]};return{...o,...We(c,os,o)}},ts=ee(Oe,{shouldForwardProp:s=>ce(s)||s==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(s,o)=>{const{ownerState:r}=s;return[o.root,r.size!=="medium"&&o[`size${Z(r.size)}`],o[`color${Z(r.color)}`]]}})(ue(({theme:s})=>({color:(s.vars||s).palette.text.secondary,[`&.${de.disabled}`]:{color:(s.vars||s).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:s.alpha((s.vars||s).palette.action.active,(s.vars||s).palette.action.hoverOpacity)}}},...Object.entries(s.palette).filter(re()).map(([o])=>({props:{color:o,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:s.alpha((s.vars||s).palette[o].main,(s.vars||s).palette.action.hoverOpacity)}}})),...Object.entries(s.palette).filter(re()).map(([o])=>({props:{color:o,disabled:!1},style:{[`&.${de.checked}`]:{color:(s.vars||s).palette[o].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function as(s,o){return typeof o=="object"&&o!==null?s===o:String(s)===String(o)}const rs=e.jsx(Pe,{checked:!0}),is=e.jsx(Pe,{}),ls=n.forwardRef(function(o,r){const i=Ee({props:o,name:"MuiRadio"}),{checked:c,checkedIcon:u=rs,color:m="primary",icon:w=is,name:v,onChange:j,size:y="medium",className:C,disabled:l,disableRipple:f=!1,slots:S={},slotProps:I={},inputProps:a,...z}=i,B=Me();let M=l;B&&typeof M>"u"&&(M=B.disabled),M??=!1;const W={...i,disabled:M,disableRipple:f,color:m,size:y},U=ns(W),E=ss();let x=c;const h=Fe(j,E&&E.onChange);let p=v;E&&(typeof x>"u"&&(x=as(E.value,i.value)),typeof p>"u"&&(p=E.name));const P=I.input??a,[O,$]=ze("root",{ref:r,elementType:ts,className:Be(U.root,C),shouldForwardComponentProp:!0,externalForwardedProps:{slots:S,slotProps:I,...z},getSlotProps:R=>({...R,onChange:(A,...T)=>{R.onChange?.(A,...T),h(A,...T)}}),ownerState:W,additionalProps:{type:"radio",icon:n.cloneElement(w,{fontSize:w.props.fontSize??y}),checkedIcon:n.cloneElement(u,{fontSize:u.props.fontSize??y}),disabled:M,name:p,checked:x,slots:S,slotProps:{input:typeof P=="function"?P(W):P}}});return e.jsx(O,{...$,classes:U})}),ds=s=>we().shape({name:F().required("الاسم مطلوب").min(3,"الاسم يجب أن يكون 3 أحرف على الأقل"),email:s==="add"?F().email("البريد الإلكتروني غير صالح").required("البريد الإلكتروني مطلوب"):F().email("البريد الإلكتروني غير صالح"),password:s==="add"?F().required("كلمة المرور مطلوبة").min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل"):F(),phone:F().required("رقم الهاتف مطلوب").matches(/^[0-9]+$/,"رقم الهاتف يجب أن يحتوي على أرقام فقط")}),cs=we().shape({oldPassword:F().required("كلمة المرور الحالية مطلوبة"),newPassword:F().required("كلمة المرور الجديدة مطلوبة").min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل"),confirmPassword:F().required("تأكيد كلمة المرور مطلوب").oneOf([Le("newPassword")],"كلمات المرور غير متطابقة")}),us=({open:s,onClose:o,refetchUsers:r,mode:i="add",editData:c=null})=>{const[u,m]=n.useState(!1),[w,v]=n.useState(!1),[j,y]=n.useState(!1),[C,l]=n.useState(!1),[f,S]=n.useState(!1),[I,a]=n.useState(!1),[z,B]=n.useState(!1),[M,W]=n.useState({name:"",email:"",password:"",phone:""});n.useEffect(()=>{i==="edit"&&c?W({name:c.name||"",email:c.email||"",phone:c.phone||"",password:""}):i==="add"&&W({name:"",email:"",password:"",phone:""}),B(!1),v(!1),y(!1),l(!1)},[i,c,s]);const U=async(x,{resetForm:h})=>{S(!0);try{if(i==="add")await V.post("/api/users",x),K("تم إضافة الموظف بنجاح");else{const{name:p,phone:P}=x;await V.patch(`/api/users/${c.id}`,{name:p,phone:P}),K("تم تعديل بيانات الموظف بنجاح")}h(),r(),o()}catch(p){Y(p.response?.data?.message||"حدث خطأ أثناء العملية")}finally{S(!1)}},E=async(x,{resetForm:h})=>{a(!0);try{await V.patch("/api/auth/update-password",{oldPassword:x.oldPassword,newPassword:x.newPassword,confirmPassword:x.confirmPassword}),K("تم تغيير كلمة المرور بنجاح"),h(),B(!1)}catch(p){Y(p.response?.data?.message||"حدث خطأ أثناء تغيير كلمة المرور")}finally{a(!1)}};return e.jsxs(oe,{open:s,onClose:o,maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:2,direction:"rtl"}},children:[e.jsxs(ne,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[i==="add"?"إضافة موظف جديد":"تعديل بيانات الموظف",e.jsx(k,{onClick:o,size:"small",children:e.jsx(te,{})})]}),e.jsx(ie,{initialValues:M,validationSchema:ds(i),onSubmit:U,enableReinitialize:!0,children:({values:x,errors:h,touched:p,handleChange:P,handleBlur:O})=>e.jsxs(le,{children:[e.jsx(ae,{sx:{pb:1},children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(D,{fullWidth:!0,name:"name",placeholder:"الاسم",value:x.name,onChange:P,onBlur:O,error:p.name&&!!h.name,helperText:p.name&&h.name,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}}}),e.jsx(D,{fullWidth:!0,name:"email",placeholder:"البريد الإلكتروني",type:"email",value:x.email,onChange:P,onBlur:O,error:p.email&&!!h.email,helperText:p.email&&h.email,disabled:i==="edit",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}}}),i==="add"&&e.jsx(D,{fullWidth:!0,name:"password",type:u?"text":"password",placeholder:"كلمة المرور",value:x.password,onChange:P,onBlur:O,error:p.password&&!!h.password,helperText:p.password&&h.password,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}},InputProps:{endAdornment:e.jsx(G,{position:"end",children:e.jsx(k,{onClick:()=>m(!u),children:u?e.jsx(J,{size:15}):e.jsx(H,{size:15})})})}}),e.jsx(D,{fullWidth:!0,name:"phone",placeholder:"رقم الهاتف",value:x.phone,onChange:P,onBlur:O,error:p.phone&&!!h.phone,helperText:p.phone&&h.phone,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}}}),i==="edit"&&e.jsxs(g,{sx:{mt:3,pt:2,borderTop:"1px solid #e0e0e0"},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(b,{variant:"subtitle2",fontWeight:"bold",children:"تغيير كلمة المرور"}),e.jsx(L,{size:"small",onClick:()=>B(!z),sx:{fontSize:"0.75rem"},children:z?"إخفاء":"إظهار"})]}),z&&e.jsx(ie,{initialValues:{oldPassword:"",newPassword:"",confirmPassword:""},validationSchema:cs,onSubmit:E,children:({values:$,errors:R,touched:A,handleChange:T,handleBlur:Q})=>e.jsx(le,{children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(D,{fullWidth:!0,name:"oldPassword",type:w?"text":"password",placeholder:"كلمة المرور الحالية",value:$.oldPassword,onChange:T,onBlur:Q,error:A.oldPassword&&!!R.oldPassword,helperText:A.oldPassword&&R.oldPassword,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}},InputProps:{endAdornment:e.jsx(G,{position:"end",children:e.jsx(k,{onClick:()=>v(!w),children:w?e.jsx(J,{size:15}):e.jsx(H,{size:15})})})}}),e.jsx(D,{fullWidth:!0,name:"newPassword",type:j?"text":"password",placeholder:"كلمة المرور الجديدة",value:$.newPassword,onChange:T,onBlur:Q,error:A.newPassword&&!!R.newPassword,helperText:A.newPassword&&R.newPassword,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}},InputProps:{endAdornment:e.jsx(G,{position:"end",children:e.jsx(k,{onClick:()=>y(!j),children:j?e.jsx(J,{size:15}):e.jsx(H,{size:15})})})}}),e.jsx(D,{fullWidth:!0,name:"confirmPassword",type:C?"text":"password",placeholder:"تأكيد كلمة المرور الجديدة",value:$.confirmPassword,onChange:T,onBlur:Q,error:A.confirmPassword&&!!R.confirmPassword,helperText:A.confirmPassword&&R.confirmPassword,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}},InputProps:{endAdornment:e.jsx(G,{position:"end",children:e.jsx(k,{onClick:()=>l(!C),children:C?e.jsx(J,{size:15}):e.jsx(H,{size:15})})})}}),e.jsx(L,{type:"submit",variant:"contained",disabled:I,sx:{bgcolor:"#dc2626","&:hover":{bgcolor:"#b91c1c"},mt:1},children:I?e.jsx(N,{size:20,color:"inherit"}):"تغيير كلمة المرور"})]})})})]})]})}),e.jsxs(pe,{sx:{px:3,py:2,display:"flex",justifyContent:"center",alignItems:"center",gap:2,flexDirection:"row-reverse"},children:[e.jsx(L,{onClick:o,variant:"outlined",color:"inherit",disabled:f,children:"إلغاء"}),e.jsx(L,{type:"submit",variant:"contained",disabled:f,sx:{bgcolor:"#1E40AF","&:hover":{bgcolor:"#1E3A8A"},minWidth:120},children:f?e.jsx(N,{size:24,color:"inherit"}):i==="add"?"إضافة":"تعديل"})]})]})})]})},ps=({open:s,onClose:o,user:r})=>{const[i,c]=n.useState([]),[u,m]=n.useState(null),[w,v]=n.useState(!1),[j,y]=n.useState(!1),C=Te();n.useEffect(()=>{s&&l()},[s]),n.useEffect(()=>{r&&s&&m(r.role?.id||null)},[r,s]);const l=async()=>{v(!0);try{const a=await V.get("/api/roles");c(a.data.roles||[])}catch(a){console.error("Error fetching roles:",a),Y("حدث خطأ في تحميل الأدوار")}finally{v(!1)}},f=a=>{m(a)},S=async()=>{if(!u){Y("يرجى اختيار دور للموظف");return}y(!0);try{await V.patch(`/api/users/${r.id}/role`,{roleId:parseInt(u)}),K("تم تعيين الدور للموظف بنجاح"),o(),m(null),C.invalidateQueries({queryKey:["employees"]})}catch(a){console.error("Error assigning role:",a),Y(a.response?.data?.message||"حدث خطأ أثناء تعيين الدور")}finally{y(!1)}},I=()=>{m(null),o()};return e.jsxs(oe,{open:s,onClose:I,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,direction:"rtl"}},children:[e.jsxs(ne,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e.jsx(b,{variant:"h6",sx:{fontWeight:"bold"},children:"تعيين دور للموظف"}),e.jsx(k,{onClick:I,size:"small",children:e.jsx(te,{})})]}),e.jsxs(ae,{sx:{pb:1},children:[r&&e.jsx(g,{sx:{mb:3},children:e.jsxs(De,{severity:"info",sx:{borderRadius:2},children:[e.jsxs(b,{variant:"body2",sx:{fontWeight:"bold"},children:["الموظف: ",r.name]}),e.jsx(b,{variant:"body2",sx:{color:"gray",mt:.5},children:r.role?`الدور الحالي: ${r.role.name}`:"لا يوجد دور معين حالياً"})]})}),e.jsx(b,{variant:"subtitle1",sx:{mb:2,fontWeight:"bold"},children:"اختر دور للموظف:"}),w?e.jsx(g,{sx:{display:"flex",justifyContent:"center",py:3},children:e.jsx(N,{})}):i.length===0?e.jsx(b,{variant:"body2",sx:{textAlign:"center",color:"gray",py:3},children:"لا توجد أدوار متاحة"}):e.jsx(g,{sx:{display:"flex",flexDirection:"column",gap:1},children:i.map(a=>e.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,border:"1px solid",borderColor:u===a.id?"#1E40AF":"#E5E7EB",borderRadius:2,bgcolor:u===a.id?"rgba(30, 64, 175, 0.05)":"transparent",cursor:"pointer","&:hover":{bgcolor:u===a.id?"rgba(30, 64, 175, 0.08)":"#F9FAFB"},transition:"all 0.2s ease-in-out"},onClick:()=>f(a.id),children:[e.jsx(g,{sx:{display:"flex",alignItems:"center",gap:2},children:e.jsx(Ve,{control:e.jsx(ls,{checked:u===a.id,onChange:()=>f(a.id),value:a.id,color:"primary"}),label:e.jsxs(g,{children:[e.jsx(b,{variant:"body1",sx:{fontWeight:"bold"},children:a.name}),e.jsx(b,{variant:"body2",sx:{color:"gray",mt:.5},children:a.description}),a.permissions&&e.jsxs(b,{variant:"caption",sx:{color:"#6B7280",display:"block",mt:.5},children:[a.permissions.length," صلاحية"]})]})})}),e.jsx(ye,{sx:{color:u===a.id?"#1E40AF":"#9CA3AF",transition:"color 0.2s ease-in-out"}})]},a.id))})]}),e.jsxs(pe,{sx:{px:3,py:2,display:"flex",justifyContent:"center",alignItems:"center",gap:2,flexDirection:"row-reverse"},children:[e.jsx(L,{onClick:I,variant:"outlined",color:"inherit",disabled:j,children:"إلغاء"}),e.jsx(L,{onClick:S,variant:"contained",disabled:j||!u,sx:{bgcolor:"#1E40AF","&:hover":{bgcolor:"#1E3A8A"},minWidth:120,"&:disabled":{bgcolor:"#E5E7EB",color:"#9CA3AF"}},children:j?e.jsx(N,{size:24,color:"inherit"}):"تعيين الدور"})]})]})},xs=({open:s,onClose:o,userId:r,userName:i})=>{const[c,u]=n.useState(1),{data:m,isLoading:w}=xe({queryKey:["logs",c,r],queryFn:()=>Qe(c,{userId:r||void 0}),enabled:s}),v=(l,f)=>{u(f+1)},j=l=>{switch(l){case"CREATE":return"إنشاء";case"UPDATE":return"تعديل";case"DELETE":return"حذف";case"VIEW":return"عرض";case"login":return"تسجيل دخول";case"logout":return"تسجيل خروج";default:return l}},y=l=>{switch(l){case"CREATE":return"success";case"UPDATE":return"warning";case"DELETE":return"error";case"VIEW":return"info";case"login":return"primary";case"logout":return"secondary";default:return"default"}},C=l=>({Auth:"المصادقة","Bank Accounts":"الحسابات البنكية",Clients:"العملاء",Journals:"القيود",Loans:"السلف",Partners:"الشركاء",Repayments:"الأقساط",Roles:"الأدوار",Templates:"القوالب",Users:"المستخدمين"})[l]||l;return e.jsxs(oe,{open:s,onClose:o,maxWidth:"lg",fullWidth:!0,sx:{"& .MuiDialog-paper":{height:"80vh"}},children:[e.jsx(ne,{children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(b,{variant:"h6",fontWeight:"bold",children:["سجل الأنشطة ",i&&`- ${i}`]}),e.jsx(k,{onClick:o,size:"small",children:e.jsx(te,{})})]})}),e.jsx(ae,{sx:{p:0},children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[e.jsx(he,{sx:{flex:1,width:"100%",overflow:"hidden",borderRadius:0},children:e.jsx(fe,{sx:{height:"100%",width:"100%"},children:e.jsxs(ge,{stickyHeader:!0,sx:{width:"100%"},children:[e.jsx(me,{children:e.jsxs(q,{children:[e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:"المستخدم"}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:"الشاشة"}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:"الإجراء"}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:"الوصف"}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:"التاريخ والوقت"})]})}),e.jsx(je,{children:w?e.jsx(q,{children:e.jsx(d,{colSpan:5,align:"center",children:e.jsx(N,{size:20})})}):m?.data?.length===0?e.jsx(q,{children:e.jsx(d,{colSpan:5,align:"center",children:e.jsx(b,{children:"لا توجد سجلات أنشطة"})})}):m?.data?.map(l=>e.jsxs(q,{hover:!0,children:[e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:e.jsxs(g,{children:[e.jsx(b,{variant:"body2",fontWeight:"bold",children:l.user?.name}),e.jsx(b,{variant:"caption",color:"text.secondary",children:l.user?.email})]})}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:C(l.screen)}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:e.jsx(X,{label:j(l.action),color:y(l.action),size:"small"})}),e.jsx(d,{align:"center",children:e.jsx(b,{variant:"body2",children:l.description})}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:be(l.createdAt).format("DD/MM/YYYY HH:mm")})]},l.id))})]})})}),m&&e.jsx(Ce,{component:"div",count:m.total||0,page:c-1,onPageChange:v,rowsPerPage:10,rowsPerPageOptions:[10],labelDisplayedRows:({from:l,to:f,count:S})=>`عرض ${l}-${f} من ${S}`,labelRowsPerPage:"صفوف لكل صفحة:"})]})})]})},hs=async(s=1,o="")=>(await V.get(`/api/users/${s}?name=${o}`)).data.users;function Rs(){const[s,o]=n.useState(0),[r,i]=n.useState(10),[c,u]=n.useState(!1),[m,w]=n.useState("add"),[v,j]=n.useState(null),[y,C]=n.useState(!1),[l,f]=n.useState(null),[S,I]=n.useState(""),[a,z]=n.useState(!1),[B,M]=n.useState(null),[W,U]=n.useState(!1),[E,x]=n.useState(null),{data:h,isLoading:p,refetch:P}=xe({queryKey:["users",s+1,S],queryFn:()=>hs(s+1,S),retry:1}),O=Ye.debounce(t=>{I(t)},500),$=t=>{O(t.target.value)},R=(t,se)=>{o(se)},A=t=>{i(parseInt(t.target.value,10)),o(0)},T=t=>{j(t),w("edit"),u(!0)},Q=()=>{j(null),w("add"),u(!0)},Se=async t=>{try{await V.delete(`/api/users/${t}`),P(),C(!1),f(null),K("تم حذف الموظف بنجاح")}catch(se){Y(se.response?.data?.message||"حدث خطأ أثناء حذف الموظف")}},ve=t=>{M(t),z(!0)},Ie=t=>{x(t),U(!0)},Re=t=>{f(t),C(!0)};return e.jsxs(g,{sx:{bgcolor:"#FFFFFF",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs(g,{sx:{p:5},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,flexWrap:"wrap",gap:2},children:[e.jsx(D,{placeholder:"البحث عن موظف بالاسم أو البريد الإلكتروني",variant:"outlined",onChange:$,sx:{flex:1,bgcolor:"#F3F4F6",borderRadius:2,"& fieldset":{border:"none"}},InputProps:{startAdornment:e.jsx(G,{position:"start",children:e.jsx(Ne,{sx:{color:"gray"}})})}}),e.jsx(L,{variant:"contained",startIcon:e.jsx(ye,{}),onClick:Q,sx:{bgcolor:"#1E40AF","&:hover":{bgcolor:"#1E3A8A"},fontWeight:"bold"},children:"إضافة مدير جديد"})]}),e.jsxs(fe,{component:he,sx:{borderRadius:2},children:[e.jsxs(ge,{stickyHeader:!0,children:[e.jsx(me,{sx:{bgcolor:"#F3F4F6"},children:e.jsxs(q,{children:[e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"الاسم"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"البريد الإلكتروني"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"رقم الهاتف"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"الحالة"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"الدور"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"تاريخ الإنشاء"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"الإجراءات"})]})}),e.jsx(je,{children:p?e.jsx(q,{children:e.jsx(d,{colSpan:7,align:"center",children:e.jsx(N,{})})}):h?.map(t=>e.jsxs(q,{hover:!0,children:[e.jsx(d,{align:"center",children:t.name}),e.jsx(d,{align:"center",sx:{color:"gray"},children:t.email}),e.jsx(d,{align:"center",sx:{color:"gray"},children:t.phone}),e.jsx(d,{align:"center",children:t.isActive?e.jsx(X,{label:"نشط",sx:{bgcolor:"rgba(16,185,129,0.1)",color:"#10B981",fontWeight:"bold"}}):e.jsx(X,{label:"غير نشط",sx:{bgcolor:"#E5E7EB",color:"#6B7280",fontWeight:"bold"}})}),e.jsx(d,{align:"center",children:e.jsx(X,{label:t.role?.name||"بدون دور",sx:{bgcolor:t.role?.name?"rgba(59,130,246,0.1)":"#E5E7EB",color:t.role?.name?"#3B82F6":"#6B7280",fontWeight:"bold"}})}),e.jsx(d,{align:"center",sx:{color:"gray"},children:be(t.createdAt).format("DD/MM/YYYY")}),e.jsxs(d,{align:"center",sx:{fontWeight:"bold"},children:[e.jsx(k,{color:"primary",onClick:()=>T(t),title:"تعديل",children:e.jsx(Ge,{})}),e.jsx(k,{color:"error",onClick:()=>Re(t.id),title:"حذف",children:e.jsx(Ue,{})}),e.jsx(k,{color:"info",onClick:()=>ve(t),title:"تعيين دور",children:e.jsx(Ke,{})}),e.jsx(k,{color:"black",onClick:()=>Ie(t),title:"عرض سجل الأنشطة",children:e.jsx($e,{})})]})]},t.id))})]}),e.jsx(Ce,{component:"div",count:h?.totalUsers||0,page:s,onPageChange:R,rowsPerPage:r,onRowsPerPageChange:A,labelRowsPerPage:"عدد العناصر في الصفحة"})]})]}),e.jsx(us,{open:c,onClose:()=>u(!1),refetchUsers:P,mode:m,editData:v}),e.jsx(qe,{open:y,onClose:()=>C(!1),onConfirm:()=>Se(l),title:"حذف الموظف",message:"هل أنت متأكد من حذف هذا الموظف؟",ButtonText:"حذف"}),e.jsx(ps,{open:a,onClose:()=>z(!1),user:B}),e.jsx(xs,{open:W,onClose:()=>U(!1),userId:E?.id,userName:E?.name})]})}export{Rs as default};
//# sourceMappingURL=Employees-CMwa5HTD.js.map
