{"version":3,"file":"Login-DJz0qpqz.js","sources":["../../src/pages/auth/Login.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport {\r\n  Box,\r\n  Card,\r\n  CardContent,\r\n  TextField,\r\n  Button,\r\n  Typography,\r\n  CircularProgress,\r\n  InputAdornment,\r\n  IconButton,\r\n  FormControlLabel,\r\n  Checkbox,\r\n} from \"@mui/material\";\r\nimport {\r\n  MdAccountBalance as AccountBalance,\r\n  MdVisibility as VisibilityIcon,\r\n  MdVisibilityOff as VisibilityOffIcon,\r\n} from \"react-icons/md\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { Formik, Form } from \"formik\";\r\nimport * as Yup from \"yup\";\r\nimport { Helmet } from \"react-helmet-async\";\r\nimport Api, { handleApiError } from \"../../config/Api\";\r\nimport { notifySuccess, notifyError } from \"../../utilities/toastify\";\r\nimport {usePermissions} from \"../../components/Contexts/PermissionsContext\";\r\n\r\nconst validationSchema = Yup.object().shape({\r\n  email: Yup.string()\r\n    .trim()\r\n    .email(\"البريد الإلكتروني غير صالح\")\r\n    .required(\"البريد الإلكتروني مطلوب\"),\r\n  password: Yup.string().trim().required(\"كلمة المرور مطلوبة\"),\r\n});\r\n\r\nconst Login = () => {\r\n  const navigate = useNavigate();\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [rememberMe, setRememberMe] = useState(false);\r\n  const [savedEmail, setSavedEmail] = useState(\"\");\r\n  const {fetchPermissions} = usePermissions();\r\n  const handleTogglePassword = () => setShowPassword(!showPassword);\r\n\r\n  // Load saved email on mount\r\n  useEffect(() => {\r\n    const savedEmailFromStorage = localStorage.getItem('rememberedEmail');\r\n    if (savedEmailFromStorage) {\r\n      setSavedEmail(savedEmailFromStorage);\r\n      setRememberMe(true);\r\n    }\r\n  }, []);\r\n\r\n  const handleSubmit = async (values) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const cleanedValues = {\r\n        ...values,\r\n        email: values.email.trim(),\r\n      };\r\n\r\n      // 1️⃣ تسجيل الدخول\r\n      const response = await Api.post(\"/api/auth/login\", cleanedValues);\r\n      const { accessToken, user } = response.data;\r\n\r\n      // 2️⃣ تخزين البيانات الأساسية فقط\r\n      localStorage.setItem(\"token\", accessToken);\r\n      localStorage.setItem(\"user\", JSON.stringify(user));\r\n\r\n      // Handle Remember Me\r\n      if (rememberMe) {\r\n        localStorage.setItem(\"rememberedEmail\", cleanedValues.email);\r\n      } else {\r\n        localStorage.removeItem(\"rememberedEmail\");\r\n      }\r\n\r\n      // 3️⃣ استدعاء دالة جلب الصلاحيات من الكونتيكست\r\n      try {\r\n        if (fetchPermissions && typeof fetchPermissions === 'function') {\r\n          await fetchPermissions();\r\n        } else {\r\n          console.warn('fetchPermissions function not available, reloading page');\r\n          window.location.reload();\r\n        }\r\n      } catch (permissionsError) {\r\n        console.error('Error fetching permissions:', permissionsError);\r\n        // لا نوقف عملية تسجيل الدخول إذا فشل جلب الصلاحيات\r\n        notifyError('تم تسجيل الدخول ولكن حدث خطأ في جلب الصلاحيات');\r\n      }\r\n\r\n      notifySuccess(\"تم تسجيل الدخول بنجاح\");\r\n\r\n      // 4️⃣ التوجيه للوحة التحكم\r\n      navigate(\"/dashboard\", { replace: true });\r\n    } catch (error) {\r\n      notifyError(\"خطأ في تسجيل الدخول\");\r\n      handleApiError(error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        minHeight: \"100vh\",\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        background: \"linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%)\",\r\n        padding: 2,\r\n      }}\r\n    >\r\n      <Helmet>\r\n        <title>تسجيل الدخول</title>\r\n        <meta name=\"description\" content=\"تسجيل الدخول لنظام إدارة السلف\" />\r\n      </Helmet>\r\n\r\n      <Card\r\n        sx={{\r\n          maxWidth: 450,\r\n          width: \"100%\",\r\n          boxShadow: \"0 8px 32px rgba(0,0,0,0.1)\",\r\n          borderRadius: 3,\r\n        }}\r\n      >\r\n        <CardContent sx={{ p: 4 }}>\r\n          <Box sx={{ textAlign: \"center\", mb: 4 }}>\r\n            <AccountBalance\r\n              style={{\r\n                fontSize: 40,\r\n                color: \"#1976d2\",\r\n                marginBottom: 10,\r\n              }}\r\n            />\r\n            <Typography\r\n              gutterBottom\r\n              sx={{\r\n                fontSize: 24,\r\n                fontWeight: 600,\r\n                color: \"#1976d2\",\r\n              }}\r\n            >\r\n              نظام إدارة السلف\r\n            </Typography>\r\n          </Box>\r\n\r\n          <Formik\r\n            initialValues={{\r\n              email: savedEmail,\r\n              password: \"\",\r\n            }}\r\n            validationSchema={validationSchema}\r\n            onSubmit={handleSubmit}\r\n            enableReinitialize\r\n          >\r\n            {({\r\n              values,\r\n              errors,\r\n              touched,\r\n              handleChange,\r\n              handleBlur,\r\n              handleSubmit,\r\n            }) => (\r\n              <Form onSubmit={handleSubmit}>\r\n                <Box sx={{ display: \"flex\", flexDirection: \"column\", gap: 3 }}>\r\n                  {/* البريد الإلكتروني */}\r\n                  <TextField\r\n                    fullWidth\r\n                    label=\"البريد الإلكتروني\"\r\n                    name=\"email\"\r\n                    value={values.email}\r\n                    onChange={handleChange}\r\n                    onBlur={handleBlur}\r\n                    error={touched.email && Boolean(errors.email)}\r\n                    helperText={touched.email && errors.email}\r\n                    variant=\"outlined\"\r\n                    InputLabelProps={{ shrink: true }}\r\n                    autoComplete=\"username\"\r\n                    disabled={isLoading}\r\n                  />\r\n\r\n                  {/* كلمة المرور */}\r\n                  <TextField\r\n                    fullWidth\r\n                    label=\"كلمة المرور\"\r\n                    name=\"password\"\r\n                    type={showPassword ? \"text\" : \"password\"}\r\n                    value={values.password}\r\n                    onChange={handleChange}\r\n                    onBlur={handleBlur}\r\n                    error={touched.password && Boolean(errors.password)}\r\n                    helperText={touched.password && errors.password}\r\n                    variant=\"outlined\"\r\n                    autoComplete=\"current-password\"\r\n                    disabled={isLoading}\r\n                    InputLabelProps={{ shrink: true }}\r\n                    InputProps={{\r\n                      endAdornment: (\r\n                        <InputAdornment position=\"end\" sx={{ shrink: true }}>\r\n                          <IconButton onClick={handleTogglePassword}>\r\n                            {showPassword ? (\r\n                              <VisibilityOffIcon size={20} />\r\n                            ) : (\r\n                              <VisibilityIcon size={20} />\r\n                            )}\r\n                          </IconButton>\r\n                        </InputAdornment>\r\n                      ),\r\n                    }}\r\n                  />\r\n\r\n                  {/* Remember Me and Forgot Password Row */}\r\n                  <Box \r\n                    sx={{ \r\n                      display: 'flex', \r\n                      justifyContent: 'space-between', \r\n                      alignItems: 'center',\r\n                      direction: 'rtl'\r\n                    }}\r\n                  >\r\n                    {/* Remember Me Checkbox */}\r\n                    <FormControlLabel\r\n                      control={\r\n                        <Checkbox\r\n                          checked={rememberMe}\r\n                          onChange={(e) => setRememberMe(e.target.checked)}\r\n                          disabled={isLoading}\r\n                          sx={{\r\n                            '&.Mui-checked': {\r\n                              color: 'primary.main',\r\n                            },\r\n                          }}\r\n                        />\r\n                      }\r\n                      label={\r\n                        <Typography sx={{ fontSize: '0.95rem', color: 'text.secondary' }}>\r\n                          تذكرني\r\n                        </Typography>\r\n                      }\r\n                      sx={{\r\n                        mr: 0,\r\n                        '& .MuiFormControlLabel-label': {\r\n                          mr: 1,\r\n                        },\r\n                      }}\r\n                    />\r\n\r\n                    {/* Forgot Password Link */}\r\n                    <Link \r\n                      to=\"/forgot-password\" \r\n                      style={{ \r\n                        textDecoration: 'none',\r\n                        fontSize: '0.95rem',\r\n                        color: '#1976d2',\r\n                        fontWeight: 500\r\n                      }}\r\n                    >\r\n                      نسيت كلمة المرور؟\r\n                    </Link>\r\n                  </Box>\r\n\r\n                  <Button\r\n                    type=\"submit\"\r\n                    fullWidth\r\n                    variant=\"contained\"\r\n                    disabled={isLoading}\r\n                    sx={{\r\n                      py: 1.5,\r\n                      fontWeight: 500,\r\n                      fontSize: \"1rem\",\r\n                    }}\r\n                  >\r\n                    {isLoading ? (\r\n                      <CircularProgress size={24} sx={{ color: \"#fff\" }} />\r\n                    ) : (\r\n                      \"تسجيل الدخول\"\r\n                    )}\r\n                  </Button>\r\n                </Box>\r\n              </Form>\r\n            )}\r\n          </Formik>\r\n        </CardContent>\r\n      </Card>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default Login;"],"names":["validationSchema","Yup.object","Yup.string","Login","navigate","useNavigate","showPassword","setShowPassword","useState","isLoading","setIsLoading","rememberMe","setRememberMe","savedEmail","setSavedEmail","fetchPermissions","usePermissions","handleTogglePassword","useEffect","savedEmailFromStorage","handleSubmit","values","cleanedValues","response","Api","accessToken","user","permissionsError","notifyError","notifySuccess","error","handleApiError","jsxs","Box","Helmet","jsx","Card","CardContent","AccountBalance","Typography","Formik","errors","touched","handleChange","handleBlur","Form","TextField","InputAdornment","IconButton","VisibilityOffIcon","VisibilityIcon","FormControlLabel","Checkbox","e","Link","Button","CircularProgress"],"mappings":"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"}