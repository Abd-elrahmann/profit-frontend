import{u as E,r as o,a as v,j as e,B as l,H as B,C as P,b as z,M as L,T as f,F,c as M,d as A,e as h,I as T,f as W,g as R,h as V,i as H,L as q,k as D,l as N,A as O,n as g,m as $,o as J,p as b}from"./index-Byloyp0V.js";import{F as G}from"./FormControlLabel-Fb32HuXN.js";const K=M().shape({email:b().trim().email("البريد الإلكتروني غير صالح").required("البريد الإلكتروني مطلوب"),password:b().trim().required("كلمة المرور مطلوبة")}),X=()=>{const j=E(),[d,S]=o.useState(!1),[r,u]=o.useState(!1),[x,p]=o.useState(!1),[w,y]=o.useState(""),{fetchPermissions:c}=v(),C=()=>S(!d);o.useEffect(()=>{const t=localStorage.getItem("rememberedEmail");t&&(y(t),p(!0))},[]);const k=async t=>{u(!0);try{const s={...t,email:t.email.trim()},a=await O.post("/api/auth/login",s),{accessToken:i,user:n}=a.data;localStorage.setItem("token",i),localStorage.setItem("user",JSON.stringify(n)),x?localStorage.setItem("rememberedEmail",s.email):localStorage.removeItem("rememberedEmail");try{c&&typeof c=="function"?await c():(console.warn("fetchPermissions function not available, reloading page"),window.location.reload())}catch(m){console.error("Error fetching permissions:",m),g("تم تسجيل الدخول ولكن حدث خطأ في جلب الصلاحيات")}$("تم تسجيل الدخول بنجاح"),j("/dashboard",{replace:!0})}catch(s){g("خطأ في تسجيل الدخول"),J(s)}finally{u(!1)}};return e.jsxs(l,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%)",padding:2},children:[e.jsxs(B,{children:[e.jsx("title",{children:"تسجيل الدخول"}),e.jsx("meta",{name:"description",content:"تسجيل الدخول لنظام إدارة السلف"})]}),e.jsx(P,{sx:{maxWidth:450,width:"100%",boxShadow:"0 8px 32px rgba(0,0,0,0.1)",borderRadius:3},children:e.jsxs(z,{sx:{p:4},children:[e.jsxs(l,{sx:{textAlign:"center",mb:4},children:[e.jsx(L,{style:{fontSize:40,color:"#1976d2",marginBottom:10}}),e.jsx(f,{gutterBottom:!0,sx:{fontSize:24,fontWeight:600,color:"#1976d2"},children:"نظام إدارة السلف"})]}),e.jsx(F,{initialValues:{email:w,password:""},validationSchema:K,onSubmit:k,enableReinitialize:!0,children:({values:t,errors:s,touched:a,handleChange:i,handleBlur:n,handleSubmit:m})=>e.jsx(A,{onSubmit:m,children:e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(h,{fullWidth:!0,label:"البريد الإلكتروني",name:"email",value:t.email,onChange:i,onBlur:n,error:a.email&&!!s.email,helperText:a.email&&s.email,variant:"outlined",InputLabelProps:{shrink:!0},autoComplete:"username",disabled:r}),e.jsx(h,{fullWidth:!0,label:"كلمة المرور",name:"password",type:d?"text":"password",value:t.password,onChange:i,onBlur:n,error:a.password&&!!s.password,helperText:a.password&&s.password,variant:"outlined",autoComplete:"current-password",disabled:r,InputLabelProps:{shrink:!0},InputProps:{endAdornment:e.jsx(T,{position:"end",sx:{shrink:!0},children:e.jsx(W,{onClick:C,children:d?e.jsx(R,{size:20}):e.jsx(V,{size:20})})})}}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",direction:"rtl"},children:[e.jsx(G,{control:e.jsx(H,{checked:x,onChange:I=>p(I.target.checked),disabled:r,sx:{"&.Mui-checked":{color:"primary.main"}}}),label:e.jsx(f,{sx:{fontSize:"0.95rem",color:"text.secondary"},children:"تذكرني"}),sx:{mr:0,"& .MuiFormControlLabel-label":{mr:1}}}),e.jsx(q,{to:"/forgot-password",style:{textDecoration:"none",fontSize:"0.95rem",color:"#1976d2",fontWeight:500},children:"نسيت كلمة المرور؟"})]}),e.jsx(D,{type:"submit",fullWidth:!0,variant:"contained",disabled:r,sx:{py:1.5,fontWeight:500,fontSize:"1rem"},children:r?e.jsx(N,{size:24,sx:{color:"#fff"}}):"تسجيل الدخول"})]})})})]})})]})};export{X as default};
//# sourceMappingURL=Login-DJz0qpqz.js.map
