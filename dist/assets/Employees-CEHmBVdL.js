import{q as X,j as e,s as ee,t as xe,v as ue,r as t,w as ze,x as Fe,y as Me,z as Be,D as We,E as Oe,G as De,J as Z,K as Te,S as Ue,N as ae,O as oe,P as ne,f as E,Q as te,F as ie,d as le,R as re,B as g,e as U,I as G,T as y,k as L,c as pe,l as N,U as he,A as q,m as Q,n as $,p as D,V as $e,W as Le,X as de,Y as H,Z as fe,_ as ge,$ as me,a0 as je,a1 as be,a2 as ye,a3 as Y,a4 as d,a5 as we,a6 as Ce,a as qe,H as Ve,a7 as Ye}from"./index-Byloyp0V.js";import{V as K}from"./Visibility--5hKivIt.js";import{D as Ne}from"./DeleteModal-Du1zPAFn.js";import{F as Qe}from"./FormControlLabel-Fb32HuXN.js";import{A as Pe}from"./Add-JAHAPveB.js";import{g as He}from"./logsApi-MFzB1Yn4.js";import{T as Se}from"./TablePagination-rGYbANAk.js";import{l as _e}from"./lodash-Dqh01Uem.js";import{S as Ge}from"./Search-DKotboAf.js";import{E as Ke}from"./Edit-D4H7Xh5Y.js";import"./KeyboardArrowRight-nGgaUmNE.js";import"./LastPage-D5DKCjzm.js";const Je=X(e.jsxs("g",{fillRule:"evenodd",children:[e.jsx("circle",{cx:"17",cy:"15.5",r:"1.12"}),e.jsx("path",{d:"M17 17.5c-.73 0-2.19.36-2.24 1.08.5.71 1.32 1.17 2.24 1.17s1.74-.46 2.24-1.17c-.05-.72-1.51-1.08-2.24-1.08"}),e.jsx("path",{d:"M18 11.09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55C13.18 21.99 14.97 23 17 23c3.31 0 6-2.69 6-6 0-2.97-2.16-5.43-5-5.91M11 17c0 .56.08 1.11.23 1.62-.24.11-.48.22-.73.3-3.17-1-5.5-4.24-5.5-7.74v-3.6l5.5-2.4 5.5 2.4v3.51c-2.84.48-5 2.94-5 5.91m6 4c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4"})]})),J=X(e.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"})),Ze=X(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),Xe=X(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),es=ee("span",{name:"MuiRadioButtonIcon",shouldForwardProp:xe})({position:"relative",display:"flex"}),ss=ee(Ze,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),os=ee(Xe,{name:"MuiRadioButtonIcon"})(ue(({theme:s})=>({left:0,position:"absolute",transform:"scale(0)",transition:s.transitions.create("transform",{easing:s.transitions.easing.easeIn,duration:s.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:s.transitions.create("transform",{easing:s.transitions.easing.easeOut,duration:s.transitions.duration.shortest})}}]})));function ve(s){const{checked:o=!1,classes:r={},fontSize:l}=s,x={...s,checked:o};return e.jsxs(es,{className:r.root,ownerState:x,children:[e.jsx(ss,{fontSize:l,className:r.background,ownerState:x}),e.jsx(os,{fontSize:l,className:r.dot,ownerState:x})]})}const ns=t.createContext(void 0);function ts(){return t.useContext(ns)}function rs(s){return Fe("MuiRadio",s)}const ce=ze("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),as=s=>{const{classes:o,color:r,size:l}=s,x={root:["root",`color${Z(r)}`,l!=="medium"&&`size${Z(l)}`]};return{...o,...Te(x,rs,o)}},is=ee(Ue,{shouldForwardProp:s=>xe(s)||s==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(s,o)=>{const{ownerState:r}=s;return[o.root,r.size!=="medium"&&o[`size${Z(r.size)}`],o[`color${Z(r.color)}`]]}})(ue(({theme:s})=>({color:(s.vars||s).palette.text.secondary,[`&.${ce.disabled}`]:{color:(s.vars||s).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:s.alpha((s.vars||s).palette.action.active,(s.vars||s).palette.action.hoverOpacity)}}},...Object.entries(s.palette).filter(ae()).map(([o])=>({props:{color:o,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:s.alpha((s.vars||s).palette[o].main,(s.vars||s).palette.action.hoverOpacity)}}})),...Object.entries(s.palette).filter(ae()).map(([o])=>({props:{color:o,disabled:!1},style:{[`&.${ce.checked}`]:{color:(s.vars||s).palette[o].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function ls(s,o){return typeof o=="object"&&o!==null?s===o:String(s)===String(o)}const ds=e.jsx(ve,{checked:!0}),cs=e.jsx(ve,{}),xs=t.forwardRef(function(o,r){const l=Me({props:o,name:"MuiRadio"}),{checked:x,checkedIcon:w=ds,color:h="primary",icon:m=cs,name:z,onChange:S,size:C="medium",className:P,disabled:a,disableRipple:b=!1,slots:R={},slotProps:W={},inputProps:O,...F}=l,M=Be();let v=a;M&&typeof v>"u"&&(v=M.disabled),v??=!1;const j={...l,disabled:v,disableRipple:b,color:h,size:C},n=as(j),u=ts();let c=x;const f=We(S,u&&u.onChange);let p=z;u&&(typeof c>"u"&&(c=ls(u.value,l.value)),typeof p>"u"&&(p=u.name));const I=W.input??O,[B,V]=Oe("root",{ref:r,elementType:is,className:De(n.root,P),shouldForwardComponentProp:!0,externalForwardedProps:{slots:R,slotProps:W,...F},getSlotProps:A=>({...A,onChange:(k,...T)=>{A.onChange?.(k,...T),f(k,...T)}}),ownerState:j,additionalProps:{type:"radio",icon:t.cloneElement(m,{fontSize:m.props.fontSize??C}),checkedIcon:t.cloneElement(w,{fontSize:w.props.fontSize??C}),disabled:v,name:p,checked:c,slots:R,slotProps:{input:typeof I=="function"?I(j):I}}});return e.jsx(B,{...V,classes:n})}),us=s=>pe().shape({name:D().required("الاسم مطلوب").min(3,"الاسم يجب أن يكون 3 أحرف على الأقل"),email:s==="add"?D().email("البريد الإلكتروني غير صالح").required("البريد الإلكتروني مطلوب"):D().email("البريد الإلكتروني غير صالح"),password:s==="add"?D().required("كلمة المرور مطلوبة").min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل"):D(),phone:D().required("رقم الهاتف مطلوب").matches(/^[0-9]+$/,"رقم الهاتف يجب أن يحتوي على أرقام فقط")}),ps=pe().shape({oldPassword:D().required("كلمة المرور الحالية مطلوبة"),newPassword:D().required("كلمة المرور الجديدة مطلوبة").min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل"),confirmPassword:D().required("تأكيد كلمة المرور مطلوب").oneOf([$e("newPassword")],"كلمات المرور غير متطابقة")}),hs=({open:s,onClose:o,refetchUsers:r,mode:l="add",editData:x=null})=>{const[w,h]=t.useState(!1),[m,z]=t.useState(!1),[S,C]=t.useState(!1),[P,a]=t.useState(!1),[b,R]=t.useState(!1),[W,O]=t.useState(!1),[F,M]=t.useState(!1),[v,j]=t.useState({name:"",email:"",password:"",phone:""});t.useEffect(()=>{l==="edit"&&x?j({name:x.name||"",email:x.email||"",phone:x.phone||"",password:""}):l==="add"&&j({name:"",email:"",password:"",phone:""}),M(!1),z(!1),C(!1),a(!1)},[l,x,s]);const n=async(c,{resetForm:f})=>{R(!0);try{if(l==="add")await q.post("/api/users",c),Q("تم إضافة الموظف بنجاح");else{const{name:p,phone:I}=c;await q.patch(`/api/users/${x.id}`,{name:p,phone:I}),Q("تم تعديل بيانات الموظف بنجاح")}f(),r(),o()}catch(p){$(p.response?.data?.message||"حدث خطأ أثناء العملية")}finally{R(!1)}},u=async(c,{resetForm:f})=>{O(!0);try{await q.patch("/api/auth/update-password",{oldPassword:c.oldPassword,newPassword:c.newPassword,confirmPassword:c.confirmPassword}),Q("تم تغيير كلمة المرور بنجاح"),f(),M(!1)}catch(p){$(p.response?.data?.message||"حدث خطأ أثناء تغيير كلمة المرور")}finally{O(!1)}};return e.jsxs(oe,{open:s,onClose:o,maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:2,direction:"rtl"}},children:[e.jsxs(ne,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[l==="add"?"إضافة موظف جديد":"تعديل بيانات الموظف",e.jsx(E,{onClick:o,size:"small",children:e.jsx(te,{})})]}),e.jsx(ie,{initialValues:v,validationSchema:us(l),onSubmit:n,enableReinitialize:!0,children:({values:c,errors:f,touched:p,handleChange:I,handleBlur:B})=>e.jsxs(le,{children:[e.jsx(re,{sx:{pb:1},children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(U,{fullWidth:!0,name:"name",placeholder:"الاسم",value:c.name,onChange:I,onBlur:B,error:p.name&&!!f.name,helperText:p.name&&f.name,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}}}),e.jsx(U,{fullWidth:!0,name:"email",placeholder:"البريد الإلكتروني",type:"email",value:c.email,onChange:I,onBlur:B,error:p.email&&!!f.email,helperText:p.email&&f.email,disabled:l==="edit",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}}}),l==="add"&&e.jsx(U,{fullWidth:!0,name:"password",type:w?"text":"password",placeholder:"كلمة المرور",value:c.password,onChange:I,onBlur:B,error:p.password&&!!f.password,helperText:p.password&&f.password,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}},InputProps:{endAdornment:e.jsx(G,{position:"end",children:e.jsx(E,{onClick:()=>h(!w),children:w?e.jsx(J,{size:15}):e.jsx(K,{size:15})})})}}),e.jsx(U,{fullWidth:!0,name:"phone",placeholder:"رقم الهاتف",value:c.phone,onChange:I,onBlur:B,error:p.phone&&!!f.phone,helperText:p.phone&&f.phone,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}}}),l==="edit"&&e.jsxs(g,{sx:{mt:3,pt:2,borderTop:"1px solid #e0e0e0"},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(y,{variant:"subtitle2",fontWeight:"bold",children:"تغيير كلمة المرور"}),e.jsx(L,{size:"small",onClick:()=>M(!F),sx:{fontSize:"0.75rem"},children:F?"إخفاء":"إظهار"})]}),F&&e.jsx(ie,{initialValues:{oldPassword:"",newPassword:"",confirmPassword:""},validationSchema:ps,onSubmit:u,children:({values:V,errors:A,touched:k,handleChange:T,handleBlur:_})=>e.jsx(le,{children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(U,{fullWidth:!0,name:"oldPassword",type:m?"text":"password",placeholder:"كلمة المرور الحالية",value:V.oldPassword,onChange:T,onBlur:_,error:k.oldPassword&&!!A.oldPassword,helperText:k.oldPassword&&A.oldPassword,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}},InputProps:{endAdornment:e.jsx(G,{position:"end",children:e.jsx(E,{onClick:()=>z(!m),children:m?e.jsx(J,{size:15}):e.jsx(K,{size:15})})})}}),e.jsx(U,{fullWidth:!0,name:"newPassword",type:S?"text":"password",placeholder:"كلمة المرور الجديدة",value:V.newPassword,onChange:T,onBlur:_,error:k.newPassword&&!!A.newPassword,helperText:k.newPassword&&A.newPassword,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}},InputProps:{endAdornment:e.jsx(G,{position:"end",children:e.jsx(E,{onClick:()=>C(!S),children:S?e.jsx(J,{size:15}):e.jsx(K,{size:15})})})}}),e.jsx(U,{fullWidth:!0,name:"confirmPassword",type:P?"text":"password",placeholder:"تأكيد كلمة المرور الجديدة",value:V.confirmPassword,onChange:T,onBlur:_,error:k.confirmPassword&&!!A.confirmPassword,helperText:k.confirmPassword&&A.confirmPassword,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}},InputProps:{endAdornment:e.jsx(G,{position:"end",children:e.jsx(E,{onClick:()=>a(!P),children:P?e.jsx(J,{size:15}):e.jsx(K,{size:15})})})}}),e.jsx(L,{type:"submit",variant:"contained",disabled:W,sx:{bgcolor:"#dc2626","&:hover":{bgcolor:"#b91c1c"},mt:1},children:W?e.jsx(N,{size:20,color:"inherit"}):"تغيير كلمة المرور"})]})})})]})]})}),e.jsxs(he,{sx:{px:3,py:2,display:"flex",justifyContent:"center",alignItems:"center",gap:2,flexDirection:"row-reverse"},children:[e.jsx(L,{onClick:o,variant:"outlined",color:"inherit",disabled:b,children:"إلغاء"}),e.jsx(L,{type:"submit",variant:"contained",disabled:b,sx:{bgcolor:"#1E40AF","&:hover":{bgcolor:"#1E3A8A"},minWidth:120},children:b?e.jsx(N,{size:24,color:"inherit"}):l==="add"?"إضافة":"تعديل"})]})]})})]})},fs=({open:s,onClose:o,user:r,refetchUsers:l})=>{const[x,w]=t.useState([]),[h,m]=t.useState(null),[z,S]=t.useState(!1),[C,P]=t.useState(!1),[a,b]=t.useState(!1),R=Le();t.useEffect(()=>{s&&W()},[s]),t.useEffect(()=>{r&&s&&m(r.role?.id||null)},[r,s]);const W=async()=>{S(!0);try{const n=await q.get("/api/roles");w(n.data.roles||[])}catch(n){console.error("Error fetching roles:",n),$("حدث خطأ في تحميل الأدوار")}finally{S(!1)}},O=n=>{r?.role||m(n)},F=async()=>{if(r?.role){b(!0);try{await q.patch(`/api/users/${r.id}/role`,{roleId:null}),Q("تم إزالة الدور من الموظف بنجاح"),m(null),R.invalidateQueries({queryKey:["employees"]}),o()}catch(n){console.error("Error removing role:",n),$(n.response?.data?.message||"حدث خطأ أثناء إزالة الدور")}finally{b(!1)}}},M=async()=>{if(!h){$("يرجى اختيار دور للموظف");return}if(r?.role){$("لا يمكن تعيين دور جديد للموظف لأنه يمتلك دوراً بالفعل. يرجى إزالة الدور الحالي أولاً.");return}P(!0);try{await q.patch(`/api/users/${r.id}/role`,{roleId:parseInt(h)}),Q("تم تعيين الدور للموظف بنجاح"),o(),m(null),l()}catch(n){console.error("Error assigning role:",n),$(n.response?.data?.message||"حدث خطأ أثناء تعيين الدور")}finally{P(!1)}},v=()=>{m(null),o()},j=r?.role;return e.jsxs(oe,{open:s,onClose:v,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,direction:"rtl"}},children:[e.jsxs(ne,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e.jsx(y,{variant:"h6",sx:{fontWeight:"bold"},children:j?"إدارة دور الموظف":"تعيين دور للموظف"}),e.jsx(E,{onClick:v,size:"small",children:e.jsx(te,{})})]}),e.jsxs(re,{sx:{pb:1},children:[r&&e.jsx(g,{sx:{mb:3},children:e.jsxs(de,{severity:j?"warning":"info",sx:{borderRadius:2},children:[e.jsxs(y,{variant:"body2",sx:{fontWeight:"bold"},children:["الموظف: ",r.name]}),e.jsx(y,{variant:"body2",sx:{color:"gray",mt:.5},children:j?e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[e.jsx("span",{children:"الدور الحالي:"}),e.jsx(H,{label:r.role.name,size:"small",sx:{bgcolor:"rgba(59,130,246,0.1)",color:"#3B82F6",fontWeight:"bold"}})]}):"لا يوجد دور معين حالياً"})]})}),j&&e.jsx(g,{sx:{mb:3,display:"flex",justifyContent:"center"},children:e.jsx(L,{variant:"outlined",color:"error",startIcon:e.jsx(fe,{}),onClick:F,disabled:a,sx:{borderColor:"#EF4444",color:"#EF4444","&:hover":{bgcolor:"rgba(239, 68, 68, 0.04)",borderColor:"#DC2626"}},children:a?e.jsx(N,{size:20,color:"error"}):"إزالة الدور الحالي"})}),e.jsx(y,{variant:"subtitle1",sx:{mb:2,fontWeight:"bold"},children:j?"الأدوار المتاحة (غير مفعلة)":"اختر دور للموظف:"}),z?e.jsx(g,{sx:{display:"flex",justifyContent:"center",py:3},children:e.jsx(N,{})}):x.length===0?e.jsx(y,{variant:"body2",sx:{textAlign:"center",color:"gray",py:3},children:"لا توجد أدوار متاحة"}):e.jsx(g,{sx:{display:"flex",flexDirection:"column",gap:1},children:x.map(n=>{const u=r?.role?.id===n.id,c=j&&!u;return e.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,border:"1px solid",borderColor:u?"#10B981":h===n.id?"#1E40AF":"#E5E7EB",borderRadius:2,bgcolor:u?"rgba(16,185,129,0.05)":h===n.id?"rgba(30, 64, 175, 0.05)":"transparent",cursor:c?"not-allowed":"pointer",opacity:c?.6:1,"&:hover":{bgcolor:c?"transparent":u?"rgba(16,185,129,0.08)":h===n.id?"rgba(30, 64, 175, 0.08)":"#F9FAFB"},transition:"all 0.2s ease-in-out",position:"relative"},onClick:()=>!c&&O(n.id),children:[u&&e.jsx(H,{label:"الدور الحالي",size:"small",sx:{position:"absolute",top:8,left:8,bgcolor:"#10B981",color:"white",fontSize:"0.7rem",height:20}}),e.jsx(g,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:e.jsx(Qe,{control:e.jsx(xs,{checked:u||h===n.id,onChange:()=>!c&&O(n.id),value:n.id,color:u?"success":"primary",disabled:c}),label:e.jsxs(g,{sx:{opacity:c?.7:1},children:[e.jsxs(y,{variant:"body1",sx:{fontWeight:"bold",color:u?"#10B981":"inherit"},children:[n.name,u&&" ✓"]}),e.jsx(y,{variant:"body2",sx:{color:"gray",mt:.5},children:n.description}),n.permissions&&e.jsxs(y,{variant:"caption",sx:{color:"#6B7280",display:"block",mt:.5},children:[n.permissions.length," صلاحية"]})]}),sx:{width:"100%",mr:0}})}),!c&&e.jsx(Pe,{sx:{color:u?"#10B981":h===n.id?"#1E40AF":"#9CA3AF",transition:"color 0.2s ease-in-out"}})]},n.id)})}),j&&e.jsx(de,{severity:"info",sx:{mt:2,borderRadius:2},children:e.jsx(y,{variant:"body2",children:"لا يمكن تعيين دور جديد للموظف لأنه يمتلك دوراً بالفعل. يرجى إزالة الدور الحالي أولاً لتمكين تعيين دور جديد."})})]}),e.jsxs(he,{sx:{px:3,py:2,display:"flex",justifyContent:"center",alignItems:"center",gap:2,flexDirection:"row-reverse"},children:[e.jsx(L,{onClick:v,variant:"outlined",color:"inherit",disabled:C||a,children:"إغلاق"}),!j&&e.jsx(L,{onClick:M,variant:"contained",disabled:C||!h,sx:{bgcolor:"#1E40AF","&:hover":{bgcolor:"#1E3A8A"},minWidth:120,"&:disabled":{bgcolor:"#E5E7EB",color:"#9CA3AF"}},children:C?e.jsx(N,{size:24,color:"inherit"}):"تعيين الدور"})]})]})},gs=({open:s,onClose:o,userId:r,userName:l})=>{const[x,w]=t.useState(1),{data:h,isLoading:m}=ge({queryKey:["logs",x,r],queryFn:()=>He(x,{userId:r||void 0}),enabled:s}),z=(a,b)=>{w(b+1)},S=a=>{switch(a){case"CREATE":return"إنشاء";case"UPDATE":return"تعديل";case"DELETE":return"حذف";case"VIEW":return"عرض";case"login":return"تسجيل دخول";case"logout":return"تسجيل خروج";default:return a}},C=a=>{switch(a){case"CREATE":return"success";case"UPDATE":return"warning";case"DELETE":return"error";case"VIEW":return"info";case"login":return"primary";case"logout":return"secondary";default:return"default"}},P=a=>({Auth:"المصادقة","Bank Accounts":"الحسابات البنكية",Clients:"العملاء",Journals:"القيود",Loans:"السلف",Partners:"الشركاء",Repayments:"الأقساط",Roles:"الأدوار",Templates:"القوالب",Users:"المستخدمين"})[a]||a;return e.jsxs(oe,{open:s,onClose:o,maxWidth:"lg",fullWidth:!0,sx:{"& .MuiDialog-paper":{height:"80vh"}},children:[e.jsx(ne,{children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(y,{variant:"h6",fontWeight:"bold",children:["سجل الأنشطة ",l&&`- ${l}`]}),e.jsx(E,{onClick:o,size:"small",children:e.jsx(te,{})})]})}),e.jsx(re,{sx:{p:0},children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[e.jsx(me,{sx:{flex:1,width:"100%",overflow:"hidden",borderRadius:0},children:e.jsx(je,{sx:{height:"100%",width:"100%"},children:e.jsxs(be,{stickyHeader:!0,sx:{width:"100%"},children:[e.jsx(ye,{children:e.jsxs(Y,{children:[e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:"المستخدم"}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:"الشاشة"}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:"الإجراء"}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:"الوصف"}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:"التاريخ والوقت"})]})}),e.jsx(we,{children:m?e.jsx(Y,{children:e.jsx(d,{colSpan:5,align:"center",children:e.jsx(N,{size:20})})}):h?.data?.length===0?e.jsx(Y,{children:e.jsx(d,{colSpan:5,align:"center",children:e.jsx(y,{children:"لا توجد سجلات أنشطة"})})}):h?.data?.map(a=>e.jsxs(Y,{hover:!0,children:[e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:e.jsxs(g,{children:[e.jsx(y,{variant:"body2",fontWeight:"bold",children:a.user?.name}),e.jsx(y,{variant:"caption",color:"text.secondary",children:a.user?.email})]})}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:P(a.screen)}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:e.jsx(H,{label:S(a.action),color:C(a.action),size:"small"})}),e.jsx(d,{align:"center",children:e.jsx(y,{variant:"body2",children:a.description})}),e.jsx(d,{align:"center",sx:{whiteSpace:"nowrap"},children:Ce(a.createdAt).format("DD/MM/YYYY HH:mm")})]},a.id))})]})})}),h&&e.jsx(Se,{component:"div",count:h.total||0,page:x-1,onPageChange:z,rowsPerPage:10,rowsPerPageOptions:[10],labelDisplayedRows:({from:a,to:b,count:R})=>`عرض ${a}-${b} من ${R}`,labelRowsPerPage:"صفوف لكل صفحة:"})]})})]})},ms=async(s=1,o="")=>(await q.get(`/api/users/${s}?name=${o}`)).data.users;function Es(){const[s,o]=t.useState(0),[r,l]=t.useState(10),[x,w]=t.useState(!1),[h,m]=t.useState("add"),[z,S]=t.useState(null),[C,P]=t.useState(!1),[a,b]=t.useState(null),[R,W]=t.useState(""),[O,F]=t.useState(!1),[M,v]=t.useState(null),[j,n]=t.useState(!1),[u,c]=t.useState(null),{permissions:f}=qe(),{data:p,isLoading:I,refetch:B}=ge({queryKey:["employees",s+1,R],queryFn:()=>ms(s+1,R),retry:1}),V=_e.debounce(i=>{W(i)},500),A=i=>{V(i.target.value)},k=(i,se)=>{o(se)},T=i=>{l(parseInt(i.target.value,10)),o(0)},_=i=>{S(i),m("edit"),w(!0)},Re=()=>{S(null),m("add"),w(!0)},Ie=async i=>{try{await q.delete(`/api/users/${i}`),B(),P(!1),b(null),Q("تم حذف الموظف بنجاح")}catch(se){$(se.response?.data?.message||"حدث خطأ أثناء حذف الموظف")}},Ae=i=>{v(i),F(!0)},ke=i=>{c(i),n(!0)},Ee=i=>{b(i),P(!0)};return e.jsxs(g,{sx:{bgcolor:"#FFFFFF",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs(Ve,{children:[e.jsx("title",{children:"الموظفين"}),e.jsx("meta",{name:"description",content:"الموظفين"})]}),e.jsxs(g,{sx:{p:5},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,flexWrap:"wrap",gap:2},children:[e.jsx(U,{placeholder:"البحث عن موظف بالاسم أو البريد الإلكتروني",variant:"outlined",onChange:A,sx:{flex:1,bgcolor:"#F3F4F6",borderRadius:2,"& fieldset":{border:"none"}},InputProps:{startAdornment:e.jsx(G,{position:"start",children:e.jsx(Ge,{sx:{color:"gray"}})})}}),f.includes("users_Add")&&e.jsx(L,{variant:"contained",startIcon:e.jsx(Pe,{}),onClick:Re,sx:{bgcolor:"#1E40AF","&:hover":{bgcolor:"#1E3A8A"},fontWeight:"bold"},children:"إضافة مدير جديد"})]}),e.jsxs(je,{component:me,sx:{borderRadius:2},children:[e.jsxs(be,{stickyHeader:!0,children:[e.jsx(ye,{sx:{bgcolor:"#F3F4F6"},children:e.jsxs(Y,{children:[e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"الاسم"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"البريد الإلكتروني"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"رقم الهاتف"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"الحالة"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"الدور"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"تاريخ الإنشاء"}),e.jsx(d,{align:"center",sx:{fontWeight:"bold"},children:"الإجراءات"})]})}),e.jsx(we,{children:I?e.jsx(Y,{children:e.jsx(d,{colSpan:7,align:"center",children:e.jsx(N,{})})}):p?.map(i=>e.jsxs(Y,{hover:!0,children:[e.jsx(d,{align:"center",children:i.name}),e.jsx(d,{align:"center",sx:{color:"gray"},children:i.email}),e.jsx(d,{align:"center",sx:{color:"gray"},children:i.phone}),e.jsx(d,{align:"center",children:i.isActive?e.jsx(H,{label:"نشط",sx:{bgcolor:"rgba(16,185,129,0.1)",color:"#10B981",fontWeight:"bold"}}):e.jsx(H,{label:"غير نشط",sx:{bgcolor:"#E5E7EB",color:"#6B7280",fontWeight:"bold"}})}),e.jsx(d,{align:"center",children:e.jsx(H,{label:i.role?.name||"بدون دور",sx:{bgcolor:i.role?.name?"rgba(59,130,246,0.1)":"#E5E7EB",color:i.role?.name?"#3B82F6":"#6B7280",fontWeight:"bold"}})}),e.jsx(d,{align:"center",sx:{color:"gray"},children:Ce(i.createdAt).format("DD/MM/YYYY")}),e.jsxs(d,{align:"center",sx:{fontWeight:"bold"},children:[f.includes("users_Update")&&e.jsx(E,{color:"primary",onClick:()=>_(i),title:"تعديل",children:e.jsx(Ke,{})}),f.includes("users_Delete")&&e.jsx(E,{color:"error",onClick:()=>Ee(i.id),title:"حذف",children:e.jsx(fe,{})}),f.includes("users_Add")&&e.jsx(E,{color:"info",onClick:()=>Ae(i),title:"تعيين دور",children:e.jsx(Je,{})}),e.jsx(E,{color:"black",onClick:()=>ke(i),title:"عرض سجل الأنشطة",children:e.jsx(Ye,{})})]})]},i.id))})]}),e.jsx(Se,{component:"div",count:p?.totalUsers||0,page:s,onPageChange:k,rowsPerPage:r,onRowsPerPageChange:T,labelRowsPerPage:"عدد العناصر في الصفحة"})]})]}),e.jsx(hs,{open:x,onClose:()=>w(!1),refetchUsers:B,mode:h,editData:z}),e.jsx(Ne,{open:C,onClose:()=>P(!1),onConfirm:()=>Ie(a),title:"حذف الموظف",message:"هل أنت متأكد من حذف هذا الموظف؟",ButtonText:"حذف"}),e.jsx(fs,{open:O,onClose:()=>F(!1),user:M,refetchUsers:B}),e.jsx(gs,{open:j,onClose:()=>n(!1),userId:u?.id,userName:u?.name})]})}export{Es as default};
//# sourceMappingURL=Employees-CEHmBVdL.js.map
