{"version":3,"file":"Loans-829W0G-M.js","sources":["../../node_modules/@mui/icons-material/esm/Pause.js","../../node_modules/@mui/icons-material/esm/PlayArrow.js","../../src/pages/Loans/loanApis.js","../../src/components/modals/LoansTable.jsx","../../src/components/LoanContractGenerator.jsx","../../src/components/LoanContractsPreview.jsx","../../src/pages/Loans/Loans.jsx"],"sourcesContent":["\"use client\";\n\nimport createSvgIcon from \"./utils/createSvgIcon.js\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon(/*#__PURE__*/_jsx(\"path\", {\n  d: \"M6 19h4V5H6zm8-14v14h4V5z\"\n}), 'Pause');","\"use client\";\n\nimport createSvgIcon from \"./utils/createSvgIcon.js\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon(/*#__PURE__*/_jsx(\"path\", {\n  d: \"M8 5v14l11-7z\"\n}), 'PlayArrow');","import Api, { handleApiError } from '../../config/Api';\n\n// Get clients with pagination and search\nexport const getClients = async (page = 1, search = '') => {\n  try {\n    const url = search \n      ? `/api/clients/all/${page}?search=${encodeURIComponent(search)}`\n      : `/api/clients/all/${page}`;\n    const response = await Api.get(url);\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n    throw error;\n  }\n};\n\n// Get partners with pagination and search\nexport const getPartners = async (page = 1, search = '') => {\n  try {\n    const url = search\n      ? `/api/partners/all/${page}?search=${encodeURIComponent(search)}`\n      : `/api/partners/all/${page}`;\n    const response = await Api.get(url);\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n    throw error;\n  }\n};\n\n// Create new loan\nexport const createLoan = async (loanData) => {\n  try {\n    const response = await Api.post('/api/loans', loanData);\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n    throw error;\n  }\n};\n\n// Update loan\nexport const updateLoan = async (loanId, loanData) => {\n  try {\n    const response = await Api.patch(`/api/loans/${loanId}`, loanData);\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n    throw error;\n  }\n};\n\n// Activate loan\nexport const activateLoan = async (loanId) => {\n  try {\n    const response = await Api.patch(`/api/loans/${loanId}/activate`);\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n    throw error;\n  }\n};\n\n// Deactivate loan\nexport const deactivateLoan = async (loanId) => {\n  try {\n    const response = await Api.patch(`/api/loans/${loanId}/deactivate`);\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n    throw error;\n  }\n};\n\n// Get all loans with pagination\nexport const getLoans = async (page = 1, search = '') => {\n  try {\n    const url = search \n      ? `/api/loans/all/${page}?search=${encodeURIComponent(search)}`\n      : `/api/loans/all/${page}`;\n    const response = await Api.get(url);\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n    throw error;\n  }\n};\n\n// Get loan by ID\nexport const getLoanById = async (loanId) => {\n  try {\n    const response = await Api.get(`/api/loans/${loanId}`);\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n    throw error;\n  }\n};\n\n// Delete loan\nexport const deleteLoan = async (loanId) => {\n  try {\n    const response = await Api.delete(`/api/loans/${loanId}`);\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n    throw error;\n  }\n};","import React, { useState } from \"react\";\nimport {\n  Box,\n  Paper,\n  Table,\n  TableBody,\n  TableContainer,\n  TableHead,\n  TablePagination,\n  IconButton,\n  Chip,\n  Stack,\n  Typography,\n  CircularProgress,\n  InputBase,\n  Menu,\n  MenuItem,\n  ListItemIcon,\n} from \"@mui/material\";\nimport {\n  Visibility,\n  Delete,\n  PlayArrow,\n  Schedule,\n  Pause,\n  MoreVert,\n} from \"@mui/icons-material\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  getLoans,\n  deleteLoan,\n  activateLoan,\n  deactivateLoan,\n} from \"../../pages/Loans/loanApis\";\nimport { notifySuccess, notifyError } from \"../../utilities/toastify\";\nimport DeleteModal from \"../../components/modals/DeleteModal\";\nimport { StyledTableCell, StyledTableRow } from \"../layouts/tableLayout\";\nimport dayjs from \"dayjs\";\nimport { usePermissions } from \"../Contexts/PermissionsContext\";\nconst LoansTable = ({ onViewDetails, onViewInstallments }) => {\n  const [page, setPage] = useState(1);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [loanToDelete, setLoanToDelete] = useState(null);\n  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);\n  const queryClient = useQueryClient();\n  const [anchorEl, setAnchorEl] = useState(null);\n  const [selectedLoanForMenu, setSelectedLoanForMenu] = useState(null);\n  const { permissions } = usePermissions(); \n  const handleMenuOpen = (event, loan) => {\n    setAnchorEl(event.currentTarget);\n    setSelectedLoanForMenu(loan);\n  };\n\n  const handleMenuClose = () => {\n    setAnchorEl(null);\n    setSelectedLoanForMenu(null);\n  };\n\n  const { data: loansData, isLoading } = useQuery({\n    queryKey: [\"loans\", page, searchQuery],\n    queryFn: () => getLoans(page, searchQuery),\n    retry: 1,\n  });\n\n  const handleSearchChange = (event) => {\n    setSearchQuery(event.target.value);\n    setPage(1);\n  };\n\n  const handleChangePage = (event, newPage) => {\n    setPage(newPage + 1);\n  };\n\n  const handleDeleteLoan = async (loanId) => {\n    try {\n      await deleteLoan(loanId);\n      notifySuccess(\"تم حذف السلفة بنجاح\");\n      queryClient.invalidateQueries([\"loans\"]);\n      setIsDeleteModalOpen(false);\n      setLoanToDelete(null);\n    } catch (error) {\n      notifyError(error.response?.data?.message || \"حدث خطأ أثناء حذف السلفة\");\n    }\n  };\n\n  const handleActivateLoan = async (loanId) => {\n    try {\n      await activateLoan(loanId);\n      notifySuccess(\"تم تفعيل السلفة بنجاح\");\n      queryClient.invalidateQueries([\"loans\"]);\n    } catch (error) {\n      notifyError(\n        error.response?.data?.message || \"حدث خطأ أثناء تفعيل السلفة\"\n      );\n    }\n  };\n\n  const handleDeactivateLoan = async (loanId) => {\n    try {\n      await deactivateLoan(loanId);\n      notifySuccess(\"تم إلغاء تفعيل السلفة بنجاح\");\n      queryClient.invalidateQueries([\"loans\"]);\n    } catch (error) {\n      notifyError(\n        error.response?.data?.message || \"حدث خطأ أثناء إلغاء تفعيل السلفة\"\n      );\n    }\n  };\n\n  const handleViewInstallmentsClick = (loan) => {\n    if (loan.status === \"PENDING\") {\n      notifyError(\"يجب تفعيل السلفة أولاً لعرض الأقساط\");\n      return;\n    }\n    onViewInstallments(loan);\n  };\n\n  const getStatusColor = (status) => {\n    switch (status) {\n      case \"PENDING\":\n        return \"warning\";\n      case \"ACTIVE\":\n        return \"success\";\n      case \"COMPLETED\":\n        return \"info\";\n      case \"DEFAULTED\":\n        return \"error\";\n      default:\n        return \"default\";\n    }\n  };\n\n  const getStatusText = (status) => {\n    switch (status) {\n      case \"PENDING\":\n        return \"قيد المراجعة\";\n      case \"ACTIVE\":\n        return \"نشط\";\n      case \"COMPLETED\":\n        return \"مكتمل\";\n      case \"DEFAULTED\":\n        return \"متأخر\";\n      default:\n        return status;\n    }\n  };\n\n  const getTypeText = (type) => {\n    switch (type) {\n      case \"DAILY\":\n        return \"يومي\";\n      case \"WEEKLY\":\n        return \"أسبوعي\";\n      case \"MONTHLY\":\n        return \"شهري\";\n      default:\n        return type;\n    }\n  };\n\n  return (\n    <Box\n      sx={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        width: \"100%\",\n        height: \"100%\",\n      }}\n    >\n      {/* Search Bar */}\n      <Box\n        sx={{\n          p: 2,\n          display: \"flex\",\n          justifyContent: \"space-between\",\n          alignItems: \"center\",\n        }}\n      >\n        <InputBase\n          placeholder=\"ابحث باسم العميل أو رقم السلفة...\"\n          value={searchQuery}\n          onChange={handleSearchChange}\n          sx={{\n            width: \"280px\",\n            borderRadius: \"6px\",\n          }}\n        />\n      </Box>\n\n      {/* Table */}\n      <Paper sx={{ flex: 1, width: \"100%\", overflow: \"hidden\" }}>\n        <TableContainer sx={{ height: \"100%\", width: \"100%\" }}>\n          <Table stickyHeader sx={{ width: \"100%\" }}>\n            <TableHead>\n              <StyledTableRow>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  رقم السلفة\n                </StyledTableCell>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  العميل\n                </StyledTableCell>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  {\" \"}\n                  المستثمر\n                </StyledTableCell>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  الحساب البنكي\n                </StyledTableCell>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  مبلغ السلفة\n                </StyledTableCell>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  معدل الفائدة\n                </StyledTableCell>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  المدة\n                </StyledTableCell>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  النوع\n                </StyledTableCell>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  {\" \"}\n                  يوم الاستحقاق\n                </StyledTableCell>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  الحالة\n                </StyledTableCell>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  تاريخ البدء\n                </StyledTableCell>\n                <StyledTableCell align=\"center\" sx={{ whiteSpace: \"nowrap\" }}>\n                  الإجراءات\n                </StyledTableCell>\n              </StyledTableRow>\n            </TableHead>\n            <TableBody>\n              {isLoading ? (\n                <StyledTableRow>\n                  <StyledTableCell colSpan={12} align=\"center\">\n                    <CircularProgress size={20} />\n                  </StyledTableCell>\n                </StyledTableRow>\n              ) : loansData?.data?.length === 0 ? (\n                <StyledTableRow>\n                  <StyledTableCell colSpan={12} align=\"center\">\n                    <Typography>لا توجد سلف</Typography>\n                  </StyledTableCell>\n                </StyledTableRow>\n              ) : (\n                loansData?.data?.map((loan) => (\n                  <StyledTableRow key={loan.id} hover>\n                    <StyledTableCell>{loan.code}</StyledTableCell>\n                    <StyledTableCell\n                      align=\"center\"\n                      sx={{ whiteSpace: \"nowrap\" }}\n                    >\n                      {loan.client?.name}\n                    </StyledTableCell>\n                    <StyledTableCell\n                      align=\"center\"\n                      sx={{ whiteSpace: \"nowrap\" }}\n                    >\n                      {loan.partner?.name}\n                    </StyledTableCell>\n                    <StyledTableCell\n                      align=\"center\"\n                      sx={{ whiteSpace: \"nowrap\" }}\n                    >\n                      {loan.bankAccount?.name}\n                    </StyledTableCell>\n                    <StyledTableCell\n                      align=\"center\"\n                      sx={{ whiteSpace: \"nowrap\", fontWeight: \"bold\" }}\n                    >\n                      {loan.amount?.toLocaleString()} ر.س\n                    </StyledTableCell>\n                    <StyledTableCell\n                      align=\"center\"\n                      sx={{ whiteSpace: \"nowrap\" }}\n                    >\n                      {loan.interestRate}%\n                    </StyledTableCell>\n                    <StyledTableCell\n                      align=\"center\"\n                      sx={{ whiteSpace: \"nowrap\" }}\n                    >\n                      {loan.durationMonths} شهر\n                    </StyledTableCell>\n                    <StyledTableCell\n                      align=\"center\"\n                      sx={{ whiteSpace: \"nowrap\" }}\n                    >\n                      {getTypeText(loan.type)}\n                    </StyledTableCell>\n                    <StyledTableCell\n                      align=\"center\"\n                      sx={{ whiteSpace: \"nowrap\" }}\n                    >\n                      {loan.repaymentDay}\n                    </StyledTableCell>\n                    <StyledTableCell\n                      align=\"center\"\n                      sx={{ whiteSpace: \"nowrap\" }}\n                    >\n                      <Chip\n                        label={getStatusText(loan.status)}\n                        color={getStatusColor(loan.status)}\n                        size=\"small\"\n                      />\n                    </StyledTableCell>\n                    <StyledTableCell\n                      align=\"center\"\n                      sx={{ whiteSpace: \"nowrap\" }}\n                    >\n                      {dayjs(loan.startDate).format(\"DD/MM/YYYY\")}\n                    </StyledTableCell>\n                    <StyledTableCell\n                      align=\"center\"\n                      sx={{ whiteSpace: \"nowrap\" }}\n                    >\n                      <IconButton\n                        size=\"small\"\n                        onClick={(event) => handleMenuOpen(event, loan)}\n                      >\n                        <MoreVert fontSize=\"small\" />\n                      </IconButton>\n                    </StyledTableCell>\n                  </StyledTableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n        </TableContainer>\n      </Paper>\n      {/* Pagination */}\n      {loansData && (\n        <TablePagination\n          component=\"div\"\n          count={loansData.total || 0}\n          page={page - 1}\n          onPageChange={handleChangePage}\n          rowsPerPage={10}\n          rowsPerPageOptions={[10]}\n          labelDisplayedRows={({ from, to, count }) =>\n            `عرض ${from}-${to} من ${count}`\n          }\n          labelRowsPerPage=\"صفوف لكل صفحة:\"\n        />\n      )}\n\n      {/* Delete Confirmation Modal */}\n      <DeleteModal\n        open={isDeleteModalOpen}\n        onClose={() => {\n          setIsDeleteModalOpen(false);\n          setLoanToDelete(null);\n        }}\n        onConfirm={() => handleDeleteLoan(loanToDelete?.id)}\n        title=\"حذف السلفة\"\n        message={`هل أنت متأكد من حذف سلفة العميل ${loanToDelete?.client?.name}؟`}\n        ButtonText=\"حذف\"\n      />\n\n      {/* Actions Menu */}\n      <Menu\n        anchorEl={anchorEl}\n        open={Boolean(anchorEl)}\n        onClose={handleMenuClose}\n      >\n        {/* View Loan Details */}\n        <MenuItem\n          onClick={() => {\n            onViewDetails(selectedLoanForMenu?.id);\n            handleMenuClose();\n          }}\n          sx={{ color: \"#1976D2\" }} // Blue\n        >\n          <ListItemIcon>\n            <Visibility fontSize=\"small\" sx={{ color: \"#1976D2\" }} />\n          </ListItemIcon>\n          عرض السلفة\n        </MenuItem>\n\n        {/* View Installments */}\n        <MenuItem\n          onClick={() => {\n            handleViewInstallmentsClick(selectedLoanForMenu);\n            handleMenuClose();\n          }}\n          sx={{ color: \"#2E7D32\" }} // Green\n        >\n\n          <ListItemIcon>\n            <Schedule fontSize=\"small\" sx={{ color: \"#2E7D32\" }} />\n          </ListItemIcon>\n          عرض الأقساط\n        </MenuItem>\n\n        {/* Activate Loan (PENDING) */}\n        {selectedLoanForMenu?.status === \"PENDING\" && permissions.includes(\"loans_Post\") && (\n          <MenuItem\n            onClick={() => {\n              handleActivateLoan(selectedLoanForMenu?.id);\n              handleMenuClose();\n            }}\n            sx={{ color: \"#FB8C00\" }} // Orange\n          >\n            \n            <ListItemIcon>\n              <PlayArrow fontSize=\"small\" sx={{ color: \"#FB8C00\" }} />\n            </ListItemIcon>\n            تفعيل السلفة\n          </MenuItem>\n        )}\n\n        {/* Deactivate Loan (ACTIVE) */}\n        {selectedLoanForMenu?.status === \"ACTIVE\" && permissions.includes(\"loans_Post\") && (\n          <MenuItem\n            onClick={() => {\n              handleDeactivateLoan(selectedLoanForMenu?.id);\n              handleMenuClose();\n            }}\n            sx={{ color: \"#8E24AA\" }} // Purple\n          >\n            <ListItemIcon>\n              <Pause fontSize=\"small\" sx={{ color: \"#8E24AA\" }} />\n            </ListItemIcon>\n            إلغاء تفعيل السلفة\n          </MenuItem>\n        )}\n\n        {/* Delete Loan */}\n        {selectedLoanForMenu?.status !== \"ACTIVE\" && permissions.includes(\"loans_Delete\") && (\n          <MenuItem\n            onClick={() => {\n              setLoanToDelete(selectedLoanForMenu);\n              setIsDeleteModalOpen(true);\n              handleMenuClose();\n            }}\n            sx={{ color: \"#D32F2F\" }} // Red\n          >\n            <ListItemIcon>\n              <Delete fontSize=\"small\" sx={{ color: \"#D32F2F\" }} />\n            </ListItemIcon>\n            حذف السلفة\n          </MenuItem>\n        )}\n      </Menu>\n    </Box>\n  );\n};\n\nexport default LoansTable;\n","// components/contracts/LoanContractGenerator.jsx\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport html2pdf from \"html2pdf.js\";\nimport Api, { handleApiError } from \"../config/Api\";\nimport { notifyError } from \"../utilities/toastify\";\n\nconst numberToArabicWords = (num) => {\n  const ones = [\n    \"\",\n    \"واحد\",\n    \"اثنان\",\n    \"ثلاثة\",\n    \"أربعة\",\n    \"خمسة\",\n    \"ستة\",\n    \"سبعة\",\n    \"ثمانية\",\n    \"تسعة\",\n  ];\n  const tens = [\n    \"\",\n    \"\",\n    \"عشرون\",\n    \"ثلاثون\",\n    \"أربعون\",\n    \"خمسون\",\n    \"ستون\",\n    \"سبعون\",\n    \"ثمانون\",\n    \"تسعون\",\n  ];\n  const teens = [\n    \"عشرة\",\n    \"أحد عشر\",\n    \"اثنا عشر\",\n    \"ثلاثة عشر\",\n    \"أربعة عشر\",\n    \"خمسة عشر\",\n    \"ستة عشر\",\n    \"سبعة عشر\",\n    \"ثمانية عشر\",\n    \"تسعة عشر\",\n  ];\n  const hundreds = [\n    \"\",\n    \"مائة\",\n    \"مائتان\",\n    \"ثلاثمائة\",\n    \"أربعمائة\",\n    \"خمسمائة\",\n    \"ستمائة\",\n    \"سبعمائة\",\n    \"ثمانمائة\",\n    \"تسعمائة\",\n  ];\n  \n  if (num === 0) return \"صفر\";\n  if (num < 0) return \"سالب \" + numberToArabicWords(-num);\n  \n  let result = \"\";\n  \n  // Handle millions\n  if (num >= 1000000) {\n    const millionsPart = Math.floor(num / 1000000);\n    if (millionsPart === 1) {\n      result += \"مليون \";\n    } else if (millionsPart === 2) {\n      result += \"مليونان \";\n    } else if (millionsPart < 11) {\n      result += ones[millionsPart] + \" ملايين \";\n    } else {\n      result += numberToArabicWords(millionsPart) + \" مليون \";\n    }\n    num %= 1000000;\n  }\n  \n  // Handle thousands\n  if (num >= 1000) {\n    const thousandsPart = Math.floor(num / 1000);\n    if (thousandsPart === 1) {\n      result += \"ألف \";\n    } else if (thousandsPart === 2) {\n      result += \"ألفان \";\n    } else if (thousandsPart >= 10 && thousandsPart <= 19) {\n      if (thousandsPart === 10) {\n        result += \"عشرة آلاف \";\n      } else {\n        result += teens[thousandsPart - 10] + \" ألف \";\n      }\n    } else if (thousandsPart < 11) {\n      result += ones[thousandsPart] + \" آلاف \";\n    } else {\n      result += numberToArabicWords(thousandsPart) + \" ألف \";\n    }\n    num %= 1000;\n  }\n  \n  // Handle hundreds\n  if (num >= 100) {\n    const hundredsPart = Math.floor(num / 100);\n    result += hundreds[hundredsPart] + \" \";\n    num %= 100;\n  }\n  \n  // Handle tens and ones\n  if (num >= 20) {\n    const tensPart = Math.floor(num / 10);\n    const onesPart = num % 10;\n    if (onesPart > 0) {\n      result += ones[onesPart] + \" و\" + tens[tensPart];\n    } else {\n      result += tens[tensPart];\n    }\n  } else if (num >= 10) {\n    result += teens[num - 10];\n  } else if (num > 0) {\n    result += ones[num];\n  }\n  \n  return result.trim();\n};\nconst getCurrentDates = () => {\n  const now = new Date();\n\n  const hijriFormatter = new Intl.DateTimeFormat(\n    \"ar-SA-u-ca-islamic-umalqura\",\n    {\n      day: \"numeric\",\n      month: \"long\",\n      year: \"numeric\",\n      timeZone: \"Asia/Riyadh\",\n    }\n  );\n\n  let hijriDate = hijriFormatter.format(now);\n\n  hijriDate = hijriDate.replace(/\\s+/g, \" \").trim();\n  hijriDate = hijriDate.replace(\" \", \" من \");\n  if (!hijriDate.includes(\"هـ\")) hijriDate = `${hijriDate} هـ`;\n\n  const gregorianFormatter = new Intl.DateTimeFormat(\"ar-SA-u-ca-gregory\", {\n    day: \"numeric\",\n    month: \"long\",\n    year: \"numeric\",\n    timeZone: \"Asia/Riyadh\",\n  });\n\n  const gregorianDate = gregorianFormatter.format(now);\n\n  return {\n    gregorianDate: `الموافق ${gregorianDate}`,\n    hijriDate,\n  };\n};\n\nconst LoanContractGenerator = React.forwardRef(\n  (\n    {\n      loanData,\n      clientData,\n      templateContent,\n      onContractGenerated,\n      contractType = \"DEBT_ACKNOWLEDGMENT\",\n      autoGenerate = false,\n    },\n    ref\n  ) => {\n    const [contractHtml, setContractHtml] = useState(\"\");\n    const [isGenerating, setIsGenerating] = useState(false);\n\n    const uploadPDFToServer = useCallback(\n      async (pdfBlob) => {\n        try {\n          const formData = new FormData();\n          const filename =\n            contractType === \"DEBT_ACKNOWLEDGMENT\"\n              ? `إقرار الدين_${loanData.id}_${Date.now()}.pdf`\n              : `سند الأمر_${loanData.id}_${Date.now()}.pdf`;\n          formData.append(\"file\", pdfBlob, filename);\n\n          const endpoint =\n            contractType === \"DEBT_ACKNOWLEDGMENT\"\n              ? `/api/loans/${loanData.id}/upload-debt-acknowledgment`\n              : `/api/loans/${loanData.id}/upload-promissory-note`;\n\n          console.log(\"Uploading to endpoint:\", endpoint);\n\n          const response = await Api.post(endpoint, formData, {\n            headers: {\n              \"Content-Type\": \"multipart/form-data\",\n            },\n          });\n\n          console.log(\"Upload response:\", response.data);\n          return response.data;\n        } catch (error) {\n          console.error(\"Error uploading PDF:\", error);\n          throw error;\n        }\n      },\n      [contractType, loanData?.id]\n    );\n\n    const generatePDF = useCallback(\n      async (htmlContent = contractHtml) => {\n        const contentToUse = htmlContent || contractHtml;\n\n        if (!contentToUse) {\n          console.error(\"No contract HTML to generate PDF\");\n          notifyError(\"لا يوجد محتوى عقد لتحويله إلى PDF\");\n          return;\n        }\n\n        try {\n          setIsGenerating(true);\n\n          // إنشاء عنصر ثابت في الصفحة\n          const previewContainer = document.createElement(\"div\");\n          previewContainer.id = `contract-preview-${Date.now()}`;\n          previewContainer.style.width = \"210mm\";\n          previewContainer.style.minHeight = \"297mm\";\n          previewContainer.innerHTML = `\n        <div style=\"\n          font-family: 'Cairo', 'Noto Sans Arabic', sans-serif;\n          padding: 20mm;\n          background: white;\n          direction: rtl;\n        \">\n          ${contentToUse}\n        </div>\n      `;\n          document.body.appendChild(previewContainer);\n\n          const options = {\n            margin: 0,\n            filename: `${contractType.toLowerCase()}_${\n              clientData.id\n            }_${Date.now()}.pdf`,\n            image: { type: \"jpeg\", quality: 1.0 },\n            html2canvas: {\n              scale: 3,\n              useCORS: true,\n              letterRendering: true,\n              allowTaint: true,\n              logging: true,\n              backgroundColor: \"#ffffff\",\n            },\n            jsPDF: {\n              unit: \"mm\",\n              format: \"a4\",\n              orientation: \"portrait\",\n              compress: false,\n              hotfixes: [\"px_scaling\"],\n            },\n          };\n\n          console.log(\"Generating PDF for:\", contractType);\n\n          // انتظر قليلاً للتأكد من تحميل الخطوط والصور\n          await new Promise((resolve) => setTimeout(resolve, 1000));\n\n          // Generate PDF from the preview container\n          const container = document.getElementById(previewContainer.id);\n          const pdfBlob = await html2pdf()\n            .from(container)\n            .set(options)\n            .outputPdf(\"blob\");\n\n          // تنظيف عنصر المعاينة\n          document.body.removeChild(previewContainer);\n\n          await uploadPDFToServer(pdfBlob);\n\n          console.log(\n            \"PDF generated and uploaded successfully for:\",\n            contractType\n          );\n\n          if (onContractGenerated) {\n            onContractGenerated(pdfBlob, contractType);\n          }\n\n          return pdfBlob;\n        } catch (error) {\n          console.error(\"Error generating PDF:\", error);\n          notifyError(\"حدث خطأ أثناء إنشاء ملف PDF\");\n          handleApiError(error);\n          throw error;\n        } finally {\n          setIsGenerating(false);\n        }\n      },\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [contractType, loanData?.id, uploadPDFToServer, onContractGenerated]\n    );\n\n    const generateContract = useCallback(\n      async (generatePdf = autoGenerate, customLoanData = null) => {\n        const loanDataToUse = customLoanData || loanData;\n\n        if (!loanDataToUse || !templateContent) {\n          console.error(\"Missing data:\", {\n            loanDataToUse,\n            templateContent,\n          });\n          notifyError(\"بيانات السلفة أو العميل أو قالب العقد غير متوفر\");\n          return;\n        }\n\n        try {\n          console.log(\"Generating contract:\", contractType);\n          console.log(\"Loan Data to use:\", loanDataToUse);\n\n          const { gregorianDate, hijriDate } = getCurrentDates();\n          const finalDate = `${hijriDate}\\n${gregorianDate}`;\n\n          const amount = loanDataToUse.amount || 0;\n          const amountInWords = numberToArabicWords(amount);\n\n          console.log(\"Amount:\", amount, \"Amount in words:\", amountInWords);\n\n          let filledTemplate = templateContent\n            .replace(/{{اسم_العميل}}/g, clientData.name || \"\")\n            .replace(/{{رقم_هوية_العميل}}/g, clientData.nationalId || \"\")\n            .replace(/{{عنوان_العميل}}/g, clientData.city + \" - \" + clientData.district || \"\")\n\n            .replace(\n              /{{المبلغ_رقما}}/g,\n              `${amount?.toLocaleString(\"en-US\") || \"0\"} ريال سعودي`\n            )\n            .replace(/{{المبلغ_كتابة}}/g, `${amountInWords} ريال سعودي`)\n            .replace(\n              /{{قيمة_السند_رقما}}/g,\n              `${amount?.toLocaleString(\"ar-SA\") || \"0\"} ريال سعودي`\n            )\n            .replace(/{{قيمة_السند_كتابة}}/g, `${amountInWords} ريال سعودي`)\n\n            .replace(/{{التاريخ_الهجري}}/g, hijriDate)\n            .replace(/{{التاريخ_الميلادي}}/g, gregorianDate)\n            .replace(/{{تاريخ_الانشاء}}/g, finalDate)\n            .replace(/{{تاريخ_الاستحقاق}}/g, \"لدي الاطلاع\")\n\n            .replace(/{{اسم_الدائن}}/g, \"أحمد لحول\")\n            .replace(/{{اسم_المدين}}/g, clientData.name || \"\")\n            .replace(/{{رقم_السند}}/g, `LOAN-${Date.now()}`)\n            .replace(/{{رقم_الإقرار}}/g, `ACK-${Date.now()}`)\n            .replace(/{{مدينة_الاصدار}}/g, \"شروة - المملكة العربية السعودية\")\n            .replace(/{{مدينة_الوفاء}}/g, \"الرياض - المملكة العربية السعودية\")\n            .replace(/{{سبب_انشاء_السند}}/g, \"سلفة مالية\")\n\n            .replace(/{{رقم_هوية_الدائن}}/g, \"1234567890\")\n            .replace(/{{رقم_هوية_المدين}}/g, clientData.nationalId || \"\")\n            .replace(/{{رقم_هوية_الكفيل}}/g, clientData.nationalId || \"\")\n            .replace(/{{هوية_الدائن}}/g, \"1234567890\")\n            .replace(/{{هوية_المدين}}/g, clientData.nationalId || \"\")\n            .replace(/{{اسم_الكفيل}}/g, clientData.name || \"\")\n            .replace(/{{هوية_الكفيل}}/g, clientData.nationalId || \"\");\n\n          console.log(\"Filled Template generated successfully\");\n          console.log(\"Filled Template Content:\", filledTemplate);\n          console.log(\"Contract HTML length:\", filledTemplate.length);\n\n          setContractHtml(filledTemplate);\n\n          if (generatePdf) {\n            console.log(\"Auto-generating PDF for:\", contractType);\n\n            setTimeout(async () => {\n              try {\n                await generatePDF(filledTemplate);\n              } catch (error) {\n                console.error(\"Error in auto-generating PDF:\", error);\n              }\n            }, 500);\n\n            return filledTemplate;\n          }\n\n          return filledTemplate;\n        } catch (error) {\n          console.error(\"Error generating contract:\", error);\n          throw error;\n        }\n      },\n      [\n        loanData,\n        clientData,\n        templateContent,\n        contractType,\n        autoGenerate,\n        generatePDF,\n      ]\n    );\n    useEffect(() => {\n      if (autoGenerate && loanData && clientData && templateContent) {\n        console.log(\"Auto-generating contract:\", contractType);\n        generateContract(true);\n      }\n    }, [\n      autoGenerate,\n      loanData,\n      clientData,\n      templateContent,\n      contractType,\n      generateContract,\n    ]);\n\n    React.useImperativeHandle(ref, () => ({\n      generateContract,\n      generatePDF: () => generatePDF(contractHtml),\n    }));\n\n    if (autoGenerate) {\n      return null;\n    }\n\n    return (\n      <div\n        style={{\n          width: \"100%\",\n          border: \"1px solid #ddd\",\n          marginBottom: \"20px\",\n          padding: \"10px\",\n        }}\n      >\n        {isGenerating && (\n          <div\n            style={{\n              textAlign: \"center\",\n              padding: \"20px\",\n              backgroundColor: \"#f5f5f5\",\n            }}\n          >\n            جاري إنشاء PDF...\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nexport default LoanContractGenerator;","import React from 'react';\r\nimport {\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  Button,\r\n  Box,\r\n  Typography,\r\n  IconButton,\r\n  Paper,\r\n  Divider,\r\n  Tabs,\r\n  Tab,\r\n} from '@mui/material';\r\nimport { Close as CloseIcon, Print, Download } from '@mui/icons-material';\r\n\r\nconst LoanContractsPreview = ({ \r\n  open, \r\n  onClose, \r\n  debtAckHtml, \r\n  promissoryNoteHtml, \r\n  onSaveContracts, \r\n  loading = false,\r\n  clientName = \"\",\r\n  loanAmount = 0\r\n}) => {\r\n  const [activeTab, setActiveTab] = React.useState(0);\r\n\r\n  const handleTabChange = (event, newValue) => {\r\n    setActiveTab(newValue);\r\n  };\r\n\r\n  const handlePrint = () => {\r\n    const contractElement = document.getElementById(`contract-tab-${activeTab}`);\r\n    if (contractElement) {\r\n      const printWindow = window.open('', '_blank');\r\n      printWindow.document.write(`\r\n        <html>\r\n          <head>\r\n            <title>${activeTab === 0 ? ' إقرار الدين' : 'سند الأمر'}</title>\r\n            <style>\r\n              body { \r\n                font-family: \"Noto Sans Arabic\", \"Cairo\", sans-serif;\r\n                margin: 0;\r\n                padding: 20px;\r\n                direction: rtl;\r\n              }\r\n              .contract-content { \r\n                max-width: 900px; \r\n                margin: 0 auto; \r\n                border: 1px solid #ddd;\r\n                padding: 30px;\r\n                border-radius: 12px;\r\n                background: #fff;\r\n              }\r\n              @media print {\r\n                body { padding: 0; }\r\n                .contract-content { \r\n                  border: none; \r\n                  box-shadow: none;\r\n                  padding: 15px;\r\n                }\r\n              }\r\n            </style>\r\n          </head>\r\n          <body>\r\n            <div class=\"contract-content\">\r\n              ${contractElement.innerHTML}\r\n            </div>\r\n          </body>\r\n        </html>\r\n      `);\r\n      printWindow.document.close();\r\n      printWindow.focus();\r\n      setTimeout(() => {\r\n        printWindow.print();\r\n        printWindow.close();\r\n      }, 500);\r\n    }\r\n  };\r\n\r\n  const contracts = [\r\n    { \r\n      name: 'إقرار الدين', \r\n      html: debtAckHtml,\r\n      id: 'debt-acknowledgment'\r\n    },\r\n    { \r\n      name: 'سند الأمر', \r\n      html: promissoryNoteHtml,\r\n      id: 'promissory-note'\r\n    }\r\n  ];\r\n\r\n  return (\r\n    <Dialog \r\n      open={open} \r\n      onClose={onClose}\r\n      maxWidth=\"lg\"\r\n      fullWidth\r\n      fullScreen={true}\r\n      dir=\"rtl\"\r\n      PaperProps={{\r\n        sx: {\r\n          borderRadius: 2,\r\n          maxHeight: '100vh'\r\n        }\r\n      }}\r\n    >\r\n      <DialogTitle \r\n        className=\"no-print\"\r\n        sx={{ \r\n          display: 'flex', \r\n          justifyContent: 'space-between', \r\n          alignItems: 'center',\r\n          pb: 1,\r\n          borderBottom: '1px solid #e0e0e0',\r\n          '@media print': {\r\n            display: 'none !important'\r\n          }\r\n        }}\r\n      >\r\n        <Box>\r\n          <Typography variant=\"h6\" fontWeight=\"bold\">\r\n            معاينة عقود السلفة\r\n          </Typography>\r\n          {clientName && (\r\n            <Typography variant=\"body2\" color=\"text.secondary\">\r\n              العميل: {clientName} - المبلغ: {loanAmount.toLocaleString()} ر.س\r\n            </Typography>\r\n          )}\r\n        </Box>\r\n        <IconButton onClick={onClose} size=\"small\">\r\n          <CloseIcon />\r\n        </IconButton>\r\n      </DialogTitle>\r\n\r\n      {/* Tabs */}\r\n      <Box \r\n        className=\"no-print\"\r\n        sx={{ \r\n          borderBottom: 1, \r\n          borderColor: 'divider',\r\n          '@media print': {\r\n            display: 'none !important'\r\n          }\r\n        }}\r\n      >\r\n        <Tabs value={activeTab} onChange={handleTabChange} centered>\r\n          <Tab \r\n            label=\"إقرار الدين\" \r\n            sx={{\r\n              fontWeight: activeTab === 0 ? 'bold' : 'normal',\r\n              color: activeTab === 0 ? '#0d40a5' : 'text.secondary'\r\n            }}\r\n          />\r\n          <Tab \r\n            label=\"سند الأمر\" \r\n            sx={{\r\n              fontWeight: activeTab === 1 ? 'bold' : 'normal',\r\n              color: activeTab === 1 ? '#0d40a5' : 'text.secondary'\r\n            }}\r\n          />\r\n        </Tabs>\r\n      </Box>\r\n\r\n      <DialogContent sx={{ \r\n        p: 0,\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        '@media print': {\r\n          p: 0,\r\n          m: 0\r\n        }\r\n      }}>\r\n        {contracts.map((contract, index) => (\r\n          <Box\r\n            key={contract.id}\r\n            id={`contract-tab-${index}`}\r\n            sx={{\r\n              display: activeTab === index ? 'block' : 'none',\r\n              '@media print': {\r\n                display: 'block !important',\r\n                pageBreakAfter: index === 0 ? 'always' : 'auto'\r\n              }\r\n            }}\r\n          >\r\n            <Paper \r\n              sx={{ \r\n                m: 3, \r\n                p: 4, \r\n                minHeight: '500px',\r\n                bgcolor: 'white',\r\n                boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)',\r\n                border: '1px solid #e0e0e0',\r\n                '@media print': {\r\n                  m: 0,\r\n                  p: 2,\r\n                  boxShadow: 'none',\r\n                  border: 'none',\r\n                  minHeight: 'auto',\r\n                  pageBreakInside: 'avoid'\r\n                }\r\n              }}\r\n            >\r\n              {contract.html ? (\r\n                <Box\r\n                  dangerouslySetInnerHTML={{ __html: contract.html }}\r\n                  sx={{\r\n                    '& *': {\r\n                      fontFamily: '\"Noto Sans Arabic\", \"Cairo\", \"Segoe UI\", sans-serif !important',\r\n                      lineHeight: 1.8\r\n                    },\r\n                    '& h1, & h2, & h3': {\r\n                      textAlign: 'center',\r\n                      color: '#1976d2',\r\n                      marginBottom: '20px'\r\n                    },\r\n                    '& p': {\r\n                      marginBottom: '15px',\r\n                      textAlign: 'justify'\r\n                    },\r\n                    '& strong': {\r\n                      color: '#1976d2',\r\n                      fontWeight: 'bold'\r\n                    }\r\n                  }}\r\n                />\r\n              ) : (\r\n                <Box sx={{ \r\n                  display: 'flex', \r\n                  justifyContent: 'center', \r\n                  alignItems: 'center', \r\n                  height: '400px',\r\n                  flexDirection: 'column',\r\n                  color: 'text.secondary'\r\n                }}>\r\n                  <Typography variant=\"h6\" mb={2}>\r\n                    لا يوجد محتوى للعرض\r\n                  </Typography>\r\n                  <Typography variant=\"body2\">\r\n                    يرجى التأكد من وجود قالب العقد وبيانات العميل\r\n                  </Typography>\r\n                </Box>\r\n              )}\r\n            </Paper>\r\n          </Box>\r\n        ))}\r\n      </DialogContent>\r\n\r\n      <Divider className=\"no-print\" />\r\n      \r\n      <DialogActions \r\n        className=\"no-print\"\r\n        sx={{ \r\n          p: 3, \r\n          gap: 2,\r\n          flexDirection: 'row-reverse',\r\n          bgcolor: '#fafafa',\r\n          '@media print': {\r\n            display: 'none !important'\r\n          }\r\n        }}\r\n      >\r\n        <Button \r\n          onClick={onClose}\r\n          disabled={loading}\r\n          variant=\"outlined\"\r\n          sx={{ \r\n            minWidth: '100px',\r\n            borderColor: 'grey.300',\r\n            color: 'text.secondary',\r\n            '&:hover': {\r\n              borderColor: 'grey.400',\r\n              bgcolor: 'grey.50'\r\n            }\r\n          }}\r\n        >\r\n          إغلاق\r\n        </Button>\r\n        \r\n        <Button\r\n          variant=\"outlined\"\r\n          startIcon={<Print sx={{marginLeft: '10px'}} />}\r\n          onClick={handlePrint}\r\n          disabled={loading || !contracts[activeTab]?.html}\r\n          sx={{ \r\n            minWidth: '120px',\r\n            borderColor: '#1976d2',\r\n            color: '#1976d2',\r\n            '&:hover': {\r\n              borderColor: '#1565c0',\r\n              bgcolor: '#e3f2fd'\r\n            }\r\n          }}\r\n        >\r\n          طباعة\r\n        </Button>\r\n        \r\n        <Button\r\n          variant=\"contained\"\r\n          startIcon={<Download sx={{marginLeft: '10px'}} />}\r\n          onClick={() => onSaveContracts(contracts[activeTab].id)}\r\n          disabled={loading || !contracts[activeTab]?.html}\r\n          sx={{\r\n            bgcolor: \"#0d40a5\",\r\n            \"&:hover\": { bgcolor: \"#0b3589\" },\r\n            minWidth: '140px'\r\n          }}\r\n        >\r\n          {loading ? 'جاري الحفظ...' : 'حفظ العقد'}\r\n        </Button>\r\n\r\n        <Button\r\n          variant=\"contained\"\r\n          startIcon={<Download sx={{marginLeft: '10px'}} />}\r\n          onClick={() => onSaveContracts('both')}\r\n          disabled={loading || !debtAckHtml || !promissoryNoteHtml}\r\n          sx={{\r\n            bgcolor: \"#2e7d32\",\r\n            \"&:hover\": { bgcolor: \"#1b5e20\" },\r\n            minWidth: '180px'\r\n          }}\r\n        >\r\n          {loading ? 'جاري الحفظ...' : 'حفظ كلا العقدين'}\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default LoanContractsPreview;","import React, { useState, useEffect, useRef } from \"react\";\nimport {\n  Box,\n  Typography,\n  Grid,\n  TextField,\n  Button,\n  Paper,\n  Stack,\n  Tooltip,\n  Divider,\n  Tabs,\n  Tab,\n  Autocomplete,\n  CircularProgress,\n  MenuItem,\n  Alert,\n  Chip,\n\n} from \"@mui/material\";\nimport { Close as CloseIcon } from \"@mui/icons-material\";\nimport { debounce } from \"lodash\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  getClients,\n  createLoan,\n  getLoanById,\n  updateLoan,\n  getPartners,\n} from \"./loanApis\";\nimport { getBanks } from \"../Banks/bankApis\";\nimport { notifySuccess, notifyError } from \"../../utilities/toastify\";\nimport LoansTable from \"../../components/modals/LoansTable\";\nimport AddClient from \"../../components/modals/AddClient\";\nimport LoanContractGenerator from \"../../components/LoanContractGenerator\";\nimport LoanContractsPreview from \"../../components/LoanContractsPreview\";\nimport Api from \"../../config/Api\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Helmet } from \"react-helmet-async\";\nimport { usePermissions } from \"../../components/Contexts/PermissionsContext\";\nconst Loans = () => {\n  const navigate = useNavigate();\n  const [activeTab, setActiveTab] = useState(0);\n  const [selectedClient, setSelectedClient] = useState(null);\n  const [selectedBank, setSelectedBank] = useState(null);\n  const [selectedPartner, setSelectedPartner] = useState(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [banksSearchQuery, setBanksSearchQuery] = useState(\"\");\n  const [partnersSearchQuery, setPartnersSearchQuery] = useState(\"\");\n  const [clientsPage, setClientsPage] = useState(1);\n  const [banksPage, setBanksPage] = useState(1);\n  const [partnersPage, setPartnersPage] = useState(1);\n  const [isAddClientOpen, setIsAddClientOpen] = useState(false);\n\n  const [loanForm, setLoanForm] = useState({\n    amount: \"\",\n    interestRate: \"\",\n    durationMonths: \"\",\n    type: \"\",\n    startDate: new Date().toISOString().split(\"T\")[0],\n    repaymentDay: \"\",\n  });\n\n  const [selectedLoan, setSelectedLoan] = useState(null);\n  const [installments, setInstallments] = useState([]);\n  const [isEditMode, setIsEditMode] = useState(false);\n  const [isViewMode, setIsViewMode] = useState(false);\n  const queryClient = useQueryClient();\n  // eslint-disable-next-line no-unused-vars\n  const [generateContracts, setGenerateContracts] = useState(true);\n  const [savedLoanData, setSavedLoanData] = useState(null);\n  const [debtAckTemplate, setDebtAckTemplate] = useState(\"\");\n  const [promissoryNoteTemplate, setPromissoryNoteTemplate] = useState(\"\");\n  const [contractsGenerated, setContractsGenerated] = useState(0);\n  const [previewOpen, setPreviewOpen] = useState(false);\n  const [previewContracts, setPreviewContracts] = useState({\n    debtAck: \"\",\n    promissoryNote: \"\",\n  });\n  const [isCreatingLoan, setIsCreatingLoan] = useState(false);\n  const { permissions } = usePermissions(); \n  const debtAckGeneratorRef = useRef(null);\n  const promissoryNoteGeneratorRef = useRef(null);\n\n  const { data: clientsData, isLoading: isClientsLoading } = useQuery({\n    queryKey: [\"clients\", clientsPage, searchQuery],\n    queryFn: () => getClients(clientsPage, searchQuery),\n    enabled: activeTab === 1,\n  });\n\n  const { data: banksData, isLoading: isBanksLoading } = useQuery({\n    queryKey: [\"banks\", banksPage, banksSearchQuery],\n    queryFn: () => getBanks(banksPage, banksSearchQuery),\n    enabled: activeTab === 1,\n  });\n\n  const { data: partnersData, isLoading: isPartnersLoading } = useQuery({\n    queryKey: [\"partners\", partnersPage, partnersSearchQuery],\n    queryFn: () => getPartners(partnersPage, partnersSearchQuery),\n    enabled: activeTab === 1,\n  });\n\n  useEffect(() => {\n    if (activeTab === 1) {\n      fetchContractTemplates();\n      calculateInstallments();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [activeTab]);\n\n  const fetchContractTemplates = async () => {\n    try {\n      console.log(\"Fetching contract templates...\");\n      const [debtResponse, promissoryResponse] = await Promise.all([\n        Api.get(\"/api/templates/DEBT_ACKNOWLEDGMENT\"),\n        Api.get(\"/api/templates/PROMISSORY_NOTE\"),\n      ]);\n\n      setDebtAckTemplate(debtResponse.data.content || \"\");\n      setPromissoryNoteTemplate(promissoryResponse.data.content || \"\");\n\n      console.log(\"Templates fetched successfully\");\n    } catch (error) {\n      console.warn(\"Could not fetch contract templates:\", error);\n    }\n  };\n\n  useEffect(() => {\n    if (activeTab === 1) {\n      calculateInstallments();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    loanForm.amount,\n    loanForm.interestRate,\n    loanForm.durationMonths,\n    activeTab,\n  ]);\n\n  const debouncedSearch = debounce((value) => {\n    setSearchQuery(value);\n    setClientsPage(1);\n  }, 500);\n\n  const debouncedBanksSearch = debounce((value) => {\n    setBanksSearchQuery(value);\n    setBanksPage(1);\n  }, 500);\n\n  const debouncedPartnersSearch = debounce((value) => {\n    setPartnersSearchQuery(value);\n    setPartnersPage(1);\n  }, 500);\n\n  const handleSearchChange = (event, value) => {\n    debouncedSearch(value);\n  };\n\n  const handleBanksSearchChange = (event, value) => {\n    debouncedBanksSearch(value);\n  };\n\n  const handlePartnersSearchChange = (event, value) => {\n    debouncedPartnersSearch(value);\n  };\n\n  const handleClientSelect = (event, newValue) => {\n    setSelectedClient(newValue);\n  };\n\n  const handleBankSelect = (event, newValue) => {\n    setSelectedBank(newValue);\n  };\n\n  const handlePartnerSelect = (event, newValue) => {\n    setSelectedPartner(newValue);\n  };\n\n  const formatAmount = (amount) => {\n    if (!amount) return \"\";\n    return amount.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n  };\n\n  const handleOpenPreview = async () => {\n    try {\n      if (!selectedClient || !loanForm.amount) {\n        notifyError(\"يرجى ملء بيانات العميل والسلفة أولاً\");\n        return;\n      }\n\n      const previewLoanData = {\n        id: `preview-${Date.now()}`,\n        amount: parseFloat(loanForm.amount.replace(/,/g, \"\")),\n        durationMonths: parseInt(loanForm.durationMonths),\n        startDate: loanForm.startDate,\n        client: selectedClient.client,\n      };\n\n      const debtAckHtml = await debtAckGeneratorRef.current.generateContract(\n        false,\n        previewLoanData\n      );\n      const promissoryNoteHtml =\n        await promissoryNoteGeneratorRef.current.generateContract(\n          false,\n          previewLoanData\n        );\n\n      setPreviewContracts({\n        debtAck: debtAckHtml,\n        promissoryNote: promissoryNoteHtml,\n      });\n      setPreviewOpen(true);\n    } catch (error) {\n      console.error(\"Error generating preview:\", error);\n      notifyError(\"حدث خطأ أثناء توليد معاينة العقود\");\n    }\n  };\n\n  const handleSaveContracts = async (contractType) => {\n    try {\n      if (!savedLoanData) {\n        notifyError(\"لم يتم إنشاء السلفة بعد. يرجى إنشاء السلفة أولاً\");\n        return;\n      }\n  \n      console.log(\"Saving contracts for loan:\", savedLoanData.id);\n      \n      if (contractType === \"both\" || contractType === \"debt-acknowledgment\") {\n        console.log(\"Generating debt acknowledgment...\");\n        await debtAckGeneratorRef.current?.generatePDF();\n      }\n      \n      if (contractType === \"both\" || contractType === \"promissory-note\") {\n        console.log(\"Generating promissory note...\");\n        await promissoryNoteGeneratorRef.current?.generatePDF();\n      }\n  \n      notifySuccess(\"تم حفظ العقود بنجاح\");\n      setSavedLoanData(null);\n      setContractsGenerated(0);\n      setPreviewContracts({\n        debtAck: \"\",\n        promissoryNote: \"\",\n      });\n      setPreviewOpen(false);\n      setInstallments([]);\n      setIsEditMode(false);\n      setIsViewMode(false);\n      setActiveTab(0);\n    } catch (error) {\n      console.error(\"Error saving contracts:\", error);\n      notifyError(\"حدث خطأ أثناء حفظ العقود\");\n    }\n  };\n\n  const calculateInstallments = () => {\n    const amount = parseFloat(loanForm.amount.replace(/,/g, \"\")) || 0;\n    const interestRate = parseFloat(loanForm.interestRate) || 0;\n    const durationMonths = parseInt(loanForm.durationMonths) || 0;\n    const loanType = loanForm.type;\n\n    if (amount > 0 && durationMonths > 0) {\n      const profit = amount * (interestRate / 100);\n      const total = amount + profit;\n\n      const repaymentCount =\n        loanType === \"DAILY\"\n          ? durationMonths * 30\n          : loanType === \"WEEKLY\"\n          ? durationMonths * 4\n          : durationMonths;\n\n      const installmentAmount = total / repaymentCount;\n      const principalPerInstallment = amount / repaymentCount;\n      const interestPerInstallment = profit / repaymentCount;\n\n      const calculatedInstallments = [];\n      let remainingBalance = total;\n\n      for (let i = 1; i <= repaymentCount; i++) {\n        const dueDate = new Date(loanForm.startDate);\n        if (loanType === \"DAILY\") {\n          dueDate.setDate(dueDate.getDate() + i);\n        } else if (loanType === \"WEEKLY\") {\n          dueDate.setDate(dueDate.getDate() + i * 7);\n        } else {\n          dueDate.setMonth(dueDate.getMonth() + i);\n          if (loanForm.repaymentDay) {\n            dueDate.setDate(parseInt(loanForm.repaymentDay));\n          }\n        }\n\n        remainingBalance -= installmentAmount;\n\n        calculatedInstallments.push({\n          installmentNumber: i,\n          dueDate: dueDate,\n          principal: principalPerInstallment,\n          interest: interestPerInstallment,\n          installment: installmentAmount,\n          remainingBalance: Math.max(0, remainingBalance),\n          status: \"PENDING\",\n          paidAmount: 0,\n        });\n      }\n\n      setInstallments(calculatedInstallments);\n    } else {\n      setInstallments([]);\n    }\n  };\n\n  const getSimulationSummary = () => {\n    if (installments.length === 0) return null;\n\n    const totalInterest = installments.reduce(\n      (sum, inst) => sum + inst.interest,\n      0\n    );\n    const totalAmount =\n      (parseFloat(loanForm.amount.replace(/,/g, \"\")) || 0) + totalInterest;\n    const monthlyInstallment = installments[0]?.installment || 0;\n\n    return {\n      monthlyInstallment,\n      totalInterest,\n      totalAmount,\n    };\n  };\n\n  const handleCreateLoan = async () => {\n    if (!selectedClient) {\n      notifyError(\"يرجى اختيار عميل\");\n      return;\n    }\n  \n    try {\n      setIsCreatingLoan(true);\n  \n      const loanData = {\n        clientId: selectedClient.client.id,\n        amount: parseFloat(loanForm.amount.replace(/,/g, \"\")),\n        interestRate: parseFloat(loanForm.interestRate),\n        durationMonths: parseInt(loanForm.durationMonths),\n        type: loanForm.type,\n        startDate: loanForm.startDate,\n        repaymentDay: parseInt(loanForm.repaymentDay),\n        bankAccountId: selectedBank?.id || null,\n        partnerId: selectedPartner?.id || null,\n      };\n  \n      console.log(\"Creating loan with data:\", loanData);\n  \n      const response = await createLoan(loanData);\n      const newLoan = response?.data?.loan || response?.loan;\n  \n      console.log(\"Loan created successfully:\", newLoan);\n      notifySuccess(\"تم إنشاء السلفة بنجاح\");\n  \n      setSavedLoanData({\n        ...newLoan,\n        client: selectedClient.client,\n      });\n      \n      queryClient.invalidateQueries([\"loans\"]);\n      \n    } catch (error) {\n      console.error(\"Error creating loan:\", error);\n      notifyError(\n        error.response?.data?.message || \"حدث خطأ أثناء إنشاء السلفة\"\n      );\n    } finally {\n      setIsCreatingLoan(false);\n    }\n  };\n\n  const handleContractGenerated = (pdfBlob, contractType) => {\n    console.log(`Contract generated: ${contractType}`);\n    const newCount = contractsGenerated + 1;\n    setContractsGenerated(newCount);\n  };\n\n  const resetLoanForm = () => {\n    setSelectedClient(null);\n    setSelectedLoan(null);\n    setSelectedBank(null);\n    setSelectedPartner(null);\n    setLoanForm({\n      amount: \"\",\n      interestRate: \"\",\n      durationMonths: \"\",\n      type: \"\",\n      startDate: new Date().toISOString().split(\"T\")[0],\n      repaymentDay: \"10\",\n    });\n    setInstallments([]);\n    setIsEditMode(false);\n    setIsViewMode(false);\n    setContractsGenerated(0);\n    setSavedLoanData(null);\n    setIsCreatingLoan(false);\n  };\n\n  const handleUpdateLoan = async () => {\n    if (!selectedLoan) {\n      notifyError(\"لا يوجد سلفة محددة للتعديل\");\n      return;\n    }\n\n    try {\n      const loanData = {\n        amount: parseFloat(loanForm.amount.replace(/,/g, \"\")),\n        interestRate: parseFloat(loanForm.interestRate),\n        durationMonths: parseInt(loanForm.durationMonths),\n        type: loanForm.type,\n        startDate: loanForm.startDate,\n        repaymentDay: parseInt(loanForm.repaymentDay),\n        bankAccountId: selectedBank?.id || null,\n        partnerId: selectedPartner?.id || null,\n      };\n\n      await updateLoan(selectedLoan.id, loanData);\n      notifySuccess(\"تم تعديل السلفة بنجاح\");\n\n      resetLoanForm();\n      queryClient.invalidateQueries([\"loans\"]);\n      setActiveTab(0);\n    } catch (error) {\n      notifyError(\n        error.response?.data?.message || \"حدث خطأ أثناء تعديل السلفة\"\n      );\n    }\n  };\n\n  const handleViewLoanDetails = async (loanId) => {\n    try {\n      const loan = await getLoanById(loanId);\n      setSelectedLoan(loan);\n      setIsViewMode(true);\n      setIsEditMode(false);\n\n      if (loan.client) {\n        setSelectedClient({ client: loan.client });\n      }\n\n      if (loan.bankAccount) {\n        setSelectedBank(loan.bankAccount);\n      }\n\n      if (loan.partner) {\n        setSelectedPartner(loan.partner);\n      }\n\n      const repaymentCount =\n        loan.type === \"DAILY\"\n          ? loan.durationMonths * 30\n          : loan.type === \"WEEKLY\"\n          ? loan.durationMonths * 4\n          : loan.durationMonths;\n\n      const principalPerInstallment = loan.amount / repaymentCount;\n      const interestPerInstallment = loan.interestAmount / repaymentCount;\n\n      let remainingBalance = loan.totalAmount;\n      const formattedRepayments = loan.repayments.map((repayment, index) => {\n        const currentInstallment = {\n          installmentNumber: index + 1,\n          dueDate: repayment.dueDate,\n          principal: principalPerInstallment,\n          interest: interestPerInstallment,\n          installment: repayment.amount,\n          remainingBalance: Math.max(0, remainingBalance),\n          status: repayment.status,\n          paidAmount: repayment.paidAmount || 0,\n        };\n\n        remainingBalance -= repayment.amount;\n        return currentInstallment;\n      });\n\n      setInstallments(formattedRepayments);\n\n      setLoanForm({\n        amount: loan.amount.toString(),\n        interestRate: loan.interestRate.toString(),\n        durationMonths: loan.durationMonths.toString(),\n        type: loan.type,\n        startDate: loan.startDate.split(\"T\")[0],\n        repaymentDay: loan.repaymentDay?.toString() || \"10\",\n      });\n\n      setActiveTab(1);\n    } catch (error) {\n      notifyError(\n        error.response?.data?.message || \"حدث خطأ أثناء تحميل بيانات السلفة\"\n      );\n    }\n  };\n\n  // تحديث الدالة لفتح صفحة الأقساط\n  const handleViewInstallments = (loan) => {\n    navigate(`/installments/${loan.id}`);\n  };\n\n  const handleEditLoan = () => {\n    if (selectedLoan.status !== \"PENDING\") {\n      notifyError(\"يمكن تعديل القروض في حالة 'قيد المراجعة' فقط\");\n      return;\n    }\n    setIsEditMode(true);\n    setIsViewMode(false);\n  };\n\n  const handleInputChange = (field, value) => {\n    if (field === \"amount\") {\n      const rawValue = value.replace(/,/g, \"\");\n      if (!isNaN(rawValue)) {\n        value = formatAmount(rawValue);\n      }\n    }\n    setLoanForm((prev) => ({\n      ...prev,\n      [field]: value,\n    }));\n  };\n\n  const handleSaveLoan = () => {\n    if (isEditMode) {\n      handleUpdateLoan();\n    } else {\n      handleCreateLoan();\n    }\n  };\n\n  const simulationSummary = getSimulationSummary();\n\n  const isFormValid = () => {\n    return selectedClient && \n           loanForm.amount && \n           loanForm.interestRate && \n           loanForm.durationMonths && \n           loanForm.repaymentDay && \n           loanForm.type;\n  };\n\n  const canEditLoan = selectedLoan && selectedLoan.status === \"PENDING\";\n  const isReadOnlyMode = isViewMode && selectedLoan && selectedLoan.status !== \"PENDING\";\n\n  return (\n    <Box\n      sx={{\n        bgcolor: \"#f6f6f8\",\n        minHeight: \"100vh\",\n        display: \"flex\",\n        flexDirection: \"column\",\n      }}\n    >\n      <Helmet>\n        <title>السلف</title>\n        <meta name=\"description\" content=\"السلف\" />\n      </Helmet>\n      <Box\n        sx={{\n          display: \"flex\",\n          flexDirection: \"row-reverse\",\n          flex: 1,\n          height: \"calc(100vh - 80px)\",\n          width: \"100%\",\n        }}\n      >\n        {activeTab === 1 && (\n          <Box\n            sx={{\n              width: \"350px\",\n              borderRight: \"1px solid #ddd\",\n              bgcolor: \"#fafafa\",\n              height: \"100%\",\n              overflowY: \"auto\",\n              flexShrink: 0,\n            }}\n          >\n            <Box\n              sx={{ p: 3, borderBottom: \"1px solid #ddd\", bgcolor: \"#fafafa\" }}\n            >\n              <Typography variant=\"h6\" fontWeight=\"bold\" mb={3}>\n                محاكاة السلفة\n              </Typography>\n              {simulationSummary ? (\n                <Stack spacing={3}>\n                  <Box\n                    sx={{\n                      display: \"flex\",\n                      justifyContent: \"space-between\",\n                      alignItems: \"center\",\n                    }}\n                  >\n                    <Typography color=\"text.secondary\">القسط الشهري</Typography>\n                    <Typography\n                      color=\"#0d40a5\"\n                      fontWeight=\"bold\"\n                      fontSize=\"20px\"\n                    >\n                      {formatAmount(\n                        simulationSummary.monthlyInstallment.toFixed(2)\n                      )}{\" \"}\n                      ر.س\n                    </Typography>\n                  </Box>\n\n                  <Box\n                    sx={{\n                      display: \"flex\",\n                      justifyContent: \"space-between\",\n                      alignItems: \"center\",\n                    }}\n                  >\n                    <Typography color=\"text.secondary\">\n                      إجمالي الفائدة\n                    </Typography>\n                    <Typography color=\"#333\" fontSize=\"16px\">\n                      {formatAmount(simulationSummary.totalInterest.toFixed(2))}{\" \"}\n                      ر.س\n                    </Typography>\n                  </Box>\n\n                  <Box\n                    sx={{\n                      display: \"flex\",\n                      justifyContent: \"space-between\",\n                      alignItems: \"center\",\n                    }}\n                  >\n                    <Typography color=\"text.secondary\">\n                      المبلغ الإجمالي المستحق\n                    </Typography>\n                    <Typography color=\"#333\" fontSize=\"16px\">\n                      {formatAmount(simulationSummary.totalAmount.toFixed(2))}{\" \"}\n                      ر.س\n                    </Typography>\n                  </Box>\n\n                  <Divider />\n\n                  <Box\n                    sx={{\n                      display: \"flex\",\n                      justifyContent: \"space-between\",\n                      alignItems: \"center\",\n                    }}\n                  >\n                    <Typography color=\"text.secondary\">حالة السلفة</Typography>\n                    <Chip\n                      label={\n                        isViewMode ? \"عرض\" : \n                        isEditMode ? \"تحت التعديل\" : \n                        \"جديد\"\n                      }\n                      sx={{\n                        backgroundColor: \n                          isViewMode ? \"rgba(100, 100, 100, 0.2)\" :\n                          isEditMode ? \"rgba(214, 158, 46, 0.2)\" : \n                          \"rgba(56, 161, 105, 0.2)\",\n                        color: \n                          isViewMode ? \"#666\" :\n                          isEditMode ? \"#D69E2E\" : \n                          \"#38A169\",\n                        fontWeight: \"bold\",\n                      }}\n                    />\n                  </Box>\n                </Stack>\n              ) : (\n                <Alert severity=\"info\">أدخل بيانات السلفة لعرض المحاكاة</Alert>\n              )}\n            </Box>\n\n            <Box sx={{ p: 3 }}>\n              <Typography variant=\"h6\" fontWeight=\"bold\" mb={3}>\n                الإجراءات\n              </Typography>\n              <Stack spacing={2}>\n                {!isViewMode && (\n                  <Button\n                    variant=\"contained\"\n                    onClick={handleSaveLoan}\n                    disabled={!isFormValid()}\n                    sx={{\n                      bgcolor: \"#0d40a5\",\n                      height: \"48px\",\n                      fontSize: \"16px\",\n                      fontWeight: \"bold\",\n                      \"&:hover\": { bgcolor: \"rgba(13, 64, 165, 0.9)\" },\n                    }}\n                  >\n                    {isEditMode ? \"حفظ التعديلات\" : \"إنشاء السلفة\"}\n                  </Button>\n                )}\n\n                {isViewMode && canEditLoan && (\n                  <Button\n                    variant=\"contained\"\n                    onClick={handleEditLoan}\n                    sx={{\n                      bgcolor: \"primary.main\",\n                      height: \"48px\",\n                      fontSize: \"16px\",\n                      fontWeight: \"bold\",\n                      \"&:hover\": { bgcolor: \"primary.dark\" },\n                    }}\n                  >\n                    تعديل السلفة\n                  </Button>\n                )}\n\n                <Button\n                  variant=\"outlined\"\n                  onClick={handleOpenPreview}\n                  disabled={!savedLoanData}\n                  sx={{\n                    borderColor: \"#0d40a5\",\n                    color: \"#0d40a5\",\n                    height: \"48px\",\n                    fontSize: \"16px\",\n                    fontWeight: \"bold\",\n                    \"&:hover\": { bgcolor: \"rgba(13, 64, 165, 0.1)\" },\n                  }}\n                >\n                  معاينة العقود\n                </Button>\n                \n                {isEditMode && (\n                  <Button\n                    variant=\"outlined\"\n                    onClick={() => {\n                      setIsEditMode(false);\n                      setIsViewMode(true);\n                    }}\n                    sx={{\n                      borderColor: \"rgba(255, 0, 0, 0.5)\",\n                      color: \"error.main\",\n                      height: \"48px\",\n                      fontSize: \"16px\",\n                      fontWeight: \"bold\",\n                      \"&:hover\": { bgcolor: \"rgba(255, 0, 0, 0.1)\" },\n                    }}\n                  >\n                    إلغاء التعديل\n                  </Button>\n                )}\n              </Stack>\n            </Box>\n          </Box>\n        )}\n\n        <Box\n          sx={{\n            flex: 1,\n            p: 4,\n            bgcolor: \"#fff\",\n            overflowY: \"auto\",\n            width: \"100%\",\n          }}\n        >\n          <Box sx={{ width: \"100%\" }}>\n            <Box sx={{ borderBottom: 1, borderColor: \"divider\", mb: 4 }}>\n              <Tabs\n                value={activeTab}\n                onChange={(e, newValue) => {\n                  setActiveTab(newValue);\n                  if (newValue === 0) {\n                    resetLoanForm();\n                  }\n                }}\n              >\n                <Tab\n                  label=\"عرض جميع السلف\"\n                  sx={{\n                    fontWeight: \"bold\",\n                    borderBottom:\n                      activeTab === 0 ? \"3px solid #0d40a5\" : \"none\",\n                    color: activeTab === 0 ? \"#0d40a5\" : \"text.secondary\",\n                  }}\n                />\n                {permissions.includes(\"loans_Add\") && (\n                <Tab\n                  label={\n                    isViewMode ? \"عرض تفاصيل السلفة\" : \n                    isEditMode ? \"تعديل السلفة\" : \n                    \"إنشاء سلفة جديدة\"\n                  }\n                  sx={{\n                    fontWeight: \"bold\",\n                    borderBottom:\n                      activeTab === 1 ? \"3px solid #0d40a5\" : \"none\",\n                    color: activeTab === 1 ? \"#0d40a5\" : \"text.secondary\",\n                  }}\n                />\n                )}\n              </Tabs>\n            </Box>\n\n            {activeTab === 0 ? (\n              <Box\n                sx={{ width: \"100%\", display: \"flex\", flexDirection: \"column\" }}\n              >\n                <LoansTable \n                  onViewDetails={handleViewLoanDetails} \n                  onViewInstallments={handleViewInstallments}\n                />\n              </Box>\n            ) : (\n              <Box>\n                {permissions.includes(\"loans_Add\") && (\n                <Paper\n                  sx={{\n                    p: 4,\n                    mb: 3,\n                    borderRadius: 2,\n                    border: \"1px solid #e5e7eb\",\n                  }}\n                >\n                  <Typography\n                    variant=\"h6\"\n                    fontWeight=\"bold\"\n                    color=\"#333\"\n                    mb={3}\n                    textAlign=\"center\"\n                  >\n                    معلومات العميل\n                  </Typography>\n                  <Grid container spacing={3} justifyContent=\"center\">\n                    <Grid item xs={12} md={8}>\n                      <Autocomplete\n                        options={clientsData?.clients || []}\n                        getOptionLabel={(option) =>\n                          `${option.client.name} - ${option.client.nationalId}`\n                        }\n                        value={selectedClient}\n                        onChange={handleClientSelect}\n                        onInputChange={handleSearchChange}\n                        loading={isClientsLoading}\n                        disabled={isViewMode || isEditMode}\n                        renderInput={(params) => (\n                          <TextField\n                            {...params}\n                            label=\"اختر عميل حالي\"\n                            placeholder=\"ابحث بالاسم أو رقم الهوية\"\n                            InputProps={{\n                              ...params.InputProps,\n                              endAdornment: (\n                                <>\n                                  {isClientsLoading ? (\n                                    <CircularProgress\n                                      color=\"inherit\"\n                                      size={20}\n                                    />\n                                  ) : null}\n                                  {params.InputProps.endAdornment}\n                                </>\n                              ),\n                            }}\n                            sx={{\n                              \"& .MuiOutlinedInput-root\": {\n                                height: \"56px\",\n                                width: \"350px\",\n                                backgroundColor: (isViewMode || isEditMode)\n                                  ? \"#f5f5f5\"\n                                  : \"#f9fafb\",\n                                \"&:hover fieldset\": {\n                                  borderColor: \"#0d40a5\",\n                                },\n                              },\n                            }}\n                          />\n                        )}\n                      />\n                    </Grid>\n                    <Grid\n                      item\n                      xs={12}\n                      md={4}\n                      sx={{ display: \"flex\", alignItems: \"end\" }}\n                    >\n                      {!isViewMode && !isEditMode && (\n                        <Button\n                          variant=\"text\"\n                          sx={{\n                            color: \"#0d40a5\",\n                            fontWeight: \"bold\",\n                            fontSize: \"14px\",\n                          }}\n                          onClick={() => setIsAddClientOpen(true)}\n                        >\n                          أو إنشاء عميل جديد\n                        </Button>\n                      )}\n                    </Grid>\n                  </Grid>\n                </Paper>\n                )}\n                {permissions.includes(\"loans_Add\") && (\n                <Paper\n                  sx={{\n                    p: 4,\n                    mb: 3,\n                    borderRadius: 2,\n                    border: \"1px solid #e5e7eb\",\n                    backgroundColor: \"#fff\",\n                  }}\n                >\n                  <Typography\n                    variant=\"h6\"\n                    fontWeight=\"bold\"\n                    color=\"#333\"\n                    mb={3}\n                    textAlign=\"center\"\n                  >\n                    {isViewMode ? \"تفاصيل السلفة\" : \n                   isEditMode ? \"تعديل تفاصيل السلفة\" : \n                   \"حدد تفاصيل السلفة\"}\n                  </Typography>\n\n                  <Grid container spacing={3} justifyContent=\"center\">\n                    <Grid item xs={12} md={6}>\n                      <TextField\n                        fullWidth\n                        type=\"text\"\n                        label=\"مبلغ السلفة\"\n                        value={formatAmount(loanForm.amount)}\n                        onChange={(e) =>\n                          handleInputChange(\"amount\", e.target.value)\n                        }\n                        InputLabelProps={{\n                          shrink: true,\n                        }}\n                        disabled={isReadOnlyMode}\n                        onKeyDown={(e) => {\n                          if (e.key === \"-\" || e.key === \"+\") e.preventDefault();\n                        }}\n                        sx={{\n                          \"& .MuiOutlinedInput-root\": {\n                            height: \"56px\",\n                            width: \"250px\",\n                            backgroundColor: (isViewMode && !isEditMode) ? \"#f5f5f5\" : \"#f9fafb\",\n                          },\n                        }}\n                      />\n                    </Grid>\n\n                    <Grid item xs={12} md={6}>\n                      <TextField\n                        fullWidth\n                        type=\"number\"\n                        label=\"معدل الفائدة السنوي (%)\"\n                        value={loanForm.interestRate}\n                        onChange={(e) =>\n                          handleInputChange(\"interestRate\", e.target.value)\n                        }\n                        InputLabelProps={{\n                          shrink: true,\n                        }}\n                        disabled={isReadOnlyMode}\n                        onKeyDown={(e) => {\n                          if (e.key === \"-\" || e.key === \"+\") e.preventDefault();\n                        }}\n                        sx={{\n                          \"& .MuiOutlinedInput-root\": {\n                            height: \"56px\",\n                            width: \"250px\",\n                            backgroundColor: (isViewMode && !isEditMode) ? \"#f5f5f5\" : \"#f9fafb\",\n                          },\n                        }}\n                      />\n                    </Grid>\n\n                    <Grid item xs={12} md={6}>\n                      <TextField\n                        fullWidth\n                        type=\"number\"\n                        label=\"مدة السلفة (بالأشهر)\"\n                        value={loanForm.durationMonths}\n                        onChange={(e) =>\n                          handleInputChange(\"durationMonths\", e.target.value)\n                        }\n                        disabled={isReadOnlyMode}\n                        onKeyDown={(e) => {\n                          if (e.key === \"-\" || e.key === \"+\") e.preventDefault();\n                        }}\n                        sx={{\n                          \"& .MuiOutlinedInput-root\": {\n                            height: \"56px\",\n                            width: \"250px\",\n                            backgroundColor: (isViewMode && !isEditMode) ? \"#f5f5f5\" : \"#f9fafb\",\n                          },\n                        }}\n                      />\n                    </Grid>\n\n                    <Grid item xs={12} md={6}>\n                      <TextField\n                        fullWidth\n                        type=\"number\"\n                        label=\"عدد الأقساط\"\n                        value={loanForm.durationMonths}\n                        onChange={(e) =>\n                          handleInputChange(\"durationMonths\", e.target.value)\n                        }\n                        disabled={isReadOnlyMode}\n                        onKeyDown={(e) => {\n                          if (e.key === \"-\" || e.key === \"+\") e.preventDefault();\n                        }}\n                        sx={{\n                          \"& .MuiOutlinedInput-root\": {\n                            height: \"56px\",\n                            width: \"250px\",\n                            backgroundColor: (isViewMode && !isEditMode) ? \"#f5f5f5\" : \"#f9fafb\",\n                          },\n                        }}\n                      />\n                    </Grid>\n\n                    <Grid item xs={12} md={6}>\n                      <TextField\n                        fullWidth\n                        type=\"text\"\n                        label=\"نوع السلفة\"\n                        select\n                        value={loanForm.type}\n                        onChange={(e) =>\n                          handleInputChange(\"type\", e.target.value)\n                        }\n                        disabled={isReadOnlyMode}\n                        sx={{\n                          \"& .MuiOutlinedInput-root\": {\n                            height: \"56px\",\n                            width: \"250px\",\n                            backgroundColor: (isViewMode && !isEditMode) ? \"#f5f5f5\" : \"#f9fafb\",\n                          },\n                        }}\n                      >\n                        <MenuItem value=\"DAILY\">يومي</MenuItem>\n                        <MenuItem value=\"WEEKLY\">أسبوعي</MenuItem>\n                        <MenuItem value=\"MONTHLY\">شهري</MenuItem>\n                      </TextField>\n                    </Grid>\n\n                    <Grid item xs={12} md={6}>\n                      <TextField\n                        fullWidth\n                        type=\"number\"\n                        label=\"يوم السداد\"\n                        value={loanForm.repaymentDay}\n                        onChange={(e) =>\n                          handleInputChange(\"repaymentDay\", e.target.value)\n                        }\n                        inputProps={{ min: 1, max: 31 }}\n                        disabled={isReadOnlyMode}\n                        onKeyDown={(e) => {\n                          if (e.key === \"-\" || e.key === \"+\") e.preventDefault();\n                        }}\n                        sx={{\n                          \"& .MuiOutlinedInput-root\": {\n                            height: \"56px\",\n                            width: \"250px\",\n                            backgroundColor: (isViewMode && !isEditMode) ? \"#f5f5f5\" : \"#f9fafb\",\n                          },\n                        }}\n                      />\n                    </Grid>\n\n                    <Grid item xs={12} md={6}>\n                      <Autocomplete\n                        options={banksData?.data || []}\n                        getOptionLabel={(option) =>\n                          `${option.name} - ${option.accountNumber}`\n                        }\n                        value={selectedBank}\n                        onChange={handleBankSelect}\n                        onInputChange={handleBanksSearchChange}\n                        loading={isBanksLoading}\n                        disabled={isReadOnlyMode}\n                        renderInput={(params) => (\n                          <TextField\n                            {...params}\n                            label=\"اختر الحساب البنكي\"\n                            placeholder=\"ابحث باسم الحساب أو رقم الحساب\"\n                            InputProps={{\n                              ...params.InputProps,\n                              endAdornment: (\n                                <>\n                                  {isBanksLoading ? (\n                                    <CircularProgress\n                                      color=\"inherit\"\n                                      size={20}\n                                    />\n                                  ) : null}\n                                  {params.InputProps.endAdornment}\n                                </>\n                              ),\n                            }}\n                            sx={{\n                              \"& .MuiOutlinedInput-root\": {\n                                height: \"56px\",\n                                width: \"250px\",\n                                backgroundColor: (isViewMode && !isEditMode) ? \"#f5f5f5\" : \"#f9fafb\",\n                              },\n                            }}\n                          />\n                        )}\n                      />\n                    </Grid>\n\n                    <Grid item xs={12} md={6}>\n                      <Autocomplete\n                        options={partnersData?.partners || []}\n                        getOptionLabel={(option) => option.name}\n                        value={selectedPartner}\n                        onChange={handlePartnerSelect}\n                        onInputChange={handlePartnersSearchChange}\n                        loading={isPartnersLoading}\n                        disabled={isReadOnlyMode}\n                        renderInput={(params) => (\n                          <TextField\n                            {...params}\n                            label=\"اختر المستثمر\"\n                            placeholder=\"ابحث باسم المستثمر\"\n                            InputProps={{\n                              ...params.InputProps,\n                              endAdornment: (\n                                <>\n                                  {isPartnersLoading ? (\n                                    <CircularProgress\n                                      color=\"inherit\"\n                                      size={20}\n                                    />\n                                  ) : null}\n                                  {params.InputProps.endAdornment}\n                                </>\n                              ),\n                            }}\n                            sx={{\n                              \"& .MuiOutlinedInput-root\": {\n                                height: \"56px\",\n                                width: \"250px\",\n                                backgroundColor: (isViewMode && !isEditMode) ? \"#f5f5f5\" : \"#f9fafb\",\n                              },\n                            }}\n                          />\n                        )}\n                      />\n                    </Grid>\n                  </Grid>\n                </Paper>\n                )}\n              </Box>\n            )}\n          </Box>\n        </Box>\n      </Box>\n\n      <AddClient\n        open={isAddClientOpen}\n        onClose={() => setIsAddClientOpen(false)}\n        onSuccess={() => {\n          setIsAddClientOpen(false);\n          queryClient.invalidateQueries([\"clients\"]);\n        }}\n      />\n\n      {generateContracts && savedLoanData && selectedClient && (\n        <>\n          <LoanContractGenerator\n            ref={debtAckGeneratorRef}\n            loanData={savedLoanData}\n            clientData={selectedClient?.client}\n            templateContent={debtAckTemplate}\n            onContractGenerated={handleContractGenerated}\n            contractType=\"DEBT_ACKNOWLEDGMENT\"\n            autoGenerate={false}\n          />\n\n          <LoanContractGenerator\n            ref={promissoryNoteGeneratorRef}\n            loanData={savedLoanData}\n            clientData={selectedClient?.client}\n            templateContent={promissoryNoteTemplate}\n            onContractGenerated={handleContractGenerated}\n            contractType=\"PROMISSORY_NOTE\"\n            autoGenerate={false}\n          />\n\n          <LoanContractsPreview\n            open={previewOpen}\n            onClose={() => setPreviewOpen(false)}\n            debtAckHtml={previewContracts.debtAck}\n            promissoryNoteHtml={previewContracts.promissoryNote}\n            onSaveContracts={handleSaveContracts}\n            loading={isCreatingLoan}\n            clientName={selectedClient?.client?.name}\n            loanAmount={parseFloat(loanForm.amount.replace(/,/g, \"\")) || 0}\n          />\n        </>\n      )}\n    </Box>\n  );\n};\n\nexport default Loans;"],"names":["Pause","createSvgIcon","_jsx","PlayArrow","getClients","page","search","url","Api","error","handleApiError","getPartners","createLoan","loanData","updateLoan","loanId","activateLoan","deactivateLoan","getLoans","getLoanById","deleteLoan","LoansTable","onViewDetails","onViewInstallments","setPage","useState","searchQuery","setSearchQuery","loanToDelete","setLoanToDelete","isDeleteModalOpen","setIsDeleteModalOpen","queryClient","useQueryClient","anchorEl","setAnchorEl","selectedLoanForMenu","setSelectedLoanForMenu","permissions","usePermissions","handleMenuOpen","event","loan","handleMenuClose","loansData","isLoading","useQuery","handleSearchChange","handleChangePage","newPage","handleDeleteLoan","notifySuccess","notifyError","handleActivateLoan","handleDeactivateLoan","handleViewInstallmentsClick","getStatusColor","status","getStatusText","getTypeText","type","jsxs","Box","jsx","InputBase","Paper","TableContainer","Table","TableHead","StyledTableRow","StyledTableCell","TableBody","CircularProgress","Typography","Chip","dayjs","IconButton","MoreVert","TablePagination","from","to","count","DeleteModal","Menu","MenuItem","ListItemIcon","Visibility","Schedule","Delete","numberToArabicWords","num","ones","tens","teens","hundreds","result","millionsPart","thousandsPart","hundredsPart","tensPart","onesPart","getCurrentDates","now","hijriDate","LoanContractGenerator","React","clientData","templateContent","onContractGenerated","contractType","autoGenerate","ref","contractHtml","setContractHtml","isGenerating","setIsGenerating","uploadPDFToServer","useCallback","pdfBlob","formData","filename","endpoint","response","generatePDF","htmlContent","contentToUse","previewContainer","options","resolve","container","html2pdf","generateContract","generatePdf","customLoanData","loanDataToUse","gregorianDate","finalDate","amount","amountInWords","filledTemplate","useEffect","LoanContractsPreview","open","onClose","debtAckHtml","promissoryNoteHtml","onSaveContracts","loading","clientName","loanAmount","activeTab","setActiveTab","handleTabChange","newValue","handlePrint","contractElement","printWindow","contracts","Dialog","DialogTitle","CloseIcon","Tabs","Tab","DialogContent","contract","index","Divider","DialogActions","Button","Print","Download","Loans","navigate","useNavigate","selectedClient","setSelectedClient","selectedBank","setSelectedBank","selectedPartner","setSelectedPartner","banksSearchQuery","setBanksSearchQuery","partnersSearchQuery","setPartnersSearchQuery","clientsPage","setClientsPage","banksPage","setBanksPage","partnersPage","setPartnersPage","isAddClientOpen","setIsAddClientOpen","loanForm","setLoanForm","selectedLoan","setSelectedLoan","installments","setInstallments","isEditMode","setIsEditMode","isViewMode","setIsViewMode","generateContracts","setGenerateContracts","savedLoanData","setSavedLoanData","debtAckTemplate","setDebtAckTemplate","promissoryNoteTemplate","setPromissoryNoteTemplate","contractsGenerated","setContractsGenerated","previewOpen","setPreviewOpen","previewContracts","setPreviewContracts","isCreatingLoan","setIsCreatingLoan","debtAckGeneratorRef","useRef","promissoryNoteGeneratorRef","clientsData","isClientsLoading","banksData","isBanksLoading","getBanks","partnersData","isPartnersLoading","fetchContractTemplates","calculateInstallments","debtResponse","promissoryResponse","debouncedSearch","debounce","value","debouncedBanksSearch","debouncedPartnersSearch","handleBanksSearchChange","handlePartnersSearchChange","handleClientSelect","handleBankSelect","handlePartnerSelect","formatAmount","handleOpenPreview","previewLoanData","handleSaveContracts","interestRate","durationMonths","loanType","profit","total","repaymentCount","installmentAmount","principalPerInstallment","interestPerInstallment","calculatedInstallments","remainingBalance","i","dueDate","getSimulationSummary","totalInterest","sum","inst","totalAmount","handleCreateLoan","newLoan","handleContractGenerated","newCount","resetLoanForm","handleUpdateLoan","handleViewLoanDetails","formattedRepayments","repayment","currentInstallment","handleViewInstallments","handleEditLoan","handleInputChange","field","rawValue","prev","handleSaveLoan","simulationSummary","isFormValid","canEditLoan","isReadOnlyMode","Helmet","Stack","Alert","e","Grid","Autocomplete","option","params","TextField","Fragment","AddClient"],"mappings":"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","x_google_ignoreList":[0,1]}