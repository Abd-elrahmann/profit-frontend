import{q as ne,j as e,A as T,o as S,r as j,a as $,_ as Q,B as o,as as ae,$ as M,a0 as G,a1 as H,a2 as U,a3 as m,a4 as s,a5 as Y,l as q,T as l,Y as ie,a6 as le,am as _,f as oe,W as ce,H as de,k as w,aI as ue,Z as xe,X as B,ac as p,e as f,ao as P,a9 as he,m as R,n as N}from"./index-Byloyp0V.js";import{V as pe}from"./Visibility--5hKivIt.js";import{T as je}from"./TablePagination-rGYbANAk.js";import{D as ge}from"./DeleteModal-Du1zPAFn.js";import{E as fe}from"./Edit-D4H7Xh5Y.js";import{S as me}from"./Save-jijcoH0W.js";import{T as be,a as F}from"./Tabs-D07rxUwM.js";import"./KeyboardArrowRight-nGgaUmNE.js";import"./LastPage-D5DKCjzm.js";const ye=ne(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"})),we=async(a=1,n="")=>{try{const i=n?`/api/journals/all/${a}?search=${encodeURIComponent(n)}`:`/api/journals/all/${a}`;return(await T.get(i)).data}catch(i){throw S(i),i}},Te=async a=>{try{return(await T.get(`/api/journals/${a}`)).data}catch(n){throw S(n),n}},Se=async(a,n)=>{try{return(await T.patch(`/api/journals/${a}`,n)).data}catch(i){throw S(i),i}},Ce=async a=>{try{return(await T.delete(`/api/journals/${a}`)).data}catch(n){throw S(n),n}},ve=async a=>{try{return(await T.post(`/api/journals/${a}/post`)).data}catch(n){throw S(n),n}},Ee=async a=>{try{return(await T.post(`/api/journals/${a}/unpost`)).data}catch(n){throw S(n),n}},Ie=({onViewDetails:a})=>{const[n,i]=j.useState(1),[u,c]=j.useState(""),{permissions:g}=$(),{data:b,isLoading:C}=Q({queryKey:["journals",n,u],queryFn:()=>we(n,u)}),O=t=>{c(t.target.value),i(1)},v=(t,I)=>{i(I+1)},x=t=>{switch(t){case"GENERAL":return"عام";case"OPENING":return"افتتاحي";case"CLOSING":return"ختامي";case"ADJUSTMENT":return"تسوية";default:return t}},E=t=>{switch(t){case"LOAN":return"سلفة";case"REPAYMENT":return"سداد";case"PARTNER":return"شريك";case"PERIOD_CLOSING":return"إقفال فترة";case"PARTNER_TRANSACTION_WITHDRAWAL":return"سحب مالي لشريك";case"PARTNER_TRANSACTION_DEPOSIT":return"إيداع مالي لشريك";case"OTHER":return"أخرى";default:return t||"-"}},d=t=>{switch(t){case"DRAFT":return"warning";case"POSTED":return"success";case"CANCELLED":return"error";default:return"default"}},h=t=>{switch(t){case"DRAFT":return"مسودة";case"POSTED":return"معتمد";case"CANCELLED":return"ملغي";default:return t}};return e.jsxs(o,{sx:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[e.jsx(o,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(ae,{placeholder:"ابحث برقم القيد أو الوصف...",value:u,onChange:O,sx:{width:"280px",borderRadius:"6px",p:1}})}),e.jsx(M,{sx:{flex:1,width:"100%",overflow:"hidden"},children:e.jsx(G,{sx:{height:"100%",width:"100%"},children:e.jsxs(H,{stickyHeader:!0,sx:{width:"100%"},children:[e.jsx(U,{children:e.jsxs(m,{children:[e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"رقم القيد"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"النوع"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"الحالة"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"المصدر"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"المعتمد بواسطة"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"تاريخ الإنشاء"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"الإجراءات"})]})}),e.jsx(Y,{children:C?e.jsx(m,{children:e.jsx(s,{colSpan:8,align:"center",children:e.jsx(q,{size:20})})}):b?.journals?.length===0?e.jsx(m,{children:e.jsx(s,{colSpan:8,align:"center",children:e.jsx(l,{children:"لا توجد قيود"})})}):b?.journals?.map(t=>e.jsxs(m,{hover:!0,onClick:()=>a(t.id),sx:{cursor:"pointer"},children:[e.jsx(s,{align:"center",children:t.reference}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:x(t.type)}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:e.jsx(ie,{label:h(t.status),color:d(t.status),size:"small"})}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:E(t.sourceType)}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:t.postedBy?.name||"لم يتم الاعتماد "}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:le(t.createdAt).format("DD/MM/YYYY")}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:e.jsx(_,{direction:"row",spacing:1,justifyContent:"center",children:g.includes("journalEntries_Update")&&e.jsx(oe,{title:"عرض التفاصيل",size:"small",color:"primary",onClick:()=>a(t.id),children:e.jsx(pe,{fontSize:"small"})})})})]},t.id))})]})})}),b&&e.jsx(je,{component:"div",count:b.total||0,page:n-1,onPageChange:v,rowsPerPage:10,rowsPerPageOptions:[10],labelDisplayedRows:({from:t,to:I,count:k})=>`عرض ${t}-${I} من ${k}`,labelRowsPerPage:"صفوف لكل صفحة:"})]})},Je=()=>{const[a,n]=j.useState(0),[i,u]=j.useState(null),[c,g]=j.useState(!1),[b,C]=j.useState(null),[O,v]=j.useState(!1),[x,E]=j.useState({description:"",date:"",type:""}),d=ce(),{permissions:h}=$(),{data:t,isLoading:I}=Q({queryKey:["journal",i],queryFn:()=>Te(i),enabled:!!i&&a===1,onSuccess:r=>{r&&E({description:r.description||"",date:r.date?r.date.split("T")[0]:"",type:r.type||""})}}),k=r=>{u(r),n(1),g(!1)},z=()=>{g(!0)},K=()=>{g(!1),t&&E({description:t.description||"",date:t.date?t.date.split("T")[0]:"",type:t.type||""})},V=async()=>{try{const r={description:x.description,date:x.date,type:x.type};await Se(i,r),R("تم تعديل القيد بنجاح"),g(!1),d.invalidateQueries(["journal",i]),d.invalidateQueries(["journals"])}catch(r){N(r.response?.data?.message||"حدث خطأ أثناء تعديل القيد")}},W=(r,y)=>{E(D=>({...D,[r]:y}))},X=async()=>{try{await Ce(b),R("تم حذف القيد بنجاح"),v(!1),C(null),u(null),n(0),d.invalidateQueries(["journals"])}catch(r){N(r.response?.data?.message||"حدث خطأ أثناء حذف القيد")}},Z=async()=>{try{await ve(i),R("تم اعتماد القيد بنجاح"),d.invalidateQueries(["journal",i]),d.invalidateQueries(["journals"])}catch(r){N(r.response?.data?.message||"حدث خطأ أثناء اعتماد القيد")}},ee=async()=>{try{await Ee(i),R("تم إلغاء اعتماد القيد بنجاح"),d.invalidateQueries(["journal",i]),d.invalidateQueries(["journals"])}catch(r){N(r.response?.data?.message||"حدث خطأ أثناء إلغاء الاعتماد")}},te=r=>{switch(r){case"LOAN":return"سلفة";case"REPAYMENT":return"سداد";case"PARTNER":return"شريك";case"PERIOD_CLOSING":return"إقفال فترة";case"PARTNER_TRANSACTION_WITHDRAWAL":return"سحب مالي لشريك";case"PARTNER_TRANSACTION_DEPOSIT":return"إيداع مالي لشريك";case"OTHER":return"أخرى";default:return r||"-"}},re=r=>{switch(r){case"DRAFT":return"مسودة";case"POSTED":return"معتمد";case"CANCELLED":return"ملغي";default:return r}},se=()=>{if(!t?.lines)return{totalDebit:0,totalCredit:0};const r=t.lines.reduce((D,J)=>D+(J.debit||0),0),y=t.lines.reduce((D,J)=>D+(J.credit||0),0);return{totalDebit:r,totalCredit:y}},{totalDebit:A,totalCredit:L}=se();return e.jsxs(o,{sx:{bgcolor:"#f6f6f8",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs(de,{children:[e.jsx("title",{children:"القيود المحاسبية"}),e.jsx("meta",{name:"description",content:"القيود المحاسبية"})]}),e.jsxs(o,{sx:{display:"flex",flexDirection:"row-reverse",flex:1,height:"calc(100vh - 80px)",width:"100%"},children:[a===1&&t&&e.jsxs(o,{sx:{width:"350px",borderRight:"1px solid #ddd",bgcolor:"#fafafa",height:"100%",overflowY:"auto",flexShrink:0},children:[e.jsxs(o,{sx:{p:3,borderBottom:"1px solid #ddd",bgcolor:"#fafafa"},children:[e.jsx(l,{variant:"h6",color:"primary",fontWeight:"bold",mb:3,children:"معلومات القيد"}),e.jsxs(_,{spacing:2,children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(l,{color:"error",children:"إجمالي المدين:"}),e.jsx(l,{fontWeight:"bold",color:"error",children:A.toLocaleString()})]}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(l,{color:"success",children:"إجمالي الدائن:"}),e.jsx(l,{fontWeight:"bold",color:"success",children:L.toLocaleString()})]}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(l,{color:"black",children:"الاجمالي:"}),e.jsx(l,{fontWeight:"bold",color:"black",children:(A-L).toLocaleString()})]})]})]}),e.jsxs(o,{sx:{p:3},children:[e.jsx(l,{variant:"h6",color:"primary",fontWeight:"bold",mb:3,children:"الإجراءات"}),e.jsxs(_,{spacing:2,children:[t.status==="DRAFT"&&!c&&h.includes("journalEntries_Update")&&e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"contained",startIcon:e.jsx(fe,{sx:{marginLeft:"10px"}}),onClick:z,sx:{bgcolor:"primary.main","&:hover":{bgcolor:"primary.dark"}},children:"تعديل القيد"}),h.includes("journalEntries_Post")&&e.jsx(w,{variant:"contained",startIcon:e.jsx(ue,{sx:{marginLeft:"10px"}}),onClick:Z,sx:{bgcolor:"success.main","&:hover":{bgcolor:"success.dark"}},children:"اعتماد القيد"}),h.includes("journalEntries_Delete")&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(xe,{sx:{marginLeft:"10px"}}),onClick:()=>{C(i),v(!0)},sx:{borderColor:"error.main",color:"error.main","&:hover":{bgcolor:"rgba(211, 47, 47, 0.1)"}},children:"حذف القيد"})]}),t.status==="DRAFT"&&c&&h.includes("journalEntries_Update")&&e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"contained",startIcon:e.jsx(me,{sx:{marginLeft:"10px"}}),onClick:V,sx:{bgcolor:"success.main","&:hover":{bgcolor:"success.dark"}},children:"حفظ التعديلات"}),h.includes("journalEntries_Update")&&e.jsx(w,{variant:"outlined",onClick:K,sx:{borderColor:"grey.500",color:"grey.700"},children:"إلغاء التعديل"})]}),t.status==="POSTED"&&h.includes("journalEntries_Post")&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(ye,{sx:{marginLeft:"10px"}}),onClick:ee,sx:{borderColor:"error.main",color:"error.main","&:hover":{bgcolor:"rgba(211, 47, 47, 0.1)"}},children:"إلغاء الاعتماد"})]})]})]}),e.jsx(o,{sx:{flex:1,p:4,bgcolor:"#fff",overflowY:"auto",width:"100%"},children:e.jsxs(o,{sx:{width:"100%"},children:[e.jsx(o,{sx:{borderBottom:1,borderColor:"divider",mb:4},children:e.jsxs(be,{value:a,onChange:(r,y)=>{n(y),y===0&&(u(null),g(!1))},children:[e.jsx(F,{label:"عرض جميع القيود",sx:{fontWeight:"bold",borderBottom:a===0?"3px solid #0d40a5":"none",color:a===0?"#0d40a5":"text.secondary"}}),e.jsx(F,{label:i?"تفاصيل القيد":"قيد محدد",sx:{fontWeight:"bold",borderBottom:a===1?"3px solid #0d40a5":"none",color:a===1?"#0d40a5":"text.secondary"}})]})}),a===0?e.jsx(Ie,{onViewDetails:k}):e.jsx(o,{children:i?I?e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(q,{size:20})}):t?e.jsxs(M,{sx:{p:4,borderRadius:2},children:[e.jsx(l,{variant:"h6",color:"primary",fontWeight:"bold",mb:3,textAlign:"center",children:"تفاصيل القيد"}),e.jsxs(p,{container:!0,spacing:3,mb:4,justifyContent:"center",children:[e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"رقم القيد",value:t.reference||"",disabled:!0,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}}})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"التاريخ",type:"date",value:c?x.date:t.date?t.date.split("T")[0]:"",onChange:r=>W("date",r.target.value),disabled:!c,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}}})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsxs(f,{fullWidth:!0,label:"نوع القيد",select:!0,value:c?x.type:t.type||"",onChange:r=>W("type",r.target.value),disabled:!c,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}},children:[e.jsx(P,{value:"GENERAL",children:"عام"}),e.jsx(P,{value:"OPENING",children:"افتتاحي"}),e.jsx(P,{value:"CLOSING",children:"ختامي"}),e.jsx(P,{value:"ADJUSTMENT",children:"تسوية"})]})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"نوع المصدر",value:t.sourceType?te(t.sourceType):"لا يوجد",disabled:!0,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}}})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"الحالة",value:re(t.status),disabled:!0,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}}})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"المعتمد بواسطة",value:t.postedBy?.name||"لم يتم الاعتماد ",disabled:!0,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,label:"الوصف",value:c?x.description:t.description||"",onChange:r=>W("description",r.target.value),disabled:!c,multiline:!0,rows:2,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"650px"}}})})]}),e.jsx(he,{sx:{my:3}}),e.jsx(l,{variant:"h6",color:"primary",fontWeight:"bold",mb:3,textAlign:"center",children:"بنود القيد"}),e.jsx(G,{component:M,variant:"outlined",children:e.jsxs(H,{children:[e.jsx(U,{children:e.jsxs(m,{children:[e.jsx(s,{align:"center",children:"الحساب"}),e.jsx(s,{align:"center",children:"العميل"}),e.jsx(s,{align:"center",children:"الطبيعة"}),e.jsx(s,{align:"center",children:"مدين"}),e.jsx(s,{align:"center",children:"دائن"}),e.jsx(s,{align:"center",children:"الإجمالي"})]})}),e.jsxs(Y,{children:[t.lines?.map(r=>e.jsxs(m,{children:[e.jsxs(s,{align:"center",children:[r.account?.code," - ",r.account?.name]}),e.jsx(s,{align:"center",children:r.client?.name||"لا يوجد عميل"}),e.jsx(s,{align:"center",style:{color:r.account?.nature==="DEBIT"?"#d32f2f":r.account?.nature==="CREDIT"?"#2e7d32":"#000000",fontWeight:"bold"},children:r.account?.nature?r.account.nature==="DEBIT"?"مدين":"دائن":"-"}),e.jsx(s,{align:"center",children:r.debit.toLocaleString()||0}),e.jsx(s,{align:"center",children:r.credit.toLocaleString()||0}),e.jsx(s,{align:"center",children:r.balance.toLocaleString()||0})]},r.id)),e.jsxs(m,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(s,{colSpan:3,align:"center",children:e.jsx(l,{fontWeight:"bold",children:"الإجمالي"})}),e.jsx(s,{align:"center",children:e.jsx(l,{fontWeight:"bold",children:A.toLocaleString()})}),e.jsx(s,{align:"center",children:e.jsx(l,{fontWeight:"bold",children:L.toLocaleString()})}),e.jsx(s,{align:"center",children:e.jsx(l,{fontWeight:"bold",children:(A-L).toLocaleString()})})]})]})]})})]}):e.jsx(B,{severity:"error",children:"حدث خطأ في تحميل بيانات القيد"}):e.jsx(B,{severity:"info",sx:{mt:2},children:"يرجى اختيار قيد لعرض تفاصيله"})})]})})]}),e.jsx(ge,{open:O,onClose:()=>{v(!1),C(null)},onConfirm:X,title:"حذف القيد",message:"هل أنت متأكد من حذف هذا القيد؟",ButtonText:"حذف"})]})};export{Je as default};
//# sourceMappingURL=Journals-Cjhq7fWH.js.map
