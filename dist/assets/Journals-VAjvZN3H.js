import{f as re,j as e,A as y,h as w,r as j,K as Q,B as l,ap as se,P as J,L as _,N as $,O as G,Q as f,R as s,U as Y,C as H,T as o,V as ne,W as ae,a9 as M,I as ie,G as oe,d as m,aE as le,X as ce,J as B,a1 as p,a as g,ab as A,_ as de,n as L,e as R}from"./index-2TEkS4Tk.js";import{V as ue}from"./Visibility-RfWQbd6l.js";import{T as xe}from"./TablePagination-DstB3iTg.js";import{D as he}from"./DeleteModal-CWdUgVUc.js";import{E as pe}from"./Edit-DJkzKNbs.js";import{S as je}from"./Save-ue_qOb6O.js";import{T as ge,a as F}from"./Tabs-BxNyk1aI.js";import"./KeyboardArrowRight-D-ZOxJ7W.js";import"./LastPage-TR1pquDU.js";const fe=re(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"})),be=async(a=1,n="")=>{try{const i=n?`/api/journals/all/${a}?search=${encodeURIComponent(n)}`:`/api/journals/all/${a}`;return(await y.get(i)).data}catch(i){throw w(i),i}},me=async a=>{try{return(await y.get(`/api/journals/${a}`)).data}catch(n){throw w(n),n}},ye=async(a,n)=>{try{return(await y.patch(`/api/journals/${a}`,n)).data}catch(i){throw w(i),i}},we=async a=>{try{return(await y.delete(`/api/journals/${a}`)).data}catch(n){throw w(n),n}},Te=async a=>{try{return(await y.post(`/api/journals/${a}/post`)).data}catch(n){throw w(n),n}},Se=async a=>{try{return(await y.post(`/api/journals/${a}/unpost`)).data}catch(n){throw w(n),n}},Ce=({onViewDetails:a})=>{const[n,i]=j.useState(1),[x,c]=j.useState(""),{data:d,isLoading:P}=Q({queryKey:["journals",n,x],queryFn:()=>be(n,x)}),T=t=>{c(t.target.value),i(1)},N=(t,v)=>{i(v+1)},S=t=>{switch(t){case"GENERAL":return"عام";case"OPENING":return"افتتاحي";case"CLOSING":return"ختامي";case"ADJUSTMENT":return"تسوية";default:return t}},h=t=>{switch(t){case"LOAN":return"سلفة";case"REPAYMENT":return"سداد";case"PARTNER":return"شريك";case"PERIOD_CLOSING":return"إقفال فترة";case"PARTNER_TRANSACTION_WITHDRAWAL":return"سحب مالي لشريك";case"PARTNER_TRANSACTION_DEPOSIT":return"إيداع مالي لشريك";case"OTHER":return"أخرى";default:return t||"-"}},C=t=>{switch(t){case"DRAFT":return"warning";case"POSTED":return"success";case"CANCELLED":return"error";default:return"default"}},u=t=>{switch(t){case"DRAFT":return"مسودة";case"POSTED":return"معتمد";case"CANCELLED":return"ملغي";default:return t}};return e.jsxs(l,{sx:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[e.jsx(l,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(se,{placeholder:"ابحث برقم القيد أو الوصف...",value:x,onChange:T,sx:{width:"280px",borderRadius:"6px",p:1}})}),e.jsx(J,{sx:{flex:1,width:"100%",overflow:"hidden"},children:e.jsx(_,{sx:{height:"100%",width:"100%"},children:e.jsxs($,{stickyHeader:!0,sx:{width:"100%"},children:[e.jsx(G,{children:e.jsxs(f,{children:[e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"رقم القيد"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"النوع"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"الحالة"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"المصدر"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"المعتمد بواسطة"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"تاريخ الإنشاء"}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:"الإجراءات"})]})}),e.jsx(Y,{children:P?e.jsx(f,{children:e.jsx(s,{colSpan:8,align:"center",children:e.jsx(H,{size:20})})}):d?.journals?.length===0?e.jsx(f,{children:e.jsx(s,{colSpan:8,align:"center",children:e.jsx(o,{children:"لا توجد قيود"})})}):d?.journals?.map(t=>e.jsxs(f,{hover:!0,onClick:()=>a(t.id),sx:{cursor:"pointer"},children:[e.jsx(s,{align:"center",children:t.reference}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:S(t.type)}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:e.jsx(ne,{label:u(t.status),color:C(t.status),size:"small"})}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:h(t.sourceType)}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:t.postedBy?.name||"لم يتم الاعتماد "}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:ae(t.createdAt).format("DD/MM/YYYY")}),e.jsx(s,{align:"center",sx:{whiteSpace:"nowrap"},children:e.jsx(M,{direction:"row",spacing:1,justifyContent:"center",children:e.jsx(ie,{title:"عرض التفاصيل",size:"small",color:"primary",onClick:()=>a(t.id),children:e.jsx(ue,{fontSize:"small"})})})})]},t.id))})]})})}),d&&e.jsx(xe,{component:"div",count:d.total||0,page:n-1,onPageChange:N,rowsPerPage:10,rowsPerPageOptions:[10],labelDisplayedRows:({from:t,to:v,count:O})=>`عرض ${t}-${v} من ${O}`,labelRowsPerPage:"صفوف لكل صفحة:"})]})},Oe=()=>{const[a,n]=j.useState(0),[i,x]=j.useState(null),[c,d]=j.useState(!1),[P,T]=j.useState(null),[N,S]=j.useState(!1),[h,C]=j.useState({description:"",date:"",type:""}),u=oe(),{data:t,isLoading:v}=Q({queryKey:["journal",i],queryFn:()=>me(i),enabled:!!i&&a===1,onSuccess:r=>{r&&C({description:r.description||"",date:r.date?r.date.split("T")[0]:"",type:r.type||""})}}),O=r=>{x(r),n(1),d(!1)},z=()=>{d(!0)},U=()=>{d(!1),t&&C({description:t.description||"",date:t.date?t.date.split("T")[0]:"",type:t.type||""})},q=async()=>{try{const r={description:h.description,date:h.date,type:h.type};await ye(i,r),L("تم تعديل القيد بنجاح"),d(!1),u.invalidateQueries(["journal",i]),u.invalidateQueries(["journals"])}catch(r){R(r.response?.data?.message||"حدث خطأ أثناء تعديل القيد")}},k=(r,b)=>{C(I=>({...I,[r]:b}))},K=async()=>{try{await we(P),L("تم حذف القيد بنجاح"),S(!1),T(null),x(null),n(0),u.invalidateQueries(["journals"])}catch(r){R(r.response?.data?.message||"حدث خطأ أثناء حذف القيد")}},V=async()=>{try{await Te(i),L("تم اعتماد القيد بنجاح"),u.invalidateQueries(["journal",i]),u.invalidateQueries(["journals"])}catch(r){R(r.response?.data?.message||"حدث خطأ أثناء اعتماد القيد")}},X=async()=>{try{await Se(i),L("تم إلغاء اعتماد القيد بنجاح"),u.invalidateQueries(["journal",i]),u.invalidateQueries(["journals"])}catch(r){R(r.response?.data?.message||"حدث خطأ أثناء إلغاء الاعتماد")}},Z=r=>{switch(r){case"LOAN":return"سلفة";case"REPAYMENT":return"سداد";case"PARTNER":return"شريك";case"PERIOD_CLOSING":return"إقفال فترة";case"PARTNER_TRANSACTION_WITHDRAWAL":return"سحب مالي لشريك";case"PARTNER_TRANSACTION_DEPOSIT":return"إيداع مالي لشريك";case"OTHER":return"أخرى";default:return r||"-"}},ee=r=>{switch(r){case"DRAFT":return"مسودة";case"POSTED":return"معتمد";case"CANCELLED":return"ملغي";default:return r}},te=()=>{if(!t?.lines)return{totalDebit:0,totalCredit:0};const r=t.lines.reduce((I,W)=>I+(W.debit||0),0),b=t.lines.reduce((I,W)=>I+(W.credit||0),0);return{totalDebit:r,totalCredit:b}},{totalDebit:E,totalCredit:D}=te();return e.jsxs(l,{sx:{bgcolor:"#f6f6f8",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs(l,{sx:{display:"flex",flexDirection:"row-reverse",flex:1,height:"calc(100vh - 80px)",width:"100%"},children:[a===1&&t&&e.jsxs(l,{sx:{width:"350px",borderRight:"1px solid #ddd",bgcolor:"#fafafa",height:"100%",overflowY:"auto",flexShrink:0},children:[e.jsxs(l,{sx:{p:3,borderBottom:"1px solid #ddd",bgcolor:"#fafafa"},children:[e.jsx(o,{variant:"h6",color:"primary",fontWeight:"bold",mb:3,children:"معلومات القيد"}),e.jsxs(M,{spacing:2,children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(o,{color:"error",children:"إجمالي المدين:"}),e.jsx(o,{fontWeight:"bold",color:"error",children:E.toLocaleString()})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(o,{color:"success",children:"إجمالي الدائن:"}),e.jsx(o,{fontWeight:"bold",color:"success",children:D.toLocaleString()})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(o,{color:"black",children:"الاجمالي:"}),e.jsx(o,{fontWeight:"bold",color:"black",children:(E-D).toLocaleString()})]})]})]}),e.jsxs(l,{sx:{p:3},children:[e.jsx(o,{variant:"h6",color:"primary",fontWeight:"bold",mb:3,children:"الإجراءات"}),e.jsxs(M,{spacing:2,children:[t.status==="DRAFT"&&!c&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"contained",startIcon:e.jsx(pe,{sx:{marginLeft:"10px"}}),onClick:z,sx:{bgcolor:"primary.main","&:hover":{bgcolor:"primary.dark"}},children:"تعديل القيد"}),e.jsx(m,{variant:"contained",startIcon:e.jsx(le,{sx:{marginLeft:"10px"}}),onClick:V,sx:{bgcolor:"success.main","&:hover":{bgcolor:"success.dark"}},children:"اعتماد القيد"}),e.jsx(m,{variant:"outlined",startIcon:e.jsx(ce,{sx:{marginLeft:"10px"}}),onClick:()=>{T(i),S(!0)},sx:{borderColor:"error.main",color:"error.main","&:hover":{bgcolor:"rgba(211, 47, 47, 0.1)"}},children:"حذف القيد"})]}),t.status==="DRAFT"&&c&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"contained",startIcon:e.jsx(je,{sx:{marginLeft:"10px"}}),onClick:q,sx:{bgcolor:"success.main","&:hover":{bgcolor:"success.dark"}},children:"حفظ التعديلات"}),e.jsx(m,{variant:"outlined",onClick:U,sx:{borderColor:"grey.500",color:"grey.700"},children:"إلغاء التعديل"})]}),t.status==="POSTED"&&e.jsx(m,{variant:"outlined",startIcon:e.jsx(fe,{sx:{marginLeft:"10px"}}),onClick:X,sx:{borderColor:"error.main",color:"error.main","&:hover":{bgcolor:"rgba(211, 47, 47, 0.1)"}},children:"إلغاء الاعتماد"})]})]})]}),e.jsx(l,{sx:{flex:1,p:4,bgcolor:"#fff",overflowY:"auto",width:"100%"},children:e.jsxs(l,{sx:{width:"100%"},children:[e.jsx(l,{sx:{borderBottom:1,borderColor:"divider",mb:4},children:e.jsxs(ge,{value:a,onChange:(r,b)=>{n(b),b===0&&(x(null),d(!1))},children:[e.jsx(F,{label:"عرض جميع القيود",sx:{fontWeight:"bold",borderBottom:a===0?"3px solid #0d40a5":"none",color:a===0?"#0d40a5":"text.secondary"}}),e.jsx(F,{label:i?"تفاصيل القيد":"قيد محدد",sx:{fontWeight:"bold",borderBottom:a===1?"3px solid #0d40a5":"none",color:a===1?"#0d40a5":"text.secondary"}})]})}),a===0?e.jsx(Ce,{onViewDetails:O}):e.jsx(l,{children:i?v?e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(H,{size:20})}):t?e.jsxs(J,{sx:{p:4,borderRadius:2},children:[e.jsx(o,{variant:"h6",color:"primary",fontWeight:"bold",mb:3,textAlign:"center",children:"تفاصيل القيد"}),e.jsxs(p,{container:!0,spacing:3,mb:4,justifyContent:"center",children:[e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(g,{fullWidth:!0,label:"رقم القيد",value:t.reference||"",disabled:!0,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}}})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(g,{fullWidth:!0,label:"التاريخ",type:"date",value:c?h.date:t.date?t.date.split("T")[0]:"",onChange:r=>k("date",r.target.value),disabled:!c,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}}})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsxs(g,{fullWidth:!0,label:"نوع القيد",select:!0,value:c?h.type:t.type||"",onChange:r=>k("type",r.target.value),disabled:!c,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}},children:[e.jsx(A,{value:"GENERAL",children:"عام"}),e.jsx(A,{value:"OPENING",children:"افتتاحي"}),e.jsx(A,{value:"CLOSING",children:"ختامي"}),e.jsx(A,{value:"ADJUSTMENT",children:"تسوية"})]})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(g,{fullWidth:!0,label:"نوع المصدر",value:t.sourceType?Z(t.sourceType):"لا يوجد",disabled:!0,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}}})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(g,{fullWidth:!0,label:"الحالة",value:ee(t.status),disabled:!0,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}}})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(g,{fullWidth:!0,label:"المعتمد بواسطة",value:t.postedBy?.name||"لم يتم الاعتماد ",disabled:!0,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"200px"}}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(g,{fullWidth:!0,label:"الوصف",value:c?h.description:t.description||"",onChange:r=>k("description",r.target.value),disabled:!c,multiline:!0,rows:2,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{width:"650px"}}})})]}),e.jsx(de,{sx:{my:3}}),e.jsx(o,{variant:"h6",color:"primary",fontWeight:"bold",mb:3,textAlign:"center",children:"بنود القيد"}),e.jsx(_,{component:J,variant:"outlined",children:e.jsxs($,{children:[e.jsx(G,{children:e.jsxs(f,{children:[e.jsx(s,{align:"center",children:"الحساب"}),e.jsx(s,{align:"center",children:"العميل"}),e.jsx(s,{align:"center",children:"الطبيعة"}),e.jsx(s,{align:"center",children:"مدين"}),e.jsx(s,{align:"center",children:"دائن"}),e.jsx(s,{align:"center",children:"الإجمالي"})]})}),e.jsxs(Y,{children:[t.lines?.map(r=>e.jsxs(f,{children:[e.jsxs(s,{align:"center",children:[r.account?.code," - ",r.account?.name]}),e.jsx(s,{align:"center",children:r.client?.name||"لا يوجد عميل"}),e.jsx(s,{align:"center",style:{color:r.account?.nature==="DEBIT"?"#d32f2f":r.account?.nature==="CREDIT"?"#2e7d32":"#000000",fontWeight:"bold"},children:r.account?.nature?r.account.nature==="DEBIT"?"مدين":"دائن":"-"}),e.jsx(s,{align:"center",children:r.debit.toLocaleString()||0}),e.jsx(s,{align:"center",children:r.credit.toLocaleString()||0}),e.jsx(s,{align:"center",children:r.balance.toLocaleString()||0})]},r.id)),e.jsxs(f,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(s,{colSpan:3,align:"center",children:e.jsx(o,{fontWeight:"bold",children:"الإجمالي"})}),e.jsx(s,{align:"center",children:e.jsx(o,{fontWeight:"bold",children:E.toLocaleString()})}),e.jsx(s,{align:"center",children:e.jsx(o,{fontWeight:"bold",children:D.toLocaleString()})}),e.jsx(s,{align:"center",children:e.jsx(o,{fontWeight:"bold",children:(E-D).toLocaleString()})})]})]})]})})]}):e.jsx(B,{severity:"error",children:"حدث خطأ في تحميل بيانات القيد"}):e.jsx(B,{severity:"info",sx:{mt:2},children:"يرجى اختيار قيد لعرض تفاصيله"})})]})})]}),e.jsx(he,{open:N,onClose:()=>{S(!1),T(null)},onConfirm:K,title:"حذف القيد",message:"هل أنت متأكد من حذف هذا القيد؟",ButtonText:"حذف"})]})};export{Oe as default};
//# sourceMappingURL=Journals-VAjvZN3H.js.map
