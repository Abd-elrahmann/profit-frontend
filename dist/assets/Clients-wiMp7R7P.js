import{q as ye,j as e,r as v,W as ve,O as Ae,P as Le,T as i,f as P,Q as $e,R as ze,B as d,ac as s,a9 as _e,U as Ue,k as D,l as se,ad as Be,$ as C,ae,af as le,Z as oe,ag as ue,A as q,m as N,n as $,ah as Ne,a as qe,_ as ie,H as Ke,e as m,I as He,Y as ee,ai as pe,a0 as Ye,a1 as Qe,a2 as Je,aj as Ge,a4 as w,a5 as Ze,a3 as be,o as te}from"./index-Byloyp0V.js";import{l as Ve}from"./lodash-Dqh01Uem.js";import{A as Xe}from"./AddClient-B8tgV7_K.js";import{D as et}from"./DeleteModal-Du1zPAFn.js";import{F as de}from"./FileSaver.min-CLobENq5.js";import{a as tt,u as Y,w as nt,P as rt,T as it}from"./xlsx-CBXfoY1t.js";import{A as st}from"./Add-JAHAPveB.js";import{S as at}from"./Search-DKotboAf.js";import{P as lt,C as me}from"./Pagination-D40pr0k0.js";import{E as ge}from"./Edit-D4H7Xh5Y.js";import{S as je}from"./Save-jijcoH0W.js";import{T as ot,a as Q}from"./Tabs-D07rxUwM.js";import"./FormControlLabel-Fb32HuXN.js";import"./LastPage-D5DKCjzm.js";import"./KeyboardArrowRight-nGgaUmNE.js";const dt=ye(e.jsx("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),ct=ye(e.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})),xt=({open:o,onClose:u,clientId:j,documents:y,hasKafeel:a=!1})=>{const[p,f]=v.useState(!1),[R,O]=v.useState({}),[E,h]=v.useState([]),U=ve(),J=(c,x)=>{c.length>0&&O(k=>({...k,[x]:c[0]}))},G=c=>{O(x=>{const k={...x};return delete k[c],k})},r=c=>{h(x=>[...x,c])},K=c=>{h(x=>x.filter(k=>k!==c))},ne=c=>c.type.startsWith("image/")?URL.createObjectURL(c):null,Z=async(c,x)=>{try{const _=await(await fetch(c)).blob();de.saveAs(_,x)}catch(k){console.error("Error downloading file:",k),$("حدث خطأ أثناء تحميل الملف")}},z=async c=>{try{window.open(c,"_blank")?.print()}catch(x){console.error("Error printing file:",x),$("حدث خطأ أثناء محاولة الطباعة")}},T=({fieldName:c,label:x,acceptedTypes:k,existingFile:_})=>{const{getRootProps:B,getInputProps:S,isDragActive:H}=Be({accept:k,onDrop:g=>J(g,c),multiple:!1}),F=R[c],n=E.includes(c);if(_&&!n&&!F){const g=_.split("/").pop();return e.jsx(C,{sx:{p:2},children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{children:x}),e.jsxs(d,{children:[e.jsx(P,{onClick:()=>z(_),children:e.jsx(ae,{})}),e.jsx(P,{onClick:()=>Z(_,g),children:e.jsx(le,{})}),e.jsx(P,{onClick:()=>r(c),color:"error",children:e.jsx(oe,{})})]})]})})}return n&&!F?e.jsx(C,{sx:{p:2,bgcolor:"#fff5f5"},children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(i,{color:"error",children:[x," (سيتم الحذف)"]}),e.jsx(D,{onClick:()=>K(c),children:"تراجع"})]})}):e.jsxs(C,{...B(),sx:{p:3,border:"2px dashed",borderColor:H?"primary.main":"#ccc",textAlign:"center",bgcolor:H?"action.hover":"#fafafa",cursor:"pointer","&:hover":{borderColor:"primary.main",bgcolor:"action.hover"}},children:[e.jsx("input",{...S()}),F?e.jsxs(d,{children:[F.type.startsWith("image/")?e.jsxs(d,{children:[e.jsx("img",{src:ne(F),alt:F.name,style:{maxWidth:"200px",maxHeight:120,marginBottom:8}}),e.jsx(i,{variant:"body2",children:F.name})]}):e.jsxs(d,{children:[e.jsx(ue,{sx:{fontSize:40,color:"primary.main",mb:1}}),e.jsx(i,{variant:"body2",children:F.name})]}),e.jsx(D,{startIcon:e.jsx(oe,{}),color:"error",size:"small",onClick:g=>{g.stopPropagation(),G(c)},sx:{mt:1},children:"إزالة"})]}):e.jsxs(d,{children:[e.jsx(ue,{sx:{fontSize:40,color:"#9e9e9e",mb:1}}),e.jsx(i,{variant:"body2",children:x}),e.jsx(i,{variant:"caption",color:"text.secondary",display:"block",mt:1,children:"اسحب وأفلت الملف هنا أو انقر للاختيار"})]})]})},I=async()=>{f(!0);try{const c=new FormData;Object.keys(R).forEach(x=>{c.append(x,R[x])}),E.length>0&&c.append("deleteFields",JSON.stringify(E)),await q.patch(`/api/clients/${j}/documents`,c,{headers:{"Content-Type":"multipart/form-data"}}),N("تم تحديث المستندات بنجاح"),u(),await U.invalidateQueries({queryKey:["clients"]}),await U.invalidateQueries({queryKey:["client-details",j]}),await U.refetchQueries({queryKey:["client-details",j]}),O({}),h([])}catch(c){console.error("Error updating documents:",c),$(c.response?.data?.message||"حدث خطأ أثناء تحديث المستندات")}finally{f(!1)}};return e.jsxs(Ae,{open:o,onClose:u,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2,direction:"rtl"}},children:[e.jsxs(Le,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e.jsx(i,{variant:"h6",fontWeight:"bold",children:"تعديل المرفقات"}),e.jsx(P,{onClick:u,size:"small",children:e.jsx($e,{})})]}),e.jsxs(ze,{sx:{pb:1},children:[e.jsxs(d,{mb:4,children:[e.jsx(i,{variant:"h6",color:"primary",mb:2,mt:2,children:"مرفقات العميل"}),e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(T,{fieldName:"clientIdImage",label:"صورة هوية العميل",acceptedTypes:{"image/*":[".png",".jpg",".jpeg"]},existingFile:y?.clientIdImage})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(T,{fieldName:"clientWorkCard",label:"بطاقة عمل العميل",acceptedTypes:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg"]},existingFile:y?.clientWorkCard})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(T,{fieldName:"salaryReport",label:"تقرير الراتب",acceptedTypes:{"application/pdf":[".pdf"],"application/msword":[".doc",".docx"]},existingFile:y?.salaryReport})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(T,{fieldName:"simaReport",label:"تقرير سمة",acceptedTypes:{"application/pdf":[".pdf"],"application/msword":[".doc",".docx"]},existingFile:y?.simaReport})})]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx(_e,{sx:{my:3}}),e.jsxs(d,{children:[e.jsx(i,{variant:"h6",color:"primary",mb:2,mt:2,children:"مرفقات الكفيل"}),e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(T,{fieldName:"kafeelIdImage",label:"صورة هوية الكفيل",acceptedTypes:{"image/*":[".png",".jpg",".jpeg"]},existingFile:y?.kafeelIdImage})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(T,{fieldName:"kafeelWorkCard",label:"بطاقة عمل الكفيل",acceptedTypes:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg"]},existingFile:y?.kafeelWorkCard})})]})]})]})]}),e.jsxs(Ue,{sx:{px:3,py:2,gap:2},children:[e.jsx(D,{onClick:u,variant:"outlined",color:"inherit",disabled:p,children:"إلغاء"}),e.jsx(D,{onClick:I,variant:"contained",disabled:p&&Object.keys(R).length===0&&E.length===0,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},minWidth:120},children:p?e.jsx(se,{size:24,color:"inherit"}):"حفظ التغييرات"})]})]})},ht=o=>{try{o.addFont("/assets/fonts/Amiri-Regular.ttf","Amiri","normal"),o.addFont("/assets/fonts/Amiri-Bold.ttf","Amiri","bold")}catch(u){console.warn("Arabic fonts not found, using default fonts",u)}},ft=async(o,u)=>new Promise((j,y)=>{try{const a=new Ne;ht(a),a.setProperties({title:`كشف حساب - ${u}`,subject:"كشف حساب العميل",author:"نظام إدارة السلف",keywords:"كشف, حساب, عميل, سلف",creator:"نظام إدارة السلف"}),a.setFont("Amiri","normal"),a.setFontSize(16),a.text("كشف حساب العميل",105,20,{align:"center"}),a.setFontSize(12),a.text(`العميل: ${u}`,105,30,{align:"center"}),a.text(`رقم الهوية: ${o.client.nationalId}`,105,37,{align:"center"}),a.setFontSize(10);let p=50;a.text(`الرصيد الافتتاحي: ${o.openingBalance.toLocaleString("en-US")} ريال`,14,p),p+=7,a.text(`الرصيد الختامي: ${o.closingBalance.toLocaleString("en-US")} ريال`,14,p),p+=7,a.text(`إجمالي المدين: ${o.client.debit.toLocaleString("en-US")} ريال`,14,p),p+=7,a.text(`إجمالي الدائن: ${o.client.credit.toLocaleString("en-US")} ريال`,14,p),p+=15;const f=o.transactions.map(h=>[h.balance.toLocaleString("en-US")+" ريال",h.credit>0?h.credit.toLocaleString("en-US")+" ريال":0,h.debit>0?h.debit.toLocaleString("en-US")+" ريال":0,h.description,Ce(h.type),new Date(h.date).toLocaleDateString("en-US")]);tt(a,{startY:p,head:[["الرصيد","دائن","مدين","الوصف","نوع المعاملة","التاريخ"]],body:f,theme:"grid",tableLineColor:[0,0,0],tableLineWidth:.1,styles:{font:"Amiri",fontStyle:"normal",fontSize:8,cellPadding:2,lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[13,64,165],textColor:255,fontStyle:"bold",fontSize:9},columnStyles:{0:{cellWidth:25},1:{cellWidth:25},2:{cellWidth:25},3:{cellWidth:50},4:{cellWidth:25},5:{cellWidth:25}},margin:{top:p,right:14,left:14},tableWidth:"auto",horizontalPageBreak:!0});const O=a.internal.getNumberOfPages();for(let h=1;h<=O;h++)a.setPage(h),a.setFontSize(8),a.text(`صفحة ${h} من ${O}`,a.internal.pageSize.width/2,a.internal.pageSize.height-10,{align:"center"}),a.text(`تم الإنشاء في: ${new Date().toLocaleDateString("ar-SA")}`,a.internal.pageSize.width-14,a.internal.pageSize.height-10,{align:"left"});const E=`كشف_حساب_${u}_${new Date().toISOString().split("T")[0]}.pdf`;a.save(E),j()}catch(a){console.error("PDF export error:",a.message),y(a)}}),ut=async(o,u)=>{try{const j=Y.book_new(),y=[["كشف حساب العميل"],[`العميل: ${u}`],[`رقم الهوية: ${o.client.nationalId}`],[""],["الرصيد الافتتاحي",o.openingBalance],["الرصيد الختامي",o.closingBalance],["إجمالي المدين",o.client.debit],["إجمالي الدائن",o.client.credit],[""]],a=o.transactions.map(h=>({الرصيد:h.balance,دائن:h.credit>0?h.credit:"-",مدين:h.debit>0?h.debit:"-",الوصف:h.description,"نوع المعاملة":Ce(h.type),التاريخ:new Date(h.date).toLocaleDateString("en-US")})),p=Y.aoa_to_sheet(y),f=Y.json_to_sheet(a);Y.book_append_sheet(j,p,"ملخص"),Y.book_append_sheet(j,f,"المعاملات");const R=nt(j,{bookType:"xlsx",type:"array"}),O=new Blob([R],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),E=`كشف_حساب_${u}_${new Date().toISOString().split("T")[0]}.xlsx`;de.saveAs(O,E)}catch(j){throw console.error("Excel export error:",j.message),j}},Ce=o=>({LOAN_DISBURSEMENT:"صرف سلفة",REPAYMENT:"سداد",ADJUSTMENT:"تعديل",INTEREST:"فائدة"})[o]||o,pt=async(o=1,u="",j="")=>{let y=new URLSearchParams;u.trim()&&(/^\d+$/.test(u.trim())?y.append("nationalId",u.trim()):y.append("name",u.trim())),j.trim()&&y.append("status",j.trim()),y.append("limit","10");const a=y.toString(),p=`/api/clients/all/${o}${a?`?${a}`:""}`;return(await q.get(p)).data},bt=async o=>(await q.get(`/api/clients/${o}`)).data,mt=async o=>(await q.get(`/api/clients/${o}/statement`)).data;function Ot(){const[o,u]=v.useState(0),[j,y]=v.useState(""),[a,p]=v.useState(""),[f,R]=v.useState(null),[O,E]=v.useState(!1),[h,U]=v.useState(!1),[J,G]=v.useState(null),[r,K]=v.useState(!1),[ne,Z]=v.useState(!1),[z,T]=v.useState(1),[I,c]=v.useState({}),[x,k]=v.useState({}),_=ve(),{permissions:B}=qe(),{data:S,isLoading:H,refetch:F}=ie({queryKey:["clients",z,j,a],queryFn:()=>pt(z,j,a),retry:1}),{data:n}=ie({queryKey:["client-details",f?.id],queryFn:()=>f?bt(f.id):null,enabled:!!f,retry:1}),{data:g}=ie({queryKey:["client-statement",f?.id],queryFn:()=>f?mt(f.id):null,enabled:!!f&&o===4,retry:1}),Se=Ve.debounce(t=>{y(t),T(1)},500),ke=t=>{Se(t.target.value)},re=(t,l)=>{T(l)},Ie=(t,l)=>{u(l)},We=t=>{R(t),K(!1)},M=(t,l)=>{c(b=>({...b,[t]:l}))},A=(t,l)=>{k(b=>({...b,[t]:t==="salary"||t==="obligations"?parseFloat(l)||0:l}))},we=async()=>{try{o===0?(await q.patch(`/api/clients/${f.id}/client-data`,I),N("تم تحديث بيانات العميل بنجاح")):o===2&&(await q.patch(`/api/clients/${f.id}/kafeel-data`,x),N("تم تحديث بيانات الكفيل بنجاح")),_.invalidateQueries({queryKey:["client-details",f.id]}),_.invalidateQueries({queryKey:["clients"]}),K(!1)}catch(t){$(t.response?.data?.message||"حدث خطأ أثناء تحديث البيانات"),te(t)}},De=()=>{E(!0)},Te=async t=>{try{await q.delete(`/api/clients/${t}`),N("تم حذف العميل بنجاح"),F(),f?.id===t&&R(null),U(!1),G(null)}catch(l){$(l.response?.data?.message||"حدث خطأ أثناء حذف العميل"),te(l)}},Re=t=>{G(t),U(!0)},ce=async(t,l,b,W)=>{try{const V=await(await fetch(t)).blob(),X=l.split(".").pop(),Me=`${b}_${W}.${X}`;de.saveAs(V,Me)}catch(L){$(L.response?.data?.message||"حدث خطأ أثناء تحميل الملف"),te(L)}},xe=async t=>{try{const b=await(await fetch(t)).blob(),W=URL.createObjectURL(b),L=window.open(W,"_blank");L?.addEventListener("load",()=>{L.print(),L.addEventListener("afterprint",()=>{URL.revokeObjectURL(W)})},{once:!0})}catch(l){$(l.response?.data?.message||"حدث خطأ أثناء محاولة الطباعة"),te(l)}},he=async(t,l,b)=>{try{const L=await(await fetch(t)).blob(),V=l+".pdf",X=new File([L],V,{type:L.type});navigator.canShare&&navigator.canShare({files:[X]})?await navigator.share({title:V,text:`مشاركة مستند: ${b}`,files:[X]}):(await navigator.clipboard.writeText(t),N("تم نسخ رابط الملف لأن المشاركة غير مدعومة"))}catch(W){console.error(W),$("حدث خطأ أثناء مشاركة الملف")}},Ee=async()=>{if(g)try{await ft(g,n.client.name),N("تم تصدير كشف الحساب بصيغة PDF بنجاح")}catch(t){$("حدث خطأ أثناء تصدير PDF"),console.error("PDF Export Error:",t)}},Pe=async()=>{if(g)try{await ut(g,n.client.name),N("تم تصدير كشف الحساب بصيغة Excel بنجاح")}catch(t){$("حدث خطأ أثناء تصدير Excel"),console.error("Excel Export Error:",t)}};v.useEffect(()=>{S?.clients?.length>0&&!f&&R(S.clients[0].client)},[S,f]),v.useEffect(()=>{n?.client&&c({name:n.client.name||"",phone:n.client.phone||"",city:n.client.city||"",district:n.client.district||"",address:n.client.address||"",employer:n.client.employer||"",creationReason:n.client.creationReason||"",notes:n.client.notes||"",birthDate:n.client.birthDate?new Date(n.client.birthDate).toISOString().split("T")[0]:""}),n?.kafeel&&k({name:n.kafeel.name||"",nationalId:n.kafeel.nationalId||"",birthDate:n.kafeel.birthDate?new Date(n.kafeel.birthDate).toISOString().split("T")[0]:"",city:n.kafeel.city||"",district:n.kafeel.district||"",employer:n.kafeel.employer||"",salary:n.kafeel.salary||"",obligations:n.kafeel.obligations||"",phone:n.kafeel.phone||"",email:n.kafeel.email||""})},[n]);const fe=t=>{switch(t){case"ملتزم":return"success";case"متأخر":return"warning";case"متعثر":return"error";default:return"default"}},Oe=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),Fe=t=>({LOAN_DISBURSEMENT:"صرف سلفة",REPAYMENT:"سداد",ADJUSTMENT:"تعديل",INTEREST:"فائدة"})[t]||t;return e.jsxs(d,{sx:{bgcolor:"#f6f6f8",minHeight:"100vh"},children:[e.jsxs(Ke,{children:[e.jsx("title",{children:"العملاء"}),e.jsx("meta",{name:"description",content:"العملاء"})]}),e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,bgcolor:"#fff",borderBottom:"1px solid #ddd"},children:[e.jsx(i,{variant:"h5",fontWeight:"bold",children:"العملاء"}),B.includes("clients_Add")&&e.jsx(D,{variant:"contained",startIcon:e.jsx(st,{sx:{marginLeft:"10px"}}),onClick:De,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},fontWeight:"bold",borderRadius:2,px:2.5,py:1},children:"إضافة عميل جديد"})]}),e.jsxs(d,{sx:{display:"flex",height:"calc(100vh - 80px)"},children:[e.jsxs(d,{sx:{width:"350px",borderRight:"1px solid #ddd",bgcolor:"#fafafa",height:"100%",overflowY:"auto",flexShrink:0},children:[e.jsxs(d,{sx:{p:3,borderBottom:"1px solid #ddd",bgcolor:"#fafafa"},children:[e.jsx(m,{placeholder:"البحث بالاسم أو رقم الهوية",fullWidth:!0,size:"small",onChange:ke,InputProps:{startAdornment:e.jsx(He,{position:"start",children:e.jsx(at,{})})}}),e.jsxs(d,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:2},children:[e.jsx(ee,{label:"ملتزم",color:a==="ملتزم"?"primary":"default",variant:"outlined",onClick:()=>{p(t=>t==="ملتزم"?"":"ملتزم"),T(1)}}),e.jsx(ee,{label:"متأخر",color:a==="متأخر"?"primary":"default",variant:"outlined",onClick:()=>{p(t=>t==="متأخر"?"":"متأخر"),T(1)}}),e.jsx(ee,{label:"متعثر",color:a==="متعثر"?"primary":"default",variant:"outlined",onClick:()=>{p(t=>t==="متعثر"?"":"متعثر"),T(1)}})]})]}),S&&!H&&e.jsx(d,{sx:{p:2,borderBottom:"1px solid #eee",bgcolor:"#f9f9f9"},children:e.jsxs(i,{variant:"body2",color:"black",children:["صفحة ",S.currentPage," من ",S.totalPages," - إجمالي ",S.totalClients," عميل"]})}),H?e.jsx(d,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(se,{})}):S?.clients?.length===0?e.jsxs(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:4,flexDirection:"column"},children:[e.jsx(i,{variant:"h6",color:"text.secondary",mb:1,children:"لا توجد عملاء"}),e.jsx(i,{variant:"body2",color:"black",children:j||a?"لم يتم العثور على عملاء مطابقين للبحث":"لا توجد عملاء مسجلين"})]}):S?.clients?.map(t=>{const l=t.client,b=f?.id===l.id;return e.jsxs(d,{sx:{p:2,borderBottom:"1px solid #eee",cursor:"pointer",bgcolor:b?"#e8efff":"inherit","&:hover":{bgcolor:"#f1f1f1"}},onClick:()=>We(l),children:[e.jsx(d,{display:"flex",justifyContent:"space-between",alignItems:"center",children:e.jsxs(d,{children:[e.jsx(i,{fontWeight:"bold",color:b?"primary.main":"text.primary",children:l.name}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:["رقم الهوية: ",l.nationalId]})]})}),e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1,children:[e.jsx(ee,{label:l.status,size:"small",color:fe(l.status),variant:"outlined"}),B.includes("clients_Delete")&&e.jsx(P,{size:"small",color:"error",onClick:W=>{W.stopPropagation(),Re(l)},children:e.jsx(oe,{fontSize:"small"})})]})]},l.id)}),S&&S.totalPages>1&&e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderTop:"1px solid #eee",bgcolor:"#fafafa"},children:[e.jsx(D,{variant:"outlined",size:"small",startIcon:e.jsx(ct,{}),disabled:z===1,onClick:()=>re(null,z-1),sx:{minWidth:"80px","&:disabled":{opacity:.5}},children:"السابق"}),e.jsx(lt,{count:S.totalPages,page:z,onChange:re,color:"primary",size:"small",siblingCount:1,boundaryCount:1,sx:{"& .MuiPaginationItem-root":{fontSize:"0.875rem"}}}),e.jsx(D,{variant:"outlined",size:"small",endIcon:e.jsx(dt,{}),disabled:z===S.totalPages,onClick:()=>re(null,z+1),sx:{minWidth:"80px","&:disabled":{opacity:.5}},children:"التالي"})]})]}),f&&n?e.jsxs(d,{sx:{flex:1,p:4,bgcolor:"#fff",overflowY:"auto"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(d,{children:[e.jsx(i,{variant:"h6",fontWeight:"bold",children:n.client.name}),e.jsxs(i,{color:"text.secondary",children:["رقم الهوية: ",n.client.nationalId]})]}),o!==1&&o!==4&&e.jsx(d,{sx:{display:"flex",gap:2},children:o===3?e.jsxs(e.Fragment,{children:[B.includes("clients_Update")&&e.jsx(D,{variant:"outlined",startIcon:e.jsx(ge,{sx:{marginLeft:"10px"}}),onClick:()=>Z(!0),children:"تعديل"}),B.includes("clients_Save")&&e.jsx(D,{variant:"contained",startIcon:e.jsx(je,{sx:{marginLeft:"10px"}}),sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"}},disabled:!r,children:"حفظ التغييرات"})]}):e.jsxs(e.Fragment,{children:[B.includes("clients_Update")&&e.jsx(D,{variant:"outlined",startIcon:e.jsx(ge,{sx:{marginLeft:"10px"}}),onClick:()=>K(!r),children:r?"إلغاء التعديل":"تعديل"}),e.jsx(D,{variant:"contained",startIcon:e.jsx(je,{sx:{marginLeft:"10px"}}),sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"}},disabled:!r,onClick:we,children:"حفظ التغييرات"})]})})]}),e.jsxs(ot,{value:o,onChange:Ie,textColor:"primary",indicatorColor:"primary",sx:{mb:3},children:[e.jsx(Q,{label:"الملف الشخصي"}),e.jsx(Q,{label:"المعلومات المالية"}),e.jsx(Q,{label:"الكفيل"}),e.jsx(Q,{label:"المرفقات"}),e.jsx(Q,{label:"كشف حساب"})]}),o===0&&e.jsxs(d,{children:[e.jsxs(C,{sx:{p:3,mb:3},children:[e.jsx(i,{variant:"h6",mb:3,children:"المعلومات الشخصية"}),e.jsxs(s,{container:!0,spacing:3,children:[e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"الاسم الكامل"}),e.jsx(m,{value:r?I.name:n.client.name,onChange:t=>M("name",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px",width:"280px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"البريد الإلكتروني"}),e.jsx(m,{value:r?I.email:n.client.email||"لا يوجد بريد إلكتروني",onChange:t=>M("email",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"رقم الهوية الوطنية"}),e.jsx(m,{value:n.client.nationalId,fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"رقم الجوال"}),e.jsx(m,{value:r?I.phone:n.client.phone,onChange:t=>M("phone",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"تاريخ الميلاد"}),e.jsx(m,{value:r?I.birthDate:n.client.birthDate?new Date(n.client.birthDate).toISOString().split("T")[0]:"",onChange:t=>M("birthDate",t.target.value),fullWidth:!0,type:"date",disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"المدينة"}),e.jsx(m,{value:r?I.city:n.client.city,onChange:t=>M("city",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"الحي"}),e.jsx(m,{value:r?I.district:n.client.district,onChange:t=>M("district",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px",width:"280px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"العنوان التفصيلي"}),e.jsx(m,{value:r?I.address:n.client.address||"",onChange:t=>M("address",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px",width:"350px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"جهة العمل"}),e.jsx(m,{value:r?I.employer:n.client.employer,onChange:t=>M("employer",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"سبب الإنشاء"}),e.jsx(m,{value:r?I.creationReason:n.client.creationReason||"",onChange:t=>M("creationReason",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]})]})]}),e.jsxs(C,{sx:{p:3,mt:3},children:[e.jsx(i,{variant:"h6",mb:3,children:"ملاحظات"}),e.jsx(m,{value:r?I.notes:n.client.notes||"",onChange:t=>M("notes",t.target.value),fullWidth:!0,multiline:!0,rows:3,disabled:!r,placeholder:"لا توجد ملاحظات",sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]})]}),o===1&&e.jsxs(C,{sx:{p:3},children:[e.jsx(i,{variant:"h6",mb:3,children:"المعلومات المالية"}),e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,md:4,children:e.jsxs(C,{sx:{p:3,bgcolor:"#f8f9fa"},children:[e.jsx(i,{variant:"body1",color:"text.secondary",mb:1,children:"الراتب"}),e.jsxs(i,{variant:"h5",fontWeight:"bold",color:"primary",children:[n.client.salary?.toLocaleString()," ريال"]})]})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsxs(C,{sx:{p:3,bgcolor:"#f8f9fa"},children:[e.jsx(i,{variant:"body1",color:"text.secondary",mb:1,children:"الالتزامات"}),e.jsxs(i,{variant:"h5",fontWeight:"bold",color:"error",children:[n.client.obligations?.toLocaleString()," ","ريال"]})]})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsxs(C,{sx:{p:3,bgcolor:"#f8f9fa"},children:[e.jsx(i,{variant:"body1",color:"text.secondary",mb:1,children:"الحالة"}),e.jsx(i,{variant:"h5",fontWeight:"bold",color:fe(n.client.status),children:n.client.status})]})})]})]}),o===2&&e.jsxs(C,{sx:{p:3},children:[e.jsx(i,{variant:"h6",mb:3,children:"معلومات الكفيل"}),n.kafeel?e.jsxs(s,{container:!0,spacing:3,children:[e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"اسم الكفيل"}),e.jsx(m,{value:r?x.name:n.kafeel.name,onChange:t=>A("name",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"رقم هوية الكفيل"}),e.jsx(m,{value:r?x.nationalId:n.kafeel.nationalId,onChange:t=>A("nationalId",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"تاريخ الميلاد"}),e.jsx(m,{value:r?x.birthDate:n.kafeel.birthDate?new Date(n.kafeel.birthDate).toISOString().split("T")[0]:"",onChange:t=>A("birthDate",t.target.value),fullWidth:!0,type:"date",disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"المدينة"}),e.jsx(m,{value:r?x.city:n.kafeel.city,onChange:t=>A("city",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"الحي"}),e.jsx(m,{value:r?x.district:n.kafeel.district,onChange:t=>A("district",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"رقم الجوال"}),e.jsx(m,{value:r?x.phone:n.kafeel.phone,onChange:t=>A("phone",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"البريد الإلكتروني"}),e.jsx(m,{value:r?x.email:n.kafeel.email,onChange:t=>A("email",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"جهة العمل"}),e.jsx(m,{value:r?x.employer:n.kafeel.employer,onChange:t=>A("employer",t.target.value),fullWidth:!0,disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"الراتب"}),e.jsx(m,{value:r?x.salary:n.kafeel.salary,onChange:t=>A("salary",t.target.value),fullWidth:!0,type:"number",disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"body2",mb:1,fontWeight:500,children:"الالتزامات"}),e.jsx(m,{value:r?x.obligations:n.kafeel.obligations,onChange:t=>A("obligations",t.target.value),fullWidth:!0,type:"number",disabled:!r,sx:{"& .MuiOutlinedInput-root":{backgroundColor:r?"#fff":"#f9fafb",borderRadius:"6px"}}})]})]}):e.jsx(i,{variant:"body1",color:"text.secondary",align:"center",children:"لا يوجد كفيل لهذا العميل"})]}),o===3&&e.jsxs(d,{children:[e.jsxs(d,{sx:{mb:3},children:[e.jsx(i,{variant:"h5",sx:{mb:2,color:"primary.main"},children:"مستندات العميل"}),n.documents&&n.documents.length>0?e.jsx(s,{container:!0,spacing:2,children:Object.entries(n.documents[0]).map(([t,l])=>{const b={clientIdImage:"صورة هوية العميل",clientWorkCard:"بطاقة عمل العميل",salaryReport:"تقرير الراتب",simaReport:"تقرير SIMA",DEBT_ACKNOWLEDGMENT:"إقرار الدين",PROMISSORY_NOTE:"سند الأمر"};return l&&b[t]?e.jsx(s,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(me,{color:"success",fontSize:"small"}),e.jsx(d,{children:e.jsx(i,{fontWeight:"500",children:b[t]})})]}),e.jsxs(d,{children:[e.jsx(P,{onClick:()=>xe(l),children:e.jsx(ae,{})}),e.jsx(P,{onClick:()=>ce(l,"",b[t],n.client.name),children:e.jsx(le,{})}),e.jsx(P,{onClick:W=>{W.stopPropagation(),he(l,b[t],n.client.name)},title:"مشاركة",children:e.jsx(pe,{})})]})]})},t):null})}):e.jsx(C,{sx:{p:3,textAlign:"center",mb:3},children:e.jsx(i,{color:"text.secondary",children:"لا توجد مستندات للعميل"})})]}),n.kafeel&&e.jsxs(d,{sx:{mt:5,mb:3},children:[e.jsx(i,{variant:"h5",sx:{mt:5,mb:2,color:"primary.main"},children:"مستندات الكفيل"}),n.documents&&n.documents.length>0?e.jsx(s,{container:!0,spacing:2,children:Object.entries(n.documents[0]).map(([t,l])=>{const b={kafeelIdImage:"صورة هوية الكفيل",kafeelWorkCard:"بطاقة عمل الكفيل"};return l&&b[t]?e.jsx(s,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(me,{color:"success",fontSize:"small"}),e.jsx(d,{children:e.jsx(i,{fontWeight:"500",children:b[t]})})]}),e.jsxs(d,{children:[e.jsx(P,{onClick:()=>xe(l),children:e.jsx(ae,{})}),e.jsx(P,{onClick:()=>ce(l,"",b[t],n.client.name),children:e.jsx(le,{})}),e.jsx(P,{onClick:W=>{W.stopPropagation(),he(l,b[t],n.client.name)},title:"مشاركة",children:e.jsx(pe,{})})]})]})},t):null})}):e.jsx(C,{sx:{p:3,textAlign:"center"},children:e.jsx(i,{color:"text.secondary",children:"لا توجد مستندات للكفيل"})})]})]}),o===4&&e.jsxs(d,{children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mb:3},children:[e.jsx(D,{variant:"outlined",startIcon:e.jsx(rt,{sx:{marginLeft:"10px"}}),onClick:Ee,disabled:!g,sx:{borderColor:"#d32f2f",color:"#d32f2f","&:hover":{borderColor:"#b71c1c",backgroundColor:"rgba(211, 47, 47, 0.04)"}},children:"تصدير PDF"}),e.jsx(D,{variant:"outlined",startIcon:e.jsx(it,{sx:{marginLeft:"10px"}}),onClick:Pe,disabled:!g,sx:{borderColor:"#2e7d32",color:"#2e7d32","&:hover":{borderColor:"#1b5e20",backgroundColor:"rgba(46, 125, 50, 0.04)"}},children:"تصدير Excel"})]}),g&&e.jsx(C,{sx:{p:3,mb:3,bgcolor:"#f8f9fa"},children:e.jsxs(s,{container:!0,spacing:6,justifyContent:"center",alignItems:"center",children:[e.jsxs(s,{item:!0,xs:12,md:3,alignItems:"center",children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"الرصيد الافتتاحي"}),e.jsx(i,{variant:"h6",fontWeight:"bold",color:"primary",children:g.openingBalance})]}),e.jsxs(s,{item:!0,xs:12,md:3,alignItems:"center",children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"الرصيد الختامي"}),e.jsx(i,{variant:"h6",fontWeight:"bold",color:"primary",children:g.closingBalance})]}),e.jsxs(s,{item:!0,xs:12,md:3,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"إجمالي المدين"}),e.jsx(i,{variant:"h6",fontWeight:"bold",color:"error",children:g.client.debit})]}),e.jsxs(s,{item:!0,xs:12,md:3,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"إجمالي الدائن"}),e.jsx(i,{variant:"h6",fontWeight:"bold",color:"success.main",children:g.client.credit})]})]})}),e.jsx(C,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Ye,{sx:{maxHeight:600},children:e.jsxs(Qe,{stickyHeader:!0,"aria-label":"كشف حساب العميل",children:[e.jsx(Je,{children:e.jsxs(Ge,{children:[e.jsx(w,{align:"center",sx:{fontWeight:"bold",minWidth:120},children:"التاريخ"}),e.jsx(w,{align:"center",sx:{fontWeight:"bold",minWidth:120},children:"نوع المعاملة"}),e.jsx(w,{align:"center",sx:{fontWeight:"bold",minWidth:200},children:"الوصف"}),e.jsx(w,{align:"center",sx:{fontWeight:"bold",minWidth:120},children:"مدين"}),e.jsx(w,{align:"center",sx:{fontWeight:"bold",minWidth:120},children:"دائن"}),e.jsx(w,{align:"center",sx:{fontWeight:"bold",minWidth:120},children:"الرصيد"})]})}),e.jsx(Ze,{children:g&&g.transactions&&g.transactions.length>0?g.transactions.map((t,l)=>e.jsxs(be,{hover:!0,children:[e.jsx(w,{align:"center",children:Oe(t.date)}),e.jsx(w,{align:"center",children:Fe(t.type)}),e.jsx(w,{align:"center",children:t.description}),e.jsx(w,{align:"center",sx:{color:t.debit>0?"error.main":"text.primary"},children:t.debit>0?t.debit:0}),e.jsx(w,{align:"center",sx:{color:t.credit>0?"success.main":"text.primary"},children:t.credit>0?t.credit:0}),e.jsx(w,{align:"center",sx:{fontWeight:"bold"},children:t.balance})]},l)):e.jsx(be,{children:e.jsx(w,{colSpan:6,align:"center",sx:{py:3},children:e.jsx(i,{variant:"body1",color:"text.secondary",children:"لا توجد معاملات"})})})})]})})})]})]}):e.jsxs(d,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:2},children:[e.jsx(i,{variant:"h6",color:"text.secondary",children:f?"جاري تحميل البيانات...":"اختر عميلاً لعرض التفاصيل"}),f&&e.jsx(se,{size:40})]})]}),e.jsx(Xe,{open:O,onClose:()=>E(!1)}),e.jsx(et,{open:h,onClose:()=>U(!1),onConfirm:()=>Te(J?.id),title:"حذف العميل",message:`هل أنت متأكد من حذف العميل ${J?.name}؟`,ButtonText:"حذف"}),e.jsx(xt,{open:ne,onClose:()=>Z(!1),clientId:f?.id,documents:n?.documents?.[0],hasKafeel:!!n?.kafeel})]})}export{Ot as default};
//# sourceMappingURL=Clients-wiMp7R7P.js.map
