import{i as M,k as L,r as R,l as U,q as F,s as E,t as K,j as e,v,w as V,m as N,S as X,x as G,G as H,D as Q,y as J,T as u,I as Y,z as Z,au as _,av as ee,aw as ae,E as te,B as b,a1 as r,a as c,J as ie,F as le,d as $,C as re,A as se,n as ne,e as oe,a2 as ce,P as de,a5 as A,X as pe}from"./index-2TEkS4Tk.js";import{F as me,a as xe,c as fe,g as D,b as p,f as he,h as ue}from"./index.esm-Q7QO3LVB.js";import{F as be}from"./lodash-CxsAddGS.js";function ke(a){return L("MuiSwitch",a)}const m=M("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),je=a=>{const{classes:n,edge:d,size:k,color:j,checked:T,disabled:S}=a,B={root:["root",d&&`edge${v(d)}`,`size${v(k)}`],switchBase:["switchBase",`color${v(j)}`,T&&"checked",S&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},I=V(B,ke,n);return{...n,...I}},ge=E("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(a,n)=>{const{ownerState:d}=a;return[n.root,d.edge&&n[`edge${v(d.edge)}`],n[`size${v(d.size)}`]]}})({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${m.thumb}`]:{width:16,height:16},[`& .${m.switchBase}`]:{padding:4,[`&.${m.checked}`]:{transform:"translateX(16px)"}}}}]}),ye=E(X,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(a,n)=>{const{ownerState:d}=a;return[n.switchBase,{[`& .${m.input}`]:n.input},d.color!=="default"&&n[`color${v(d.color)}`]]}})(N(({theme:a})=>({position:"absolute",top:0,left:0,zIndex:1,color:a.vars?a.vars.palette.Switch.defaultColor:`${a.palette.mode==="light"?a.palette.common.white:a.palette.grey[300]}`,transition:a.transitions.create(["left","transform"],{duration:a.transitions.duration.shortest}),[`&.${m.checked}`]:{transform:"translateX(20px)"},[`&.${m.disabled}`]:{color:a.vars?a.vars.palette.Switch.defaultDisabledColor:`${a.palette.mode==="light"?a.palette.grey[100]:a.palette.grey[600]}`},[`&.${m.checked} + .${m.track}`]:{opacity:.5},[`&.${m.disabled} + .${m.track}`]:{opacity:a.vars?a.vars.opacity.switchTrackDisabled:`${a.palette.mode==="light"?.12:.2}`},[`& .${m.input}`]:{left:"-100%",width:"300%"}})),N(({theme:a})=>({"&:hover":{backgroundColor:a.alpha((a.vars||a).palette.action.active,(a.vars||a).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(a.palette).filter(G(["light"])).map(([n])=>({props:{color:n},style:{[`&.${m.checked}`]:{color:(a.vars||a).palette[n].main,"&:hover":{backgroundColor:a.alpha((a.vars||a).palette[n].main,(a.vars||a).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${m.disabled}`]:{color:a.vars?a.vars.palette.Switch[`${n}DisabledColor`]:`${a.palette.mode==="light"?a.lighten(a.palette[n].main,.62):a.darken(a.palette[n].main,.55)}`}},[`&.${m.checked} + .${m.track}`]:{backgroundColor:(a.vars||a).palette[n].main}}}))]}))),we=E("span",{name:"MuiSwitch",slot:"Track"})(N(({theme:a})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:a.transitions.create(["opacity","background-color"],{duration:a.transitions.duration.shortest}),backgroundColor:a.vars?a.vars.palette.common.onBackground:`${a.palette.mode==="light"?a.palette.common.black:a.palette.common.white}`,opacity:a.vars?a.vars.opacity.switchTrack:`${a.palette.mode==="light"?.38:.3}`}))),Se=E("span",{name:"MuiSwitch",slot:"Thumb"})(N(({theme:a})=>({boxShadow:(a.vars||a).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}))),Be=R.forwardRef(function(n,d){const k=U({props:n,name:"MuiSwitch"}),{className:j,color:T="primary",edge:S=!1,size:B="medium",sx:I,slots:g={},slotProps:x={},...z}=k,f={...k,color:T,edge:S,size:B},C=je(f),W={slots:g,slotProps:x},[q,y]=F("root",{className:K(C.root,j),elementType:ge,externalForwardedProps:W,ownerState:f,additionalProps:{sx:I}}),[O,i]=F("thumb",{className:C.thumb,elementType:Se,externalForwardedProps:W,ownerState:f}),l=e.jsx(O,{...i}),[t,s]=F("track",{className:C.track,elementType:we,externalForwardedProps:W,ownerState:f});return e.jsxs(q,{...y,children:[e.jsx(ye,{type:"checkbox",icon:l,checkedIcon:l,ref:d,ownerState:f,...z,classes:{...C,root:C.switchBase},slots:{...g.switchBase&&{root:g.switchBase},...g.input&&{input:g.input}},slotProps:{...x.switchBase&&{root:typeof x.switchBase=="function"?x.switchBase(f):x.switchBase},input:{role:"switch"},...x.input&&{input:typeof x.input=="function"?x.input(f):x.input}}}),e.jsx(t,{...s})]})}),Ce=a=>fe().shape({name:p().required("اسم العميل مطلوب"),phone:p().required("رقم الجوال مطلوب"),email:p().email("البريد الإلكتروني غير صالح"),nationalId:p().required("رقم الهوية الوطنية مطلوب"),birthDate:ue().required("تاريخ الميلاد مطلوب"),city:p().required("المدينة مطلوبة"),district:p().required("الحي مطلوب"),address:p().required("العنوان مطلوب"),employer:p().required("جهة العمل مطلوبة"),salary:D().required("الراتب مطلوب").min(1,"الراتب يجب أن يكون أكبر من صفر"),obligations:D().required("الالتزامات مطلوبة").min(0,"الالتزامات يجب أن تكون صفر أو أكثر"),creationReason:p().required("سبب الإنشاء مطلوب"),notes:p(),hasKafeel:he(),kafeelName:a?p().required("اسم الكفيل مطلوب"):p(),kafeelNationalId:a?p().required("رقم هوية الكفيل مطلوب"):p(),kafeelPhone:a?p().required("رقم جوال الكفيل مطلوب"):p(),kafeelEmail:a?p().email("البريد الإلكتروني غير صالح"):p().email("البريد الإلكتروني غير صالح"),kafeelEmployer:a?p().required("جهة عمل الكفيل مطلوبة"):p(),kafeelSalary:a?D().required("راتب الكفيل مطلوب").min(1,"الراتب يجب أن يكون أكبر من صفر"):D(),kafeelObligations:a?D().required("التزامات الكفيل مطلوبة").min(0,"الالتزامات يجب أن تكون صفر أو أكثر"):D()}),Ie=({open:a,onClose:n})=>{const[d,k]=R.useState(0),[j,T]=R.useState(!1),[S,B]=R.useState({}),I=H(),g=["المعلومات الأساسية","معلومات الكفيل","المستندات"],x={name:"",phone:"",email:"",nationalId:"",birthDate:"",city:"",district:"",address:"",employer:"",salary:"",obligations:"",creationReason:"",notes:"",hasKafeel:!1,kafeelName:"",kafeelNationalId:"",kafeelBirthDate:"",kafeelCity:"",kafeelDistrict:"",kafeelEmployer:"",kafeelSalary:"",kafeelObligations:"",kafeelPhone:"",kafeelEmail:""},z=()=>{k(i=>i+1)},f=()=>{k(i=>i-1)},C=(i,l)=>{i.length>0&&B(t=>({...t,[l]:i[0]}))},W=i=>{B(l=>{const t={...l};return delete t[i],t})},q=i=>i.type.startsWith("image/")?URL.createObjectURL(i):null,y=({fieldName:i,label:l,acceptedTypes:t})=>{const{getRootProps:s,getInputProps:o,isDragActive:P}=ce({accept:t,onDrop:h=>C(h,i),multiple:!1}),w=S[i];return e.jsxs(de,{...s(),sx:{p:3,border:"2px dashed",borderColor:P?"primary.main":"#ccc",textAlign:"center",bgcolor:P?"action.hover":"#fafafa",cursor:"pointer","&:hover":{borderColor:"primary.main",bgcolor:"action.hover"}},children:[e.jsx("input",{...o()}),w?e.jsxs(b,{children:[w.type.startsWith("image/")?e.jsxs(b,{children:[e.jsx("img",{src:q(w),alt:w.name,style:{maxWidth:"200px",maxHeight:120,marginBottom:8}}),e.jsx(u,{variant:"body2",children:w.name})]}):e.jsxs(b,{children:[e.jsx(A,{sx:{fontSize:40,color:"primary.main",mb:1}}),e.jsx(u,{variant:"body2",children:w.name})]}),e.jsx($,{startIcon:e.jsx(pe,{}),color:"error",size:"small",onClick:h=>{h.stopPropagation(),W(i)},sx:{mt:1},children:"إزالة"})]}):e.jsxs(b,{children:[e.jsx(A,{sx:{fontSize:40,color:"#9e9e9e",mb:1}}),e.jsx(u,{variant:"body2",children:l}),e.jsx(u,{variant:"caption",color:"text.secondary",display:"block",mt:1,children:"اسحب وأفلت الملف هنا أو انقر للاختيار"})]})]})},O=async i=>{T(!0);try{const l=new FormData;Object.keys(i).forEach(t=>{t==="hasKafeel"?l.append(t,i[t]):t.startsWith("kafeel")||l.append(t,i[t])}),i.hasKafeel&&Object.keys(i).forEach(t=>{if(t.startsWith("kafeel")&&t!=="hasKafeel"){const s=t.replace("kafeel","");l.append(`kafeel[${s.charAt(0).toLowerCase()+s.slice(1)}]`,i[t])}}),Object.keys(S).forEach(t=>{l.append(t,S[t])}),await se.post("/api/clients",l,{headers:{"Content-Type":"multipart/form-data"}}),ne("تم إضافة العميل بنجاح"),I.invalidateQueries({queryKey:["clients"]}),n(),k(0),B({})}catch(l){oe(l.response?.data?.message||"حدث خطأ أثناء إضافة العميل")}finally{T(!1)}};return e.jsxs(Q,{open:a,onClose:n,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2,direction:"rtl"}},children:[e.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e.jsx(u,{variant:"h6",fontWeight:"bold",children:"إضافة عميل جديد"}),e.jsx(Y,{onClick:n,size:"small",children:e.jsx(Z,{})})]}),e.jsx(_,{activeStep:d,sx:{p:3,pb:0},children:g.map(i=>e.jsx(ee,{children:e.jsx(ae,{children:i})},i))}),e.jsx(me,{initialValues:x,validationSchema:Ce,onSubmit:O,enableReinitialize:!0,children:({values:i,errors:l,touched:t,handleChange:s,handleBlur:o,setFieldValue:P,submitForm:w})=>e.jsxs(xe,{onSubmit:h=>h.preventDefault(),children:[e.jsxs(te,{sx:{pb:1,minHeight:400},children:[d===0&&e.jsxs(b,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(u,{variant:"h6",sx:{mb:2},children:"المعلومات الشخصية للعميل"}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"name",label:"اسم العميل",value:i.name,onChange:s,onBlur:o,error:t.name&&!!l.name,helperText:t.name&&l.name})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"nationalId",label:"رقم الهوية الوطنية",value:i.nationalId,onChange:s,onBlur:o,error:t.nationalId&&!!l.nationalId,helperText:t.nationalId&&l.nationalId})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"email",label:" البريد الإلكتروني (اختياري)",type:"email",value:i.email,onChange:s,onBlur:o,error:t.email&&!!l.email,helperText:t.email&&l.email})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"birthDate",label:"تاريخ الميلاد",type:"date",value:i.birthDate,onChange:s,onBlur:o,error:t.birthDate&&!!l.birthDate,helperText:t.birthDate&&l.birthDate,InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"phone",label:"رقم الجوال",value:i.phone,onChange:s,onBlur:o,error:t.phone&&!!l.phone,helperText:t.phone&&l.phone})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"city",label:"المدينة",value:i.city,onChange:s,onBlur:o,error:t.city&&!!l.city,helperText:t.city&&l.city})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"district",label:"الحي",value:i.district,onChange:s,onBlur:o,error:t.district&&!!l.district,helperText:t.district&&l.district})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,name:"address",label:"العنوان التفصيلي",value:i.address,onChange:s,onBlur:o,error:t.address&&!!l.address,helperText:t.address&&l.address})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"employer",label:"جهة العمل",value:i.employer,onChange:s,onBlur:o,error:t.employer&&!!l.employer,helperText:t.employer&&l.employer})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"salary",label:"الراتب",type:"number",value:i.salary,onChange:s,onBlur:o,error:t.salary&&!!l.salary,helperText:t.salary&&l.salary})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"obligations",label:"الالتزامات",type:"number",value:i.obligations,onChange:s,onBlur:o,error:t.obligations&&!!l.obligations,helperText:t.obligations&&l.obligations})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,name:"creationReason",label:"سبب الإنشاء",value:i.creationReason,onChange:s,onBlur:o,error:t.creationReason&&!!l.creationReason,helperText:t.creationReason&&l.creationReason})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,name:"notes",label:"ملاحظات",multiline:!0,rows:2,value:i.notes,onChange:s,onBlur:o,error:t.notes&&!!l.notes,helperText:t.notes&&l.notes,sx:{"& .MuiOutlinedInput-root":{width:"800px"}}})})]}),e.jsx(be,{control:e.jsx(Be,{checked:i.hasKafeel,onChange:h=>P("hasKafeel",h.target.checked)}),label:"هل يوجد كفيل؟"})]}),d===1&&i.hasKafeel&&e.jsxs(b,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(u,{variant:"h6",sx:{mb:2},children:"معلومات الكفيل"}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"kafeelName",label:"اسم الكفيل",value:i.kafeelName,onChange:s,onBlur:o,error:t.kafeelName&&!!l.kafeelName,helperText:t.kafeelName&&l.kafeelName})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"kafeelNationalId",label:"رقم هوية الكفيل",value:i.kafeelNationalId,onChange:s,onBlur:o,error:t.kafeelNationalId&&!!l.kafeelNationalId,helperText:t.kafeelNationalId&&l.kafeelNationalId})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"kafeelBirthDate",label:"تاريخ الميلاد",type:"date",value:i.kafeelBirthDate,onChange:s,onBlur:o,error:t.kafeelBirthDate&&!!l.kafeelBirthDate,helperText:t.kafeelBirthDate&&l.kafeelBirthDate,InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"kafeelPhone",label:"رقم جوال الكفيل",value:i.kafeelPhone,onChange:s,onBlur:o,error:t.kafeelPhone&&!!l.kafeelPhone,helperText:t.kafeelPhone&&l.kafeelPhone})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"kafeelEmail",label:"البريد الإلكتروني (اختياري)",type:"email",value:i.kafeelEmail,onChange:s,onBlur:o,error:t.kafeelEmail&&!!l.kafeelEmail,helperText:t.kafeelEmail&&l.kafeelEmail})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"kafeelCity",label:"المدينة",value:i.kafeelCity,onChange:s,onBlur:o,error:t.kafeelCity&&!!l.kafeelCity,helperText:t.kafeelCity&&l.kafeelCity})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"kafeelDistrict",label:"الحي",value:i.kafeelDistrict,onChange:s,onBlur:o,error:t.kafeelDistrict&&!!l.kafeelDistrict,helperText:t.kafeelDistrict&&l.kafeelDistrict})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"kafeelEmployer",label:"جهة عمل الكفيل",value:i.kafeelEmployer,onChange:s,onBlur:o,error:t.kafeelEmployer&&!!l.kafeelEmployer,helperText:t.kafeelEmployer&&l.kafeelEmployer})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"kafeelSalary",label:"راتب الكفيل",type:"number",value:i.kafeelSalary,onChange:s,onBlur:o,error:t.kafeelSalary&&!!l.kafeelSalary,helperText:t.kafeelSalary&&l.kafeelSalary})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,name:"kafeelObligations",label:"التزامات الكفيل",type:"number",value:i.kafeelObligations,onChange:s,onBlur:o,error:t.kafeelObligations&&!!l.kafeelObligations,helperText:t.kafeelObligations&&l.kafeelObligations})})]})]}),d===1&&!i.hasKafeel&&e.jsx(ie,{severity:"info",sx:{mt:2},children:"تم تعطيل معلومات الكفيل. يمكنك المتابعة إلى الخطوة التالية."}),d===2&&e.jsxs(b,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(u,{variant:"h6",children:"مستندات العميل"}),e.jsxs(r,{container:!0,spacing:3,children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(y,{fieldName:"clientIdImage",label:"صورة هوية العميل",acceptedTypes:{"image/*":[".png",".jpg",".jpeg"]}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(y,{fieldName:"clientWorkCard",label:"بطاقة عمل العميل",acceptedTypes:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg"]}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(y,{fieldName:"salaryReport",label:"تقرير الراتب",acceptedTypes:{"application/pdf":[".pdf"],"application/msword":[".doc",".docx"]}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(y,{fieldName:"simaReport",label:"تقرير سمة",acceptedTypes:{"application/pdf":[".pdf"],"application/msword":[".doc",".docx"]}})})]}),i.hasKafeel&&e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"h6",sx:{mt:3},children:"مستندات الكفيل"}),e.jsxs(r,{container:!0,spacing:3,children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(y,{fieldName:"kafeelIdImage",label:"صورة هوية الكفيل",acceptedTypes:{"image/*":[".png",".jpg",".jpeg"]}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(y,{fieldName:"kafeelWorkCard",label:"بطاقة عمل الكفيل",acceptedTypes:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg"]}})})]})]})]})]}),e.jsxs(le,{sx:{px:3,py:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(b,{children:d>0&&e.jsx($,{onClick:f,disabled:j,children:"رجوع"})}),e.jsxs(b,{sx:{display:"flex",gap:2},children:[e.jsx($,{onClick:n,variant:"outlined",color:"inherit",disabled:j,children:"إلغاء"}),d<g.length-1?e.jsx($,{onClick:z,variant:"contained",disabled:d===1&&i.hasKafeel&&Object.keys(l).some(h=>h.startsWith("kafeel"))||d===0&&(!i.name||!i.phone||!i.nationalId||!i.birthDate||!i.city||!i.district||!i.address||!i.employer||!i.salary||!i.obligations||!i.creationReason),sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"}},children:"التالي"}):e.jsx($,{onClick:w,variant:"contained",disabled:j,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},minWidth:120},children:j?e.jsx(re,{size:24,color:"inherit"}):"إضافة العميل"})]})]})]})})]})};export{Ie as A};
//# sourceMappingURL=AddClient-2kBVpEQJ.js.map
