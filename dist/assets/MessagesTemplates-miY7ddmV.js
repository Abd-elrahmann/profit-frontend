import{r as l,a7 as h,A as w,e as S,h as L,j as t,B as o,P as z,C as M,T,d as V,_ as $,a1 as B,V as O,n as E}from"./index-2TEkS4Tk.js";import{S as q}from"./Save-ue_qOb6O.js";import{R as f,a as J,C as K}from"./ReactQuillWrapper-MWbAM1aq.js";import{T as U,a as j}from"./Tabs-BxNyk1aI.js";import{C as G,a as H}from"./CardContent-DkLJ4Reg.js";import"./KeyboardArrowRight-D-ZOxJ7W.js";const Q=()=>`
  <p>عزيزي/عزيزتي {{اسم_العميل}}،</p>
  <p>نود تذكيركم بأن قسطكم البالغ {{مبلغ_القسط}} ريال سيكون مستحق الدفع في {{تاريخ_الاستحقاق}}.</p>
  <p>يرجى اتخاذ الإجراءات اللازمة لضمان السداد في الوقت المحدد.</p>
  <p>شكراً لتعاونكم،</p>
  <p>{{اسم_الشركة}}</p>
`,X=()=>`
  <p>عزيزي/عزيزتي {{اسم_العميل}}،</p>
  <p>نود إعلامكم بأن قسطكم البالغ {{مبلغ_القسط}} ريال والمستحق في {{تاريخ_الاستحقاق}} أصبح متأخراً.</p>
  <p>الرجاء السداد في أقرب وقت ممكن لتجنب أي رسوم إضافية.</p>
  <p>للاستفسار، يرجى التواصل معنا على {{رقم_الاتصال}}.</p>
  <p>شكراً،</p>
  <p>{{اسم_الشركة}}</p>
`,Z=()=>`
  <p>عزيزي/عزيزتي {{اسم_العميل}}،</p>
  <p>نود إعلامكم بأن دفعتكم البالغة {{مبلغ_الدفعة}} ريال قد تمت الموافقة عليها بنجاح.</p>
  <p>رقم المرجع: {{رقم_المرجع}}</p>
  <p>تاريخ المعاملة: {{تاريخ_المعاملة}}</p>
  <p>شكراً لتعاونكم،</p>
  <p>{{اسم_الشركة}}</p>
`,ee=()=>`
  <p>عزيزي/عزيزتي {{اسم_العميل}}،</p>
  <p>نأسف لإعلامكم بأن دفعتكم البالغة {{مبلغ_الدفعة}} ريال قد تم رفضها.</p>
  <p>السبب: {{سبب_الرفض}}</p>
  <p>يرجى التواصل معنا على {{رقم_الاتصال}} لمزيد من المعلومات.</p>
  <p>شكراً،</p>
  <p>{{اسم_الشركة}}</p>
`;function oe(){const[p,I]=l.useState("repayment-due"),[i,b]=l.useState({repaymentDue:"",repaymentLate:"",paymentApproved:"",paymentRejected:""}),[Y,A]=l.useState(!1),[g,R]=l.useState(!1),[c,v]=l.useState({"repayment-due":[],"repayment-late":[],"payment-approved":[],"payment-rejected":[]}),m=h.useMemo(()=>({"repayment-due":"REPAYMENT_DUE","repayment-late":"REPAYMENT_LATE","payment-approved":"PAYMENT_APPROVED","payment-rejected":"PAYMENT_REJECTED"}),[]),d=h.useCallback(e=>{switch(e){case"REPAYMENT_DUE":return Q();case"REPAYMENT_LATE":return X();case"PAYMENT_APPROVED":return Z();case"PAYMENT_REJECTED":return ee();default:return""}},[]),_=e=>{const a=/{{(.*?)}}/g,r=e.match(a)||[];return[...new Set(r)].map(n=>({name:n,description:N(n)}))},N=e=>({"{{اسم_العميل}}":"اسم العميل","{{اسم_الشركة}}":"اسم الشركة أو المؤسسة","{{رقم_الاتصال}}":"رقم الاتصال أو خدمة العملاء","{{البريد_الإلكتروني}}":"البريد الإلكتروني للشركة","{{الموقع_الإلكتروني}}":"الموقع الإلكتروني للشركة","{{مبلغ_القسط}}":"مبلغ القسط المستحق","{{تاريخ_الاستحقاق}}":"تاريخ استحقاق القسط","{{مبلغ_الدفعة}}":"مبلغ الدفعة المقدمة","{{رقم_المرجع}}":"رقم المرجع أو المعاملة","{{تاريخ_المعاملة}}":"تاريخ إتمام المعاملة","{{سبب_الرفض}}":"سبب رفض الدفعة","{{رقم_العقد}}":"رقم العقد","{{رقم_القسط}}":"رقم القسط","{{المبلغ_المتبقي}}":"المبلغ المتبقي للدفع","{{عدد_أيام_التأخير}}":"عدد أيام التأخير","{{الغرامات_المستحقة}}":"قيمة الغرامات المستحقة","{{آخر_موعد_للدفع}}":"آخر موعد للدفع بدون غرامات"})[e]||`متغير: ${e.replace(/[{}]/g,"")}`,D=h.useCallback(async e=>{try{const a=await w.get(`/api/templates/${e}`);return a.data.content&&a.data.content.trim()!==""?a.data.content:(console.log(`Template ${e} found in API but empty, using frontend default`),d(e))}catch{return console.log(`Template ${e} not found in API, using frontend default`),d(e)}},[d]),F=e=>{navigator.clipboard.writeText(e).then(()=>{E("تم نسخ المتغير:")})},P=h.useCallback(async()=>{A(!0);try{const e=Object.keys(m).map(async n=>{const u=m[n],C=await D(u);return{key:n,content:C}}),a=await Promise.all(e),r={},s={...c};a.forEach(({key:n,content:u})=>{const C=n==="repayment-due"?"repaymentDue":n==="repayment-late"?"repaymentLate":n==="payment-approved"?"paymentApproved":n==="payment-rejected"?"paymentRejected":n;r[C]=u,s[n]=_(u)}),b(r),v(s)}catch(e){S("خطأ في تحميل القوالب"),L(e)}finally{A(!1)}},[m,D]),x=({variables:e})=>t.jsx(G,{sx:{mb:3,border:"1px solid #e5e7eb"},children:t.jsxs(H,{children:[t.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[t.jsx(T,{variant:"h6",sx:{mb:2,fontWeight:"bold",color:"#2d3748"},children:"المتغيرات المتاحة"}),t.jsxs(o,{sx:{display:"flex",gap:2},children:[t.jsx(V,{variant:"outlined",color:"secondary",startIcon:t.jsx(J,{sx:{marginLeft:"10px"}}),sx:{px:3,py:1.2,mt:2,fontWeight:"bold",borderRadius:"10px","&:hover":{backgroundColor:"#f5f5f5"}},onClick:k,children:"إعادة تعيين افتراضي"}),t.jsx(V,{variant:"contained",color:"primary",startIcon:g?t.jsx(M,{size:16,color:"inherit"}):t.jsx(q,{sx:{marginLeft:"10px"}}),disabled:g,sx:{px:4,py:1.2,mt:2,fontWeight:"bold",borderRadius:"10px","&:hover":{backgroundColor:"#1565c0"}},onClick:W,children:g?"جاري الحفظ...":"حفظ التغييرات"})]})]}),t.jsx(T,{variant:"body2",sx:{mb:2,color:"#666"},children:"انقر على أي متغير لنسخه واستخدامه في القالب"}),t.jsx($,{sx:{mb:2}}),t.jsx(B,{container:!0,spacing:1,children:e.map((a,r)=>t.jsx(B,{item:!0,xs:12,sm:6,md:4,children:t.jsx(O,{label:a.name,onClick:()=>F(a.name),icon:t.jsx(K,{sx:{fontSize:"16px !important"}}),sx:{width:"100%",justifyContent:"flex-start",mb:1,px:1,py:2,height:"auto",minHeight:"40px",backgroundColor:"#f8f9fc",border:"1px solid #e5e7eb","&:hover":{backgroundColor:"#e0e7ff",borderColor:"#3b82f6"},"& .MuiChip-label":{fontSize:"0.875rem",fontWeight:"500",whiteSpace:"normal",textAlign:"right",direction:"rtl"}},title:a.description})},r))})]})});l.useEffect(()=>{P()},[P]);const W=async()=>{R(!0);try{const e=p,a=m[e],s=i[e==="repayment-due"?"repaymentDue":e==="repayment-late"?"repaymentLate":e==="payment-approved"?"paymentApproved":e==="payment-rejected"?"paymentRejected":e];await w.post("/api/templates",{name:a,description:`Template for ${a} messages`,content:s}),E("تم حفظ القالب بنجاح")}catch(e){S("خطأ في حفظ القالب"),L(e)}finally{R(!1)}},y=(e,a)=>{b(s=>({...s,[e]:a}));const r=e==="repaymentDue"?"repayment-due":e==="repaymentLate"?"repayment-late":e==="paymentApproved"?"payment-approved":e==="paymentRejected"?"payment-rejected":e;v(s=>({...s,[r]:_(a)}))},k=()=>{const e=p,a=m[e],r=d(a),s=e==="repayment-due"?"repaymentDue":e==="repayment-late"?"repaymentLate":e==="payment-approved"?"paymentApproved":e==="payment-rejected"?"paymentRejected":e;b(n=>({...n,[s]:r})),v(n=>({...n,[e]:_(r)})),E("تم إعادة تعيين القالب إلى النسخة الافتراضية")};return t.jsx(o,{sx:{display:"flex",height:"100vh"},children:t.jsx(o,{sx:{flex:1,display:"flex",flexDirection:"column"},children:t.jsx(o,{sx:{p:4,overflowY:"auto",flex:1},children:t.jsxs(z,{sx:{p:3,borderRadius:2},children:[t.jsxs(U,{value:p,onChange:(e,a)=>I(a),variant:"scrollable",scrollButtons:"auto",textColor:"primary",indicatorColor:"primary",sx:{borderBottom:"1px solid #e5e7eb",mb:3,"& .MuiTab-root":{fontWeight:"bold",fontSize:"0.9rem",minWidth:"auto",px:2}},children:[t.jsx(j,{label:"تذكير استحقاق قسط",value:"repayment-due"}),t.jsx(j,{label:"تذكير تأخير سداد",value:"repayment-late"}),t.jsx(j,{label:"موافقة على دفعة",value:"payment-approved"}),t.jsx(j,{label:"رفض دفعة",value:"payment-rejected"})]}),t.jsx(o,{sx:{mt:3},children:Y?t.jsxs(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:[t.jsx(M,{size:40}),t.jsx(T,{sx:{ml:2},children:"جاري تحميل القوالب..."})]}):t.jsxs(t.Fragment,{children:[p==="repayment-due"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{variables:c["repayment-due"]}),t.jsx(f,{theme:"snow",value:i.repaymentDue,onChange:e=>y("repaymentDue",e),placeholder:"أدخل نص قالب تذكير استحقاق القسط هنا...",style:{height:"500px",marginBottom:"40px"}})]}),p==="repayment-late"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{variables:c["repayment-late"]}),t.jsx(f,{theme:"snow",value:i.repaymentLate,onChange:e=>y("repaymentLate",e),placeholder:"أدخل نص قالب تذكير تأخير السداد هنا...",style:{height:"500px",marginBottom:"40px"}})]}),p==="payment-approved"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{variables:c["payment-approved"]}),t.jsx(f,{theme:"snow",value:i.paymentApproved,onChange:e=>y("paymentApproved",e),placeholder:"أدخل نص قالب موافقة على الدفعة هنا...",style:{height:"500px",marginBottom:"40px"}})]}),p==="payment-rejected"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{variables:c["payment-rejected"]}),t.jsx(f,{theme:"snow",value:i.paymentRejected,onChange:e=>y("paymentRejected",e),placeholder:"أدخل نص قالب رفض الدفعة هنا...",style:{height:"500px",marginBottom:"40px"}})]})]})})]})})})})}export{oe as default};
//# sourceMappingURL=MessagesTemplates-miY7ddmV.js.map
