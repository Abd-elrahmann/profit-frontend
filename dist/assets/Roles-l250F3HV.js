import{W as G,r as o,a8 as J,j as e,O as N,P as X,f as B,Q as ee,F as se,c as O,d as ne,R as ae,B as l,e as U,a9 as te,T as A,i as Q,U as ie,k as z,l as $,A as W,m as V,n as re,aa as oe,p as E,ab as D,a as le,_ as de,H as ce,I as pe,a0 as xe,$ as ue,a1 as me,a2 as he,a3 as q,a4 as r,a5 as fe,Y as ge,a6 as be,Z as je}from"./index-Byloyp0V.js";import{F as ye}from"./FormControlLabel-Fb32HuXN.js";import{D as Ce}from"./DeleteModal-Du1zPAFn.js";import{l as Pe}from"./lodash-Dqh01Uem.js";import{S as Se}from"./Search-DKotboAf.js";import{A as ve}from"./Add-JAHAPveB.js";import{E as Ae}from"./Edit-D4H7Xh5Y.js";import{T as De}from"./TablePagination-rGYbANAk.js";import"./KeyboardArrowRight-nGgaUmNE.js";import"./LastPage-D5DKCjzm.js";const we=O().shape({name:E().required("اسم الدور مطلوب").min(2,"اسم الدور يجب أن يكون حرفين على الأقل"),description:E().required("وصف الدور مطلوب").min(5,"الوصف يجب أن يكون 5 أحرف على الأقل"),permissions:oe().of(O().shape({module:E().required(),canView:D(),canAdd:D(),canUpdate:D(),canDelete:D(),canPost:D()}))}),R=J(),Ie=({open:h,onClose:p,refetchRoles:w,mode:f="add",editData:u=null})=>{const m=G(),[j,y]=o.useState(!1),[F,C]=o.useState({name:"",description:"",permissions:R.map(n=>({module:n.value,canView:!1,canAdd:!1,canUpdate:!1,canDelete:!1,canPost:!1}))});o.useEffect(()=>{if(f==="edit"&&u){const n=R.map(t=>{const a=u.permissions?.find(i=>i.module===t.value);return{module:t.value,canView:a?.canView||!1,canAdd:a?.canAdd||!1,canUpdate:a?.canUpdate||!1,canDelete:a?.canDelete||!1,canPost:a?.canPost||!1}});C({name:u.name||"",description:u.description||"",permissions:n})}else C({name:"",description:"",permissions:R.map(n=>({module:n.value,canView:!1,canAdd:!1,canUpdate:!1,canDelete:!1,canPost:!1}))})},[f,u,h]);const T=async(n,{resetForm:t})=>{y(!0);try{const a={name:n.name,description:n.description,permissions:n.permissions};f==="add"?(await W.post("/api/roles",a),V("تم إضافة الدور بنجاح"),m.invalidateQueries({queryKey:["roles"]}),m.invalidateQueries({queryKey:["employees"]})):(await W.patch(`/api/roles/${u.id}`,a),V("تم تعديل الدور بنجاح"),m.invalidateQueries({queryKey:["roles"]}),m.invalidateQueries({queryKey:["employees"]})),t(),w(),p()}catch(a){re(a.response?.data?.message||"حدث خطأ أثناء العملية")}finally{y(!1)}},P=(n,t,a,i,x)=>{const d=[...n.permissions];d[a]={...d[a],[i]:x},t("permissions",d)},M=(n,t,a,i)=>{const x=n.permissions.map(d=>({...d,[a]:i}));t("permissions",x)};return e.jsxs(N,{open:h,onClose:p,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,direction:"rtl"}},children:[e.jsxs(X,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[f==="add"?"إضافة دور جديد":"تعديل الدور",e.jsx(B,{onClick:p,size:"small",children:e.jsx(ee,{})})]}),e.jsx(se,{initialValues:F,validationSchema:we,onSubmit:T,enableReinitialize:!0,children:({values:n,errors:t,touched:a,handleChange:i,handleBlur:x,setFieldValue:d})=>e.jsxs(ne,{children:[e.jsx(ae,{sx:{pb:1},children:e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(l,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(U,{name:"name",label:"اسم الدور",value:n.name,onChange:i,onBlur:x,error:a.name&&!!t.name,helperText:a.name&&t.name,sx:{minWidth:250,"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}}}),e.jsx(U,{name:"description",label:"وصف الدور",value:n.description,onChange:i,onBlur:x,error:a.description&&!!t.description,helperText:a.description&&t.description,sx:{minWidth:250,"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}},"& .MuiOutlinedInput-input":{fontSize:"0.875rem"}}})]}),e.jsx(te,{}),e.jsxs(l,{children:[e.jsx(A,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"الصلاحيات"}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"1fr repeat(5, auto)",gap:1,alignItems:"center",mb:2,p:1,bgcolor:"#f5f5f5",borderRadius:1},children:[e.jsx(A,{variant:"subtitle2",sx:{fontWeight:"bold"},children:"الصلاحيات"}),["عرض","إضافة","تعديل","حذف","اعتماد"].map((c,g)=>e.jsxs(l,{sx:{textAlign:"center"},children:[e.jsx(A,{variant:"subtitle2",sx:{fontSize:"0.75rem",fontWeight:"bold"},children:c}),e.jsx(Q,{size:"small",onChange:S=>M(n,d,["canView","canAdd","canUpdate","canDelete","canPost"][g],S.target.checked)})]},c))]}),e.jsx(l,{sx:{display:"flex",flexDirection:"column",gap:1},children:n.permissions.map((c,g)=>{const S=R.find(b=>b.value===c.module);return e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto 1fr repeat(5, auto)",gap:1,alignItems:"center",p:1,borderRadius:1,bgcolor:g%2===0?"transparent":"#f9f9f9"},children:[e.jsxs(A,{variant:"body2",sx:{fontWeight:"bold",color:"#666",fontSize:"0.875rem"},children:[g+1,"-"]}),e.jsx(A,{variant:"body2",sx:{fontWeight:"500"},children:S?.label||c.module}),["canView","canAdd","canUpdate","canDelete","canPost"].map(b=>e.jsx(l,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(ye,{control:e.jsx(Q,{size:"small",checked:c[b],onChange:k=>P(n,d,g,b,k.target.checked)}),label:""})},b))]},c.module)})})]})]})}),e.jsxs(ie,{sx:{px:3,py:2,display:"flex",justifyContent:"center",alignItems:"center",gap:2,flexDirection:"row-reverse"},children:[e.jsx(z,{onClick:p,variant:"outlined",color:"inherit",disabled:j,children:"إلغاء"}),e.jsx(z,{type:"submit",variant:"contained",disabled:j,sx:{bgcolor:"#1E40AF","&:hover":{bgcolor:"#1E3A8A"},minWidth:120},children:j?e.jsx($,{size:24,color:"inherit"}):f==="add"?"إضافة":"تعديل"})]})]})})]})},Re=async(h=1,p="")=>(await W.get(`/api/roles?name=${p}`)).data;function Oe(){const[h,p]=o.useState(0),[w,f]=o.useState(10),[u,m]=o.useState(!1),[j,y]=o.useState("add"),[F,C]=o.useState(null),[T,P]=o.useState(!1),[M,n]=o.useState(null),[t,a]=o.useState(""),{permissions:i}=le(),{data:x,isLoading:d,refetch:c}=de({queryKey:["roles",h+1,t],queryFn:()=>Re(h+1,t),keepPreviousData:!0,staleTime:1e3*60*5,retry:1}),g=Pe.debounce(s=>{a(s)},500),S=s=>{g(s.target.value)},b=(s,v)=>{p(v)},k=s=>{f(parseInt(s.target.value,10)),p(0)},H=s=>{C(s),y("edit"),m(!0)},K=()=>{C(null),y("add"),m(!0)},Y=async s=>{try{await W.delete(`/api/roles/${s}`),c(),P(!1),n(null)}catch(v){console.error("Error deleting role:",v)}},_=s=>{n(s),P(!0)},L=s=>s?s.reduce((v,I)=>{const Z=I.canView||I.canAdd||I.canUpdate||I.canDelete;return v+(Z?1:0)},0):0;return e.jsxs(l,{sx:{bgcolor:"#FFFFFF",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs(ce,{children:[e.jsx("title",{children:"الأدوار"}),e.jsx("meta",{name:"description",content:"الأدوار"})]}),e.jsxs(l,{sx:{p:5},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,flexWrap:"wrap",gap:2},children:[e.jsx(U,{placeholder:"البحث عن دور بالاسم",variant:"outlined",onChange:S,sx:{flex:1,bgcolor:"#F3F4F6",borderRadius:2,"& fieldset":{border:"none"}},InputProps:{startAdornment:e.jsx(pe,{position:"start",children:e.jsx(Se,{sx:{color:"gray"}})})}}),i.includes("roles_Add")&&e.jsx(z,{variant:"contained",startIcon:e.jsx(ve,{}),onClick:K,sx:{bgcolor:"#1E40AF","&:hover":{bgcolor:"#1E3A8A"},fontWeight:"bold"},children:"إضافة دور جديد"})]}),e.jsxs(xe,{component:ue,sx:{borderRadius:2},children:[e.jsxs(me,{stickyHeader:!0,children:[e.jsx(he,{sx:{bgcolor:"#F3F4F6"},children:e.jsxs(q,{children:[e.jsx(r,{align:"center",sx:{fontWeight:"bold"},children:"اسم الدور"}),e.jsx(r,{align:"center",sx:{fontWeight:"bold"},children:"الوصف"}),e.jsx(r,{align:"center",sx:{fontWeight:"bold"},children:"عدد الصلاحيات"}),e.jsx(r,{align:"center",sx:{fontWeight:"bold"},children:"تاريخ الإنشاء"}),e.jsx(r,{align:"center",sx:{fontWeight:"bold"},children:"الإجراءات"})]})}),e.jsx(fe,{children:d?e.jsx(q,{children:e.jsx(r,{colSpan:5,align:"center",children:e.jsx($,{})})}):x?.roles?.map(s=>e.jsxs(q,{hover:!0,children:[e.jsx(r,{align:"center",sx:{fontWeight:"bold"},children:s.name}),e.jsx(r,{align:"center",sx:{color:"gray"},children:s.description}),e.jsx(r,{align:"center",children:e.jsx(ge,{label:`${L(s.permissions)} صلاحية`,sx:{bgcolor:"rgba(16,185,129,0.1)",color:"#10B981",fontWeight:"bold"}})}),e.jsx(r,{align:"center",sx:{color:"gray"},children:be(s.createdAt).format("DD/MM/YYYY")}),e.jsxs(r,{align:"center",sx:{fontWeight:"bold"},children:[i.includes("roles_Update")&&e.jsx(B,{color:"primary",onClick:()=>H(s),children:e.jsx(Ae,{})}),i.includes("roles_Delete")&&e.jsx(B,{color:"error",onClick:()=>_(s.id),children:e.jsx(je,{})})]})]},s.id))})]}),e.jsx(De,{component:"div",count:x?.total||0,page:h,onPageChange:b,rowsPerPage:w,onRowsPerPageChange:k,labelRowsPerPage:"عدد العناصر في الصفحة"})]})]}),e.jsx(Ie,{open:u,onClose:()=>m(!1),refetchRoles:c,mode:j,editData:F}),e.jsx(Ce,{open:T,onClose:()=>P(!1),onConfirm:()=>Y(M),title:"حذف الدور",message:"هل أنت متأكد من حذف هذا الدور؟",ButtonText:"حذف"})]})}export{Oe as default};
//# sourceMappingURL=Roles-l250F3HV.js.map
