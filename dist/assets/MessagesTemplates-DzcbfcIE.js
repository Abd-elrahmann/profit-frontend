import{r as l,a as z,ak as h,A as S,n as L,o as M,j as t,B as o,H,$ as O,l as Y,T,C as U,b as q,k as B,a9 as J,ac as I,Y as K,m as E}from"./index-Byloyp0V.js";import{S as G}from"./Save-jijcoH0W.js";import{R as j,a as Q,C as X}from"./ReactQuillWrapper-DkEkLnqk.js";import{T as Z,a as f}from"./Tabs-D07rxUwM.js";import"./KeyboardArrowRight-nGgaUmNE.js";const ee=()=>`
  <p>عزيزي/عزيزتي {{اسم_العميل}}،</p>
  <p>نود تذكيركم بأن قسطكم البالغ {{مبلغ_القسط}} ريال سيكون مستحق الدفع في {{تاريخ_الاستحقاق}}.</p>
  <p>يرجى اتخاذ الإجراءات اللازمة لضمان السداد في الوقت المحدد.</p>
  <p>شكراً لتعاونكم،</p>
  <p>{{اسم_الشركة}}</p>
`,te=()=>`
  <p>عزيزي/عزيزتي {{اسم_العميل}}،</p>
  <p>نود إعلامكم بأن قسطكم البالغ {{مبلغ_القسط}} ريال والمستحق في {{تاريخ_الاستحقاق}} أصبح متأخراً.</p>
  <p>الرجاء السداد في أقرب وقت ممكن لتجنب أي رسوم إضافية.</p>
  <p>للاستفسار، يرجى التواصل معنا على {{رقم_الاتصال}}.</p>
  <p>شكراً،</p>
  <p>{{اسم_الشركة}}</p>
`,ae=()=>`
  <p>عزيزي/عزيزتي {{اسم_العميل}}،</p>
  <p>نود إعلامكم بأن دفعتكم البالغة {{مبلغ_الدفعة}} ريال قد تمت الموافقة عليها بنجاح.</p>
  <p>رقم المرجع: {{رقم_المرجع}}</p>
  <p>تاريخ المعاملة: {{تاريخ_المعاملة}}</p>
  <p>شكراً لتعاونكم،</p>
  <p>{{اسم_الشركة}}</p>
`,ne=()=>`
  <p>عزيزي/عزيزتي {{اسم_العميل}}،</p>
  <p>نأسف لإعلامكم بأن دفعتكم البالغة {{مبلغ_الدفعة}} ريال قد تم رفضها.</p>
  <p>السبب: {{سبب_الرفض}}</p>
  <p>يرجى التواصل معنا على {{رقم_الاتصال}} لمزيد من المعلومات.</p>
  <p>شكراً،</p>
  <p>{{اسم_الشركة}}</p>
`;function ie(){const[p,V]=l.useState("repayment-due"),[i,b]=l.useState({repaymentDue:"",repaymentLate:"",paymentApproved:"",paymentRejected:""}),[N,A]=l.useState(!1),[g,R]=l.useState(!1),[c,v]=l.useState({"repayment-due":[],"repayment-late":[],"payment-approved":[],"payment-rejected":[]}),{permissions:D}=z(),m=h.useMemo(()=>({"repayment-due":"REPAYMENT_DUE","repayment-late":"REPAYMENT_LATE","payment-approved":"PAYMENT_APPROVED","payment-rejected":"PAYMENT_REJECTED"}),[]),d=h.useCallback(e=>{switch(e){case"REPAYMENT_DUE":return ee();case"REPAYMENT_LATE":return te();case"PAYMENT_APPROVED":return ae();case"PAYMENT_REJECTED":return ne();default:return""}},[]),_=e=>{const a=/{{(.*?)}}/g,s=e.match(a)||[];return[...new Set(s)].map(n=>({name:n,description:k(n)}))},k=e=>({"{{اسم_العميل}}":"اسم العميل","{{اسم_الشركة}}":"اسم الشركة أو المؤسسة","{{رقم_الاتصال}}":"رقم الاتصال أو خدمة العملاء","{{البريد_الإلكتروني}}":"البريد الإلكتروني للشركة","{{الموقع_الإلكتروني}}":"الموقع الإلكتروني للشركة","{{مبلغ_القسط}}":"مبلغ القسط المستحق","{{تاريخ_الاستحقاق}}":"تاريخ استحقاق القسط","{{مبلغ_الدفعة}}":"مبلغ الدفعة المقدمة","{{رقم_المرجع}}":"رقم المرجع أو المعاملة","{{تاريخ_المعاملة}}":"تاريخ إتمام المعاملة","{{سبب_الرفض}}":"سبب رفض الدفعة","{{رقم_العقد}}":"رقم العقد","{{رقم_القسط}}":"رقم القسط","{{المبلغ_المتبقي}}":"المبلغ المتبقي للدفع","{{عدد_أيام_التأخير}}":"عدد أيام التأخير","{{الغرامات_المستحقة}}":"قيمة الغرامات المستحقة","{{آخر_موعد_للدفع}}":"آخر موعد للدفع بدون غرامات"})[e]||`متغير: ${e.replace(/[{}]/g,"")}`,P=h.useCallback(async e=>{try{const a=await S.get(`/api/templates/${e}`);return a.data.content&&a.data.content.trim()!==""?a.data.content:(console.log(`Template ${e} found in API but empty, using frontend default`),d(e))}catch{return console.log(`Template ${e} not found in API, using frontend default`),d(e)}},[d]),F=e=>{navigator.clipboard.writeText(e).then(()=>{E("تم نسخ المتغير:")})},w=h.useCallback(async()=>{A(!0);try{const e=Object.keys(m).map(async n=>{const y=m[n],C=await P(y);return{key:n,content:C}}),a=await Promise.all(e),s={},r={...c};a.forEach(({key:n,content:y})=>{const C=n==="repayment-due"?"repaymentDue":n==="repayment-late"?"repaymentLate":n==="payment-approved"?"paymentApproved":n==="payment-rejected"?"paymentRejected":n;s[C]=y,r[n]=_(y)}),b(s),v(r)}catch(e){L("خطأ في تحميل القوالب"),M(e)}finally{A(!1)}},[m,P]),x=({variables:e})=>t.jsx(U,{sx:{mb:3,border:"1px solid #e5e7eb"},children:t.jsxs(q,{children:[t.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[t.jsx(T,{variant:"h6",sx:{mb:2,fontWeight:"bold",color:"#2d3748"},children:"المتغيرات المتاحة"}),t.jsxs(o,{sx:{display:"flex",gap:2},children:[D.includes("messagesTemplates_Update")&&t.jsx(B,{variant:"outlined",color:"secondary",startIcon:t.jsx(Q,{sx:{marginLeft:"10px"}}),sx:{px:3,py:1.2,mt:2,fontWeight:"bold",borderRadius:"10px","&:hover":{backgroundColor:"#f5f5f5"}},onClick:$,children:"إعادة تعيين افتراضي"}),D.includes("messagesTemplates_Add")&&t.jsx(B,{variant:"contained",color:"primary",startIcon:g?t.jsx(Y,{size:16,color:"inherit"}):t.jsx(G,{sx:{marginLeft:"10px"}}),disabled:g,sx:{px:4,py:1.2,mt:2,fontWeight:"bold",borderRadius:"10px","&:hover":{backgroundColor:"#1565c0"}},onClick:W,children:g?"جاري الحفظ...":"حفظ التغييرات"})]})]}),t.jsx(T,{variant:"body2",sx:{mb:2,color:"#666"},children:"انقر على أي متغير لنسخه واستخدامه في القالب"}),t.jsx(J,{sx:{mb:2}}),t.jsx(I,{container:!0,spacing:1,children:e.map((a,s)=>t.jsx(I,{item:!0,xs:12,sm:6,md:4,children:t.jsx(K,{label:a.name,onClick:()=>F(a.name),icon:t.jsx(X,{sx:{fontSize:"16px !important"}}),sx:{width:"100%",justifyContent:"flex-start",mb:1,px:1,py:2,height:"auto",minHeight:"40px",backgroundColor:"#f8f9fc",border:"1px solid #e5e7eb","&:hover":{backgroundColor:"#e0e7ff",borderColor:"#3b82f6"},"& .MuiChip-label":{fontSize:"0.875rem",fontWeight:"500",whiteSpace:"normal",textAlign:"right",direction:"rtl"}},title:a.description})},s))})]})});l.useEffect(()=>{w()},[w]);const W=async()=>{R(!0);try{const e=p,a=m[e],r=i[e==="repayment-due"?"repaymentDue":e==="repayment-late"?"repaymentLate":e==="payment-approved"?"paymentApproved":e==="payment-rejected"?"paymentRejected":e];await S.post("/api/templates",{name:a,description:`Template for ${a} messages`,content:r}),E("تم حفظ القالب بنجاح")}catch(e){L("خطأ في حفظ القالب"),M(e)}finally{R(!1)}},u=(e,a)=>{b(r=>({...r,[e]:a}));const s=e==="repaymentDue"?"repayment-due":e==="repaymentLate"?"repayment-late":e==="paymentApproved"?"payment-approved":e==="paymentRejected"?"payment-rejected":e;v(r=>({...r,[s]:_(a)}))},$=()=>{const e=p,a=m[e],s=d(a),r=e==="repayment-due"?"repaymentDue":e==="repayment-late"?"repaymentLate":e==="payment-approved"?"paymentApproved":e==="payment-rejected"?"paymentRejected":e;b(n=>({...n,[r]:s})),v(n=>({...n,[e]:_(s)})),E("تم إعادة تعيين القالب إلى النسخة الافتراضية")};return t.jsxs(o,{sx:{display:"flex",height:"100vh"},children:[t.jsxs(H,{children:[t.jsx("title",{children:"القوالب الرسائلية"}),t.jsx("meta",{name:"description",content:"القوالب الرسائلية"})]}),t.jsx(o,{sx:{flex:1,display:"flex",flexDirection:"column"},children:t.jsx(o,{sx:{p:4,overflowY:"auto",flex:1},children:t.jsxs(O,{sx:{p:3,borderRadius:2},children:[t.jsxs(Z,{value:p,onChange:(e,a)=>V(a),variant:"scrollable",scrollButtons:"auto",textColor:"primary",indicatorColor:"primary",sx:{borderBottom:"1px solid #e5e7eb",mb:3,"& .MuiTab-root":{fontWeight:"bold",fontSize:"0.9rem",minWidth:"auto",px:2}},children:[t.jsx(f,{label:"تذكير استحقاق قسط",value:"repayment-due"}),t.jsx(f,{label:"تذكير تأخير سداد",value:"repayment-late"}),t.jsx(f,{label:"موافقة على دفعة",value:"payment-approved"}),t.jsx(f,{label:"رفض دفعة",value:"payment-rejected"})]}),t.jsx(o,{sx:{mt:3},children:N?t.jsxs(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:[t.jsx(Y,{size:40}),t.jsx(T,{sx:{ml:2},children:"جاري تحميل القوالب..."})]}):t.jsxs(t.Fragment,{children:[p==="repayment-due"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{variables:c["repayment-due"]}),t.jsx(j,{theme:"snow",value:i.repaymentDue,onChange:e=>u("repaymentDue",e),placeholder:"أدخل نص قالب تذكير استحقاق القسط هنا...",style:{height:"500px",marginBottom:"40px"}})]}),p==="repayment-late"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{variables:c["repayment-late"]}),t.jsx(j,{theme:"snow",value:i.repaymentLate,onChange:e=>u("repaymentLate",e),placeholder:"أدخل نص قالب تذكير تأخير السداد هنا...",style:{height:"500px",marginBottom:"40px"}})]}),p==="payment-approved"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{variables:c["payment-approved"]}),t.jsx(j,{theme:"snow",value:i.paymentApproved,onChange:e=>u("paymentApproved",e),placeholder:"أدخل نص قالب موافقة على الدفعة هنا...",style:{height:"500px",marginBottom:"40px"}})]}),p==="payment-rejected"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{variables:c["payment-rejected"]}),t.jsx(j,{theme:"snow",value:i.paymentRejected,onChange:e=>u("paymentRejected",e),placeholder:"أدخل نص قالب رفض الدفعة هنا...",style:{height:"500px",marginBottom:"40px"}})]})]})})]})})})]})}export{ie as default};
//# sourceMappingURL=MessagesTemplates-DzcbfcIE.js.map
