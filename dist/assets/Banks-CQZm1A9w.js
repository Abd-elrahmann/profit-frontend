import{r as d,aE as K,aF as G,j as e,O as Y,P as Z,T as R,R as X,B as P,e as T,U as J,k as L,l as M,m as z,n as _,a as V,W as ee,_ as te,H as ne,as as se,I as ae,$ as re,a0 as oe,a1 as ie,a2 as le,a3 as D,a4 as f,a5 as ce,Y as de,am as ue,f as q,Z as fe}from"./index-Byloyp0V.js";import{u as ge,c as he,d as xe,g as me}from"./bankApis-CtZ-WO8f.js";import{D as pe}from"./DeleteModal-Du1zPAFn.js";import{r as be}from"./index-Bx-TMwYn.js";import{A as je}from"./Add-JAHAPveB.js";import{S as ye}from"./Search-DKotboAf.js";import{E as Ne}from"./Edit-D4H7Xh5Y.js";import{T as Ce}from"./TablePagination-rGYbANAk.js";import"./KeyboardArrowRight-nGgaUmNE.js";import"./LastPage-D5DKCjzm.js";const we=(n,s,r,o)=>{const c=[r,{code:s,...o||{}}];if(n?.services?.logger?.forward)return n.services.logger.forward(c,"warn","react-i18next::",!0);B(c[0])&&(c[0]=`react-i18next:: ${c[0]}`),n?.services?.logger?.warn?n.services.logger.warn(...c):console?.warn&&console.warn(...c)},F={},H=(n,s,r,o)=>{B(r)&&F[r]||(B(r)&&(F[r]=new Date),we(n,s,r,o))},Q=(n,s)=>()=>{if(n.isInitialized)s();else{const r=()=>{setTimeout(()=>{n.off("initialized",r)},0),s()};n.on("initialized",r)}},O=(n,s,r)=>{n.loadNamespaces(s,Q(n,r))},$=(n,s,r,o)=>{if(B(r)&&(r=[r]),n.options.preload&&n.options.preload.indexOf(s)>-1)return O(n,r,o);r.forEach(c=>{n.options.ns.indexOf(c)<0&&n.options.ns.push(c)}),n.loadLanguages(s,Q(n,o))},Ie=(n,s,r={})=>!s.languages||!s.languages.length?(H(s,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:s.languages}),!0):s.hasLoadedNamespace(n,{lng:r.lng,precheck:(o,c)=>{if(r.bindI18n&&r.bindI18n.indexOf("languageChanging")>-1&&o.services.backendConnector.backend&&o.isLanguageChangingTo&&!c(o.isLanguageChangingTo,n))return!1}}),B=n=>typeof n=="string",Se=n=>typeof n=="object"&&n!==null,ve=d.createContext();class Be{constructor(){this.usedNamespaces={}}addUsedNamespaces(s){s.forEach(r=>{this.usedNamespaces[r]||(this.usedNamespaces[r]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var Ae=be();const ke=(n,s)=>B(s)?s:Se(s)&&B(s.defaultValue)?s.defaultValue:Array.isArray(n)?n[n.length-1]:n,Te={t:ke,ready:!1},We=()=>()=>{},De=(n,s={})=>{const{i18n:r}=s,{i18n:o,defaultNS:c}=d.useContext(ve)||{},t=r||o||K();t&&!t.reportNamespaces&&(t.reportNamespaces=new Be),t||H(t,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const g=d.useMemo(()=>({...G(),...t?.options?.react,...s}),[t,s]),{useSuspense:j,keyPrefix:p}=g,l=d.useMemo(()=>{const u=c||t?.options?.defaultNS;return B(u)?[u]:u||["translation"]},[n,c,t]);t?.reportNamespaces?.addUsedNamespaces?.(l);const b=d.useRef(0),y=d.useCallback(u=>{if(!t)return We;const{bindI18n:h,bindI18nStore:C}=g,m=()=>{b.current+=1,u()};return h&&t.on(h,m),C&&t.store.on(C,m),()=>{h&&h.split(" ").forEach(v=>t.off(v,m)),C&&C.split(" ").forEach(v=>t.store.off(v,m))}},[t,g]),w=d.useRef(),A=d.useCallback(()=>{if(!t)return Te;const u=!!(t.isInitialized||t.initializedStoreOnce)&&l.every(i=>Ie(i,t,g)),h=s.lng||t.language,C=b.current,m=w.current;if(m&&m.ready===u&&m.lng===h&&m.keyPrefix===p&&m.revision===C)return m;const W={t:t.getFixedT(h,g.nsMode==="fallback"?l:l[0],p),ready:u,lng:h,keyPrefix:p,revision:C};return w.current=W,W},[t,l,p,g,s.lng]),[I,a]=d.useState(0),{t:S,ready:x}=Ae.useSyncExternalStore(y,A,A);d.useEffect(()=>{if(t&&!x&&!j){const u=()=>a(h=>h+1);s.lng?$(t,s.lng,l,u):O(t,l,u)}},[t,s.lng,l,x,j,I]);const N=t||{},E=d.useMemo(()=>{const u=[S,N,x];return u.t=S,u.i18n=N,u.ready=x,u},[S,N,x]);if(t&&j&&!x)throw new Promise(u=>{const h=()=>u();s.lng?$(t,s.lng,l,h):O(t,l,h)});return E},Pe=({open:n,onClose:s,onSuccess:r,bank:o,isEditMode:c=!1})=>{const[t,g]=d.useState({name:"",accountNumber:"",IBAN:"",limit:"",owner:""}),[j,p]=d.useState(!1),[l,b]=d.useState({});d.useEffect(()=>{g(o&&c?{name:o.name||"",accountNumber:o.accountNumber||"",IBAN:o.IBAN||"",limit:parseInt(o.limit)||"",owner:o.owner||""}:{name:"",accountNumber:"",IBAN:"",limit:"",owner:""}),b({})},[o,c,n]);const y=a=>S=>{const x=S.target.value;g(N=>({...N,[a]:x})),l[a]&&b(N=>({...N,[a]:""}))},w=()=>{const a={};return t.name.trim()||(a.name="اسم الحساب مطلوب"),t.accountNumber.trim()?/^\d+$/.test(t.accountNumber)?(t.accountNumber.length<10||t.accountNumber.length>14)&&(a.accountNumber="رقم الحساب يجب أن يكون بين 10 و 14 رقم"):a.accountNumber="رقم الحساب يجب أن يحتوي على أرقام فقط":a.accountNumber="رقم الحساب مطلوب",t.IBAN.trim()?/^[A-Za-z0-9]+$/.test(t.IBAN)?t.IBAN.length>24&&(a.IBAN="IBAN يجب أن يكون 24 حرف/رقم"):a.IBAN="IBAN يجب أن يحتوي على أحرف وأرقام فقط":a.IBAN="IBAN مطلوب",b(a),Object.keys(a).length===0},A=async()=>{if(w()){p(!0);try{c&&o?(await ge(o.id,{...t,limit:parseInt(t.limit)}),z("تم تعديل الحساب البنكي بنجاح")):(await he({...t,limit:parseInt(t.limit)}),z("تم إضافة الحساب البنكي بنجاح")),r()}catch(a){_(a.response?.data?.message||`حدث خطأ أثناء ${c?"تعديل":"إضافة"} الحساب البنكي`)}finally{p(!1)}}},I=()=>{g({name:"",accountNumber:"",IBAN:"",limit:"",owner:""}),b({}),s()};return e.jsxs(Y,{open:n,onClose:I,maxWidth:"sm",fullWidth:!0,dir:"rtl",children:[e.jsx(Z,{sx:{pb:1},children:e.jsx(R,{variant:"h6",fontWeight:"bold",children:c?"تعديل حساب بنكي":"إضافة حساب بنكي جديد"})}),e.jsx(X,{sx:{py:3},children:e.jsxs(P,{children:[e.jsx(T,{label:"اسم الحساب",value:t.name,onChange:y("name"),fullWidth:!0,error:!!l.name,helperText:l.name,required:!0,sx:{mb:2,mt:2}}),e.jsx(T,{label:"اسم المالك",type:"text",value:t.owner,onChange:y("owner"),fullWidth:!0,error:!!l.owner,helperText:l.owner,required:!0,sx:{mb:2,mt:2}}),e.jsx(T,{label:"رقم الحساب",type:"text",value:t.accountNumber,onChange:y("accountNumber"),fullWidth:!0,error:!!l.accountNumber,helperText:l.accountNumber,required:!0,sx:{mb:2,mt:2},inputProps:{inputMode:"text",maxLength:14,min:0,max:14},onKeyDown:a=>{(a.key==="-"||a.key==="+")&&a.preventDefault()}}),e.jsx(T,{label:"رقم الايبان",type:"text",value:t.IBAN,onChange:y("IBAN"),fullWidth:!0,error:!!l.IBAN,helperText:l.IBAN,required:!0,sx:{mb:2,mt:2},inputProps:{inputMode:"text",maxLength:24,min:0,max:24},onKeyDown:a=>{(a.key==="-"||a.key==="+")&&a.preventDefault()}}),e.jsx(T,{label:" السلف المسموح بها للحساب البنكي",type:"number",value:t.limit,onChange:y("limit"),fullWidth:!0,error:!!l.limit,helperText:l.limit,required:!0,sx:{mb:2,mt:2},inputProps:{inputMode:"numeric",min:0},onKeyDown:a=>{(a.key==="-"||a.key==="+")&&a.preventDefault()}})]})}),e.jsxs(J,{sx:{p:3,gap:1,flexDirection:"row-reverse"},children:[e.jsx(L,{onClick:I,disabled:j,variant:"outlined",sx:{minWidth:"100px",borderColor:"grey.300",color:"text.secondary","&:hover":{borderColor:"grey.400",bgcolor:"grey.50"}},children:"إلغاء"}),e.jsx(L,{variant:"contained",onClick:A,disabled:j,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},minWidth:"100px"},children:j?e.jsx(M,{size:24,color:"inherit"}):c?"تعديل":"إضافة"})]})]})},He=()=>{const{i18n:n}=De(),[s,r]=d.useState(1),[o,c]=d.useState(""),[t,g]=d.useState(null),[j,p]=d.useState(!1),[l,b]=d.useState(!1),[y,w]=d.useState(null),[A,I]=d.useState(!1),{permissions:a}=V(),S=ee(),{data:x,isLoading:N}=te({queryKey:["banks",s,o],queryFn:()=>me(s,o),retry:1}),E=i=>{c(i.target.value),r(1)},u=(i,k)=>{r(k+1)},h=async i=>{try{await xe(i),z("تم حذف الحساب البنكي بنجاح"),S.invalidateQueries(["banks"]),p(!1),g(null)}catch(k){_(k.response?.data?.message||"حدث خطأ أثناء حذف الحساب البنكي")}},C=i=>{w(i),I(!0),b(!0)},m=()=>{w(null),I(!1),b(!0)},v=()=>{b(!1),w(null),I(!1)},W=()=>{v(),S.invalidateQueries(["banks"])};return e.jsxs(P,{sx:{bgcolor:"#f6f6f8",minHeight:"100vh",p:4},children:[e.jsxs(ne,{children:[e.jsx("title",{children:"الحسابات البنكية"}),e.jsx("meta",{name:"description",content:"الحسابات البنكية"})]}),e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsx(R,{variant:"h5",fontWeight:"bold",color:"#333",children:"الحسابات البنكية"}),a.includes("banks_Add")&&e.jsx(L,{variant:"contained",startIcon:e.jsx(je,{}),onClick:m,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},borderRadius:2,px:3,py:1,fontWeight:"bold"},children:"إضافة حساب بنكي"})]}),e.jsx(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:e.jsx(se,{placeholder:"ابحث باسم الحساب أو رقم الحساب...",value:o,onChange:E,InputProps:{startAdornment:e.jsx(ae,{position:"start",children:e.jsx(ye,{})})},sx:{width:"300px",backgroundColor:"#f9fafb",borderRadius:"6px"}})}),e.jsxs(re,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(oe,{sx:{maxHeight:600},children:e.jsxs(ie,{stickyHeader:!0,children:[e.jsx(le,{children:e.jsxs(D,{children:[e.jsx(f,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f8f9fa"},children:"#"}),e.jsx(f,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f8f9fa"},children:"اسم الحساب"}),e.jsx(f,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f8f9fa"},children:"اسم المالك"}),e.jsx(f,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f8f9fa"},children:"رقم الحساب"}),e.jsx(f,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f8f9fa"},children:"رقم الايبان"}),e.jsx(f,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f8f9fa"},children:"السلف المسموح بها"}),e.jsx(f,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f8f9fa"},children:"الحالة"}),e.jsx(f,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f8f9fa"},children:"الإجراءات"})]})}),e.jsx(ce,{children:N?e.jsx(D,{children:e.jsx(f,{colSpan:5,align:"center",children:e.jsx(M,{size:20})})}):x?.data?.length===0?e.jsx(D,{children:e.jsx(f,{colSpan:8,align:"center",children:e.jsx(R,{children:"لا توجد حسابات بنكية"})})}):x?.data?.map(i=>e.jsxs(D,{hover:!0,children:[e.jsx(f,{align:"center",children:i.id}),e.jsx(f,{align:"center",children:i.name}),e.jsx(f,{align:"center",children:i.owner}),e.jsx(f,{align:"center",children:i.accountNumber}),e.jsx(f,{align:"center",children:i.IBAN}),e.jsx(f,{align:"center",children:i.limit}),e.jsx(f,{align:"center",children:e.jsx(de,{label:n.language==="ar"?i.status==="Expired"?"منتهي":i.status==="Active"?"نشط":i.status:i.status,color:i.status==="Active"?"success":i.status==="Expired"?"warning":"",variant:"outlined",sx:{fontWeight:"bold",fontSize:"12px",padding:"4px 8px",borderRadius:"16px"}})}),e.jsx(f,{align:"center",children:e.jsxs(ue,{direction:"row",spacing:1,justifyContent:"center",alignItems:"center",children:[a.includes("banks_Update")&&e.jsx(q,{size:"small",color:"primary",onClick:()=>C(i),children:e.jsx(Ne,{fontSize:"small"})}),a.includes("banks_Delete")&&e.jsx(q,{size:"small",color:"error",onClick:()=>{g(i),p(!0)},children:e.jsx(fe,{fontSize:"small"})})]})})]},i.id))})]})}),x&&e.jsx(Ce,{component:"div",count:x.total||0,page:s-1,onPageChange:u,rowsPerPage:10,rowsPerPageOptions:[10],labelDisplayedRows:({from:i,to:k,count:U})=>`عرض ${i}-${k} من ${U}`,labelRowsPerPage:"صفوف لكل صفحة:"})]}),e.jsx(pe,{open:j,onClose:()=>{p(!1),g(null)},onConfirm:()=>h(t?.id),title:"حذف الحساب البنكي",message:`هل أنت متأكد من حذف الحساب البنكي ${t?.name}؟`,ButtonText:"حذف"}),e.jsx(Pe,{open:l,onClose:v,onSuccess:W,bank:y,isEditMode:A})]})};export{He as default};
//# sourceMappingURL=Banks-CQZm1A9w.js.map
