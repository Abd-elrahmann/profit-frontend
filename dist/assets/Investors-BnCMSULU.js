import{j as e,O as de,P as xe,T as s,f as U,Q as Qe,R as pe,$ as N,B as d,a9 as re,U as ue,k as w,ae as Se,af as we,ak as le,r as u,n as P,al as Ge,m as q,o as E,A as _,ac as p,e as m,i as Ze,l as te,a as Je,W as Ve,_ as ie,H as et,I as tt,Y,C as Z,b as J,Z as ye,a0 as rt,a1 as nt,a2 as at,a3 as V,a4 as S,a5 as st,a6 as ot,ai as it,am as lt,an as ct,ao as ve}from"./index-Byloyp0V.js";import{l as dt}from"./lodash-Dqh01Uem.js";import{F as xt}from"./FormControlLabel-Fb32HuXN.js";import{D as Ce}from"./DeleteModal-Du1zPAFn.js";import{F as pt}from"./FileSaver.min-CLobENq5.js";import{A as Pe}from"./Add-JAHAPveB.js";import{S as ut}from"./Search-DKotboAf.js";import{P as Ie,C as ht}from"./Pagination-D40pr0k0.js";import{E as ft}from"./Edit-D4H7Xh5Y.js";import{S as gt}from"./Save-jijcoH0W.js";import{T as mt,a as ee}from"./Tabs-D07rxUwM.js";import"./LastPage-D5DKCjzm.js";import"./KeyboardArrowRight-nGgaUmNE.js";const bt=({open:r,onClose:x,contractHtml:g,onGeneratePDF:a,loading:b=!1,contractTitle:h="معاينة العقد"})=>e.jsxs(de,{open:r,onClose:x,maxWidth:"sm",fullScreen:!0,fullWidth:!0,dir:"rtl",PaperProps:{sx:{borderRadius:2,maxHeight:"100vh"}},children:[e.jsxs(xe,{className:"no-print",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1,borderBottom:"1px solid #e0e0e0","@media print":{display:"none !important"}},children:[e.jsx(s,{variant:"h6",fontWeight:"bold",children:h}),e.jsx(U,{onClick:x,size:"small",children:e.jsx(Qe,{})})]}),e.jsx(pe,{sx:{p:0,"@media print":{p:0,m:0}},children:e.jsx(N,{id:"contract-preview",sx:{m:3,p:4,minHeight:"500px",bgcolor:"white",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",border:"1px solid #e0e0e0","@media print":{m:0,p:2,boxShadow:"none",border:"none",minHeight:"auto"}},children:g?e.jsx(d,{dangerouslySetInnerHTML:{__html:g},sx:{"& *":{fontFamily:'"Noto Sans Arabic", "Cairo", "Segoe UI", sans-serif !important',lineHeight:1.8},"& h1, & h2, & h3":{textAlign:"center",color:"#1976d2",marginBottom:"20px"},"& p":{marginBottom:"15px",textAlign:"justify"},"& strong":{color:"#1976d2",fontWeight:"bold"}}}):e.jsxs(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px",flexDirection:"column",color:"text.secondary"},children:[e.jsx(s,{variant:"h6",mb:2,children:"لا يوجد محتوى للعرض"}),e.jsx(s,{variant:"body2",children:"يرجى التأكد من وجود قالب العقد وبيانات المستثمر"})]})})}),e.jsx(re,{className:"no-print"}),e.jsxs(ue,{className:"no-print",sx:{p:3,gap:2,flexDirection:"row-reverse",bgcolor:"#fafafa","@media print":{display:"none !important"}},children:[e.jsx(w,{onClick:x,disabled:b,variant:"outlined",sx:{minWidth:"100px",borderColor:"grey.300",color:"text.secondary","&:hover":{borderColor:"grey.400",bgcolor:"grey.50"}},children:"إغلاق"}),e.jsx(w,{variant:"outlined",startIcon:e.jsx(Se,{sx:{marginLeft:"10px"}}),onClick:()=>window.print(),disabled:b||!g,sx:{minWidth:"120px",borderColor:"#1976d2",color:"#1976d2","&:hover":{borderColor:"#1565c0",bgcolor:"#e3f2fd"}},children:"طباعة"}),e.jsx(w,{variant:"contained",startIcon:e.jsx(we,{sx:{marginLeft:"10px"}}),onClick:a,disabled:b||!g,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},minWidth:"140px"},children:b?"جاري الحفظ...":"حفظ كـ PDF"})]})]}),ce=r=>{const x=["","واحد","اثنان","ثلاثة","أربعة","خمسة","ستة","سبعة","ثمانية","تسعة"],g=["","","عشرون","ثلاثون","أربعون","خمسون","ستون","سبعون","ثمانون","تسعون"],a=["عشرة","أحد عشر","اثنا عشر","ثلاثة عشر","أربعة عشر","خمسة عشر","ستة عشر","سبعة عشر","ثمانية عشر","تسعة عشر"],b=["","مائة","مائتان","ثلاثمائة","أربعمائة","خمسمائة","ستمائة","سبعمائة","ثمانمائة","تسعمائة"];if(r===0)return"صفر";if(r<0)return"سالب "+ce(-r);let h="";if(r>=1e3){const n=Math.floor(r/1e3);n===1?h+="ألف":n===2?h+="ألفان":n<11?h+=x[n]+" آلاف":h+=ce(n)+" ألف",r%=1e3,r>0?h+=" و ":h+=" "}if(r>=100){const n=Math.floor(r/100);h+=b[n],r%=100,r>0&&(h+=" و ")}if(r>=20){const n=Math.floor(r/10),f=r%10;h+=g[n],f>0&&(h+=" و"+x[f])}else r>=10?h+=a[r-10]:r>0&&(h+=x[r]);return h.trim()},jt=()=>{const r=new Date,x=r.toLocaleDateString("ar-SA"),g=Math.floor((r.getFullYear()-622)*1.030684)+1,a=`${r.getDate()}/${r.getMonth()+1}/${g}`;return{gregorianDate:x,hijriDate:a}},yt=le.forwardRef(({investorData:r,templateContent:x,onContractGenerated:g,contractType:a="MUDARABAH"},b)=>{const[h,n]=u.useState(!1),[f,L]=u.useState(""),[T,z]=u.useState(!1),F=u.useCallback(async()=>{if(!r||!x){P("بيانات المستثمر أو قالب العقد غير متوفر");return}try{console.log("Investor Data:",r),console.log("Template Content:",x);const{gregorianDate:o,hijriDate:j}=jt(),y=ce(r.capitalAmount);console.log("Capital in words:",y),console.log("Dates:",{gregorianDate:o,hijriDate:j});let A=x.replace(/{{اسم_العميل}}/g,r.name||"").replace(/{{رقم_هوية_العميل}}/g,r.nationalId||"").replace(/{{عنوان_العميل}}/g,r.address||"").replace(/{{هاتف_العميل}}/g,r.phone||"").replace(/{{بريد_العميل}}/g,r.email||"").replace(/{{رأس_المال}}/g,r.capitalAmount?.toLocaleString("ar-SA")||"0").replace(/{{رأس_المال_كتابة}}/g,y).replace(/{{المبلغ_رقما}}/g,r.capitalAmount?.toLocaleString("ar-SA")||"0").replace(/{{المبلغ_كتابة}}/g,y).replace(/{{نسبة_أرباح_المنشأة}}/g,String(r.orgProfitPercent||"0")).replace(/{{نسبة_أرباح_المستثمر}}/g,String(r.partnerProfitPercent||"0")).replace(/{{التاريخ_الهجري}}/g,j).replace(/{{التاريخ_الميلادي}}/g,o).replace(/{{تاريخ_العقد_هجري}}/g,j).replace(/{{تاريخ_العقد_ميلادي}}/g,o).replace(/{{اسم_رب_المال}}/g,r.name||"").replace(/{{هوية_رب_المال}}/g,r.nationalId||"").replace(/{{عنوان_رب_المال}}/g,r.address||"").replace(/{{اسم_المضارب_1}}/g,"ربيش سالم ناصر الهمامي").replace(/{{هوية_المضارب_1}}/g,"1116369545").replace(/{{عنوان_المضارب_1}}/g,"المملكة العربية السعودية - شرورة").replace(/{{اسم_المضارب_2}}/g,"مبارك سالم ناصر الهمامي").replace(/{{هوية_المضارب_2}}/g,"1116369511").replace(/{{عنوان_المضارب_2}}/g,"المملكة العربية السعودية - شرورة").replace(/{{مدينة_العقد}}/g,"الرياض").replace(/{{اسم_الدائن}}/g,r.name||"").replace(/{{اسم_المدين}}/g,r.name||"").replace(/{{رقم_السند}}/g,`${Date.now()}`).replace(/{{تاريخ_الانشاء}}/g,o).replace(/{{تاريخ_الاستحقاق}}/g,o).replace(/{{مدينة_الاصدار}}/g,"الرياض").replace(/{{مدينة_الوفاء}}/g,"الرياض").replace(/{{سبب_انشاء_السند}}/g,"استثمار في المضاربة").replace(/{{قيمة_السند_رقما}}/g,r.capitalAmount?.toLocaleString()||"0").replace(/{{قيمة_السند_كتابة}}/g,y);console.log("Filled Template:",A),L(A),n(!0)}catch(o){console.error("Error generating contract:",o),P("حدث خطأ أثناء توليد العقد")}},[r,x]),D=u.useCallback(async()=>{if(!f){P("لا يوجد محتوى عقد لتحويله إلى PDF");return}z(!0);try{const o=document.getElementById("contract-preview");if(!o)throw new Error("عنصر معاينة العقد غير موجود");const j={margin:[5,5,5,5],filename:`mudarabah_contract_${Date.now()}.pdf`,image:{type:"jpeg",quality:1},html2canvas:{scale:3,useCORS:!0,letterRendering:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff"},jsPDF:{unit:"mm",format:"a4",orientation:"portrait",compress:!1,hotfixes:["px_scaling"]}},y=await Ge().from(o).set(j).outputPdf("blob");await W(y),q("تم إنشاء وحفظ العقد بنجاح"),n(!1),g&&g(y)}catch(o){console.error("Error generating PDF:",o),P("حدث خطأ أثناء إنشاء ملف PDF"),E(o)}finally{z(!1)}},[f,r,g]),W=async o=>{try{const j=new FormData;return j.append("file",o,`mudarabah_contract_${Date.now()}.pdf`),j.append("investorId",r.id),j.append("contractType",a),(await _.post(`/api/partners/upload/${r.id}`,j,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(j){throw console.error("Error uploading PDF:",j),j}};return le.useImperativeHandle(b,()=>({generateContract:F})),e.jsx(e.Fragment,{children:e.jsx(bt,{open:h,onClose:()=>n(!1),contractHtml:f,onGeneratePDF:D,loading:T,contractTitle:`معاينة عقد المضاربة - ${r?.name||""}`})})}),vt=({open:r,onClose:x,onSuccess:g})=>{const[a,b]=u.useState({name:"",nationalId:"",address:"",phone:"",email:"",orgProfitPercent:"",capitalAmount:""}),[h,n]=u.useState(!1),[f,L]=u.useState({}),[T,z]=u.useState(!0),[F,D]=u.useState(null),[W,o]=u.useState(""),j=u.useRef(null),y=i=>M=>{b(R=>({...R,[i]:M.target.value})),f[i]&&L(R=>({...R,[i]:""}))},A=()=>{const i={};return a.name.trim()||(i.name="الاسم مطلوب"),a.nationalId.trim()||(i.nationalId="رقم الهوية مطلوب"),a.address.trim()||(i.address="العنوان مطلوب"),a.phone.trim()||(i.phone="رقم الجوال مطلوب"),a.orgProfitPercent||(i.orgProfitPercent="نسبة أرباح المنشأة مطلوبة"),a.capitalAmount||(i.capitalAmount="رأس المال مطلوب"),a.nationalId&&!/^\d{14}$/.test(a.nationalId)&&(i.nationalId="رقم الهوية يجب أن يكون 14 رقمًا"),a.phone&&!/^[0-9]{10}$/.test(a.phone)&&(i.phone="رقم الجوال يجب أن يحتوي على 10 أرقام"),a.orgProfitPercent&&(a.orgProfitPercent<0||a.orgProfitPercent>100)&&(i.orgProfitPercent="النسبة يجب أن تكون بين 0 و 100"),a.capitalAmount&&a.capitalAmount<=0&&(i.capitalAmount="رأس المال يجب أن يكون أكبر من صفر"),L(i),Object.keys(i).length===0};le.useEffect(()=>{r&&T&&C()},[r,T]);const C=async()=>{try{const i=await _.get("/api/templates/mudarabah");o(i.data.content||"")}catch(i){console.warn("Could not fetch Mudarabah template:",i)}},X=async()=>{if(A()){n(!0);try{const i=await _.post("/api/partners",{...a,orgProfitPercent:parseInt(a.orgProfitPercent),capitalAmount:parseInt(a.capitalAmount)}),M={...i.data.partner,partnerProfitPercent:i.data.partnerProfitPercent||100-parseInt(a.orgProfitPercent)};q("تم إضافة المستثمر بنجاح"),T&&W?(console.log("Setting investor data for contract generation:",M),console.log("Template content length:",W.length),D(M),setTimeout(()=>{j.current?(console.log("Triggering contract generation..."),j.current.generateContract()):console.error("Contract generator ref not available")},500)):(g(),k())}catch(i){P(i.response?.data?.message||"حدث خطأ أثناء إضافة المستثمر"),E(i)}finally{n(!1)}}},ne=()=>{g(),k()},k=()=>{b({name:"",nationalId:"",address:"",phone:"",email:"",orgProfitPercent:"",capitalAmount:""}),L({}),D(null),o(""),x()};return e.jsxs(de,{open:r,onClose:k,maxWidth:"sm",fullWidth:!0,dir:"rtl",children:[e.jsx(xe,{sx:{pb:1},children:e.jsx(s,{variant:"h6",fontWeight:"bold",children:"إضافة مستثمر جديد"})}),e.jsx(re,{}),e.jsx(pe,{sx:{py:3},children:e.jsxs(d,{children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",mb:3,children:"المعلومات الشخصية"}),e.jsxs(p,{container:!0,spacing:2.5,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(m,{label:"الاسم الكامل",value:a.name,onChange:y("name"),fullWidth:!0,error:!!f.name,helperText:f.name,required:!0,size:"medium",sx:{width:"250px"}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(m,{label:"رقم الهوية الوطنية",value:a.nationalId,onChange:y("nationalId"),fullWidth:!0,error:!!f.nationalId,helperText:f.nationalId,required:!0,inputProps:{maxLength:14},size:"medium",sx:{width:"250px"}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(m,{label:"رقم الجوال",value:a.phone,onChange:y("phone"),fullWidth:!0,error:!!f.phone,helperText:f.phone,required:!0,placeholder:"05XXXXXXXX",inputProps:{maxLength:10},size:"medium",sx:{width:"250px"}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(m,{label:"البريد الإلكتروني (اختياري)",type:"email",value:a.email,onChange:y("email"),fullWidth:!0,size:"medium",sx:{width:"250px"}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(m,{label:"العنوان",value:a.address,onChange:y("address"),fullWidth:!0,error:!!f.address,helperText:f.address,required:!0,multiline:!0,rows:1,size:"medium",sx:{width:"520px"}})})]}),e.jsx(s,{variant:"subtitle1",fontWeight:"bold",mt:4,mb:3,children:"المعلومات المالية"}),e.jsxs(p,{container:!0,spacing:2.5,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(m,{label:"رأس المال (ريال)",type:"number",value:a.capitalAmount,onChange:y("capitalAmount"),fullWidth:!0,error:!!f.capitalAmount,helperText:f.capitalAmount,required:!0,InputProps:{inputProps:{min:0}},size:"medium",sx:{width:"250px"}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(m,{label:"نسبة أرباح المنشأة (%)",type:"number",value:a.orgProfitPercent,onChange:y("orgProfitPercent"),fullWidth:!0,error:!!f.orgProfitPercent,helperText:f.orgProfitPercent,required:!0,InputProps:{inputProps:{min:0,max:100}},size:"medium",sx:{width:"250px"}})})]}),e.jsx(s,{variant:"subtitle1",fontWeight:"bold",mt:4,mb:2,children:"خيارات إضافية"}),e.jsx(xt,{control:e.jsx(Ze,{checked:T,onChange:i=>z(i.target.checked),color:"primary"}),label:"توليد عقد المضاربة تلقائياً بعد الحفظ",sx:{mb:2}})]})}),e.jsx(re,{}),e.jsxs(ue,{sx:{p:2.5,gap:1,flexDirection:"row-reverse"},children:[e.jsx(w,{onClick:k,disabled:h,variant:"outlined",sx:{minWidth:"100px",borderColor:"grey.300",color:"text.secondary","&:hover":{borderColor:"grey.400",bgcolor:"grey.50"}},children:"إلغاء"}),e.jsx(w,{variant:"contained",onClick:X,disabled:h,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},minWidth:"100px"},children:h?e.jsx(te,{size:24,color:"inherit"}):"إضافة"})]}),F&&W&&e.jsx(yt,{ref:j,investorData:F,templateContent:W,onContractGenerated:ne,contractType:"MUDARABAH"})]})},Ct=async(r=1,x="",g="")=>{let a=new URLSearchParams;x.trim()&&(/^\d+$/.test(x.trim())?a.append("nationalId",x.trim()):a.append("name",x.trim())),g.trim()&&a.append("isActive",g.trim()==="نشط"?"true":"false"),a.append("limit","10");const b=a.toString(),h=`/api/partners/all/${r}${b?`?${b}`:""}`;return(await _.get(h)).data},Pt=async r=>(await _.get(`/api/partners/${r}`)).data,It=async(r,x=1)=>(await _.get(`/api/partners/transaction/${r}/${x}`)).data,St=async(r,x)=>(await _.post(`/api/partners/transaction/${r}`,x)).data,wt=async r=>(await _.delete(`/api/partners/transaction/${r}`)).data;function qt(){const[r,x]=u.useState(0),[g,a]=u.useState(""),[b,h]=u.useState(""),[n,f]=u.useState(null),[L,T]=u.useState(!1),[z,F]=u.useState(!1),[D,W]=u.useState(null),[o,j]=u.useState(!1),[y,A]=u.useState(1),[C,X]=u.useState({}),[ne,k]=u.useState(!1),[i,M]=u.useState({type:"DEPOSIT",amount:""}),[R,he]=u.useState(1),[ae,se]=u.useState(null),[Te,oe]=u.useState(!1),{permissions:O}=Je(),B=Ve(),{data:v,isLoading:fe,refetch:ge}=ie({queryKey:["investors",y,g,b],queryFn:()=>Ct(y,g,b),retry:1}),{data:l}=ie({queryKey:["investor-details",n?.id],queryFn:()=>n?Pt(n.id):null,enabled:!!n,retry:1}),{data:K,isLoading:We}=ie({queryKey:["partner-transactions",n?.id,R],queryFn:()=>n?It(n.id,R):null,enabled:!!n,retry:1}),Ae=dt.debounce(t=>{a(t),A(1)},500),_e=t=>{Ae(t.target.value)},De=(t,c)=>{A(c)},ke=(t,c)=>{he(c)},Fe=(t,c)=>{x(c)},Me=t=>{f(t),j(!1),he(1)},H=(t,c)=>{X(I=>({...I,[t]:c}))},me=(t,c)=>{M(I=>({...I,[t]:c}))},Ee=async()=>{try{const t={...C,capitalAmount:C.capitalAmount?parseInt(C.capitalAmount):void 0,orgProfitPercent:C.orgProfitPercent?parseInt(C.orgProfitPercent):void 0};await _.patch(`/api/partners/${n.id}`,t),B.invalidateQueries({queryKey:["investor-details",n.id]}),B.invalidateQueries({queryKey:["investors"]}),q("تم تحديث بيانات المستثمر بنجاح"),j(!1)}catch(t){P(t.response?.data?.message||"حدث خطأ أثناء تحديث البيانات"),E(t)}},Le=()=>{T(!0)},Re=async t=>{try{await _.delete(`/api/partners/${t}`),n?.id===t&&f(null),F(!1),W(null),await ge(),q("تم حذف المستثمر بنجاح")}catch(c){P(c.response?.data?.message||"حدث خطأ أثناء حذف المستثمر"),E(c)}},Oe=t=>{W(t),F(!0)},$e=()=>{M({type:"DEPOSIT",amount:""}),k(!0)},qe=async()=>{try{if(!i.amount||parseFloat(i.amount)<=0){P("يرجى إدخال مبلغ صحيح");return}await St(n.id,{type:i.type,amount:parseFloat(i.amount)}),B.invalidateQueries({queryKey:["partner-transactions",n.id]}),B.invalidateQueries({queryKey:["investor-details",n.id]}),q("تم إضافة العملية المالية بنجاح"),k(!1),M({type:"DEPOSIT",amount:""})}catch(t){P(t.response?.data?.message||"حدث خطأ أثناء إضافة العملية المالية"),E(t)}},ze=async t=>{try{await wt(t),B.invalidateQueries({queryKey:["partner-transactions",n.id]}),B.invalidateQueries({queryKey:["investor-details",n.id]}),q("تم حذف العملية المالية بنجاح"),oe(!1),se(null)}catch(c){P(c.response?.data?.message||"حدث خطأ أثناء حذف العملية المالية"),E(c)}},Be=t=>{se(t),oe(!0)},He=async t=>{try{const I=await(await fetch(t)).blob(),$=l.mudarabahFileUrl.split("/").pop().split(".").pop(),G=`mudarabah_${l.name}.${$}`;pt.saveAs(I,G)}catch(c){P(c.response?.data?.message||"حدث خطأ أثناء تحميل الملف"),E(c)}},Ue=async t=>{try{const I=await(await fetch(t)).blob(),Q=URL.createObjectURL(I),$=window.open(Q,"_blank");$?.addEventListener("load",()=>{$.print(),$.addEventListener("afterprint",()=>{URL.revokeObjectURL(Q)})},{once:!0})}catch(c){P(c.response?.data?.message||"حدث خطأ أثناء محاولة الطباعة"),E(c)}},Ne=async t=>{try{const I=await(await fetch(t)).blob(),$=t.split("/").pop().split(".").pop(),G=`mudarabah_${l.name}.${$}`,je=new File([I],G,{type:I.type});if(navigator.canShare&&navigator.canShare({files:[je]})){await navigator.share({title:G,text:`مشاركة عقد المضاربة للعميل: ${l.name}`,files:[je]});return}await navigator.clipboard.writeText(t),q("جهازك لا يدعم مشاركة الملفات — تم نسخ رابط الملف ✅")}catch(c){console.error("Share error:",c),P("تعذرت مشاركة الملف")}};u.useEffect(()=>{v?.partners?.length>0&&!n?f(v.partners[0]):n&&v?.partners?.length>0?v.partners.some(c=>c.id===n.id)||f(v.partners[0]):n&&(!v?.partners||v.partners.length===0)&&f(null)},[v,n]),u.useEffect(()=>{l&&X({name:l.name||"",phone:l.phone||"",address:l.address||"",email:l.email||"",orgProfitPercent:l.orgProfitPercent||"",capitalAmount:l.capitalAmount||""})},[l]);const Ke=t=>t?"success":"error",be=t=>t?"نشط":"غير نشط",Ye=t=>{switch(t){case"DEPOSIT":return"إيداع";case"WITHDRAWAL":return"سحب";default:return t}},Xe=t=>{switch(t){case"DEPOSIT":return"success";case"WITHDRAWAL":return"error";default:return"default"}};return e.jsxs(d,{sx:{bgcolor:"#f6f6f8",minHeight:"100vh"},children:[e.jsxs(et,{children:[e.jsx("title",{children:"المستثمرين"}),e.jsx("meta",{name:"description",content:"المستثمرين"})]}),e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,bgcolor:"#fff",borderBottom:"1px solid #ddd"},children:[e.jsx(d,{children:e.jsx(s,{variant:"h5",fontWeight:"bold",children:"إدارة المستثمرين"})}),e.jsx(d,{sx:{display:"flex",gap:1},children:O.includes("partners_Add")&&e.jsx(w,{variant:"contained",startIcon:e.jsx(Pe,{sx:{marginLeft:"10px"}}),onClick:Le,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},fontWeight:"bold",borderRadius:2,px:2.5,py:1},children:"إضافة مستثمر جديد"})})]}),e.jsxs(d,{sx:{display:"flex",height:"calc(100vh - 120px)"},children:[e.jsxs(d,{sx:{width:"350px",borderRight:"1px solid #ddd",bgcolor:"#fafafa",height:"100%",overflowY:"auto",flexShrink:0},children:[e.jsxs(d,{sx:{p:3,borderBottom:"1px solid #ddd",bgcolor:"#fafafa"},children:[e.jsx(m,{placeholder:"البحث بالاسم أو رقم الهوية",fullWidth:!0,size:"small",onChange:_e,InputProps:{startAdornment:e.jsx(tt,{position:"start",children:e.jsx(ut,{})})}}),e.jsxs(d,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:2},children:[e.jsx(Y,{label:"الكل",color:b===""?"primary":"default",variant:"outlined",onClick:()=>{h(""),A(1)}}),e.jsx(Y,{label:"نشط",color:b==="نشط"?"primary":"default",variant:"outlined",onClick:()=>{h(t=>t==="نشط"?"":"نشط"),A(1)}}),e.jsx(Y,{label:"غير نشط",color:b==="غير نشط"?"primary":"default",variant:"outlined",onClick:()=>{h(t=>t==="غير نشط"?"":"غير نشط"),A(1)}})]})]}),v&&!fe&&e.jsx(d,{sx:{p:2,borderBottom:"1px solid #eee",bgcolor:"#f9f9f9"},children:e.jsxs(s,{variant:"body2",color:"black",children:["صفحة ",v.currentPage," من ",v.totalPages," - إجمالي ",v.totalPartners," مستثمر"]})}),fe?e.jsx(d,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(te,{})}):v?.partners?.length===0?e.jsxs(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2,flexDirection:"column"},children:[e.jsx(s,{variant:"h6",color:"black",mb:1,children:"لا توجد مستثمرين"}),e.jsx(s,{variant:"body2",color:"black",children:g||b?"لم يتم العثور على مستثمرين مطابقين للبحث":"لا توجد مستثمرين مسجلين"})]}):v?.partners?.map(t=>{const c=n?.id===t.id;return e.jsx(Z,{onClick:()=>Me(t),sx:{mb:1,mx:2,mt:2,cursor:"pointer",height:"100px",border:c?"2px solid #1E40AF":"1px solid #E5E7EB",bgcolor:c?"#EEF2FF":"background.paper",transition:"0.2s","&:hover":{bgcolor:"#F3F4F6"}},children:e.jsxs(J,{sx:{p:2},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(s,{fontWeight:"bold",children:t.name}),e.jsx(Y,{label:be(t.isActive),size:"small",color:Ke(t.isActive)})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["رأس المال: ",t.capitalAmount?.toLocaleString()," ريال"]}),e.jsx(d,{display:"flex",justifyContent:"flex-end",mt:1,children:O.includes("partners_Delete")&&e.jsx(U,{size:"small",color:"error",onClick:I=>{I.stopPropagation(),Oe(t)},children:e.jsx(ye,{fontSize:"small"})})})]})},t.id)}),v&&v.totalPages>1&&e.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2,gap:2,borderTop:"1px solid #eee"},children:e.jsx(Ie,{count:v.totalPages,page:y,onChange:De,color:"primary",size:"small",siblingCount:1,boundaryCount:1,sx:{"& .MuiPaginationItem-root":{fontSize:"0.875rem"}}})})]}),n&&l?e.jsxs(d,{sx:{flex:1,p:4,bgcolor:"#fff",overflowY:"auto"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(d,{children:[e.jsx(s,{variant:"h6",fontWeight:"bold",children:l.name}),e.jsxs(s,{color:"text.secondary",children:["رقم الهوية: ",l.nationalId]})]}),e.jsxs(d,{sx:{display:"flex",gap:2},children:[O.includes("partners_Update")&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(ft,{sx:{marginLeft:"10px"}}),onClick:()=>j(!o),children:o?"إلغاء التعديل":"تعديل"}),O.includes("partners_Add")&&e.jsx(w,{variant:"contained",startIcon:e.jsx(gt,{sx:{marginLeft:"10px"}}),sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"}},disabled:!o,onClick:Ee,children:"حفظ التغييرات"})]})]}),e.jsxs(p,{container:!0,spacing:2,mb:3,sx:{width:"100%"},children:[e.jsx(p,{item:!0,xs:12,md:4,children:e.jsx(Z,{sx:{width:"250px"},children:e.jsxs(J,{children:[e.jsx(s,{color:"text.secondary",variant:"body1",children:"إجمالي مبلغ الاستثمار"}),e.jsxs(s,{variant:"h6",fontWeight:"bold",color:"success",children:[l.capitalAmount?.toLocaleString()," ريال"]})]})})}),e.jsx(p,{item:!0,xs:12,md:4,children:e.jsx(Z,{sx:{width:"250px"},children:e.jsxs(J,{children:[e.jsx(s,{color:"text.secondary",variant:"body1",children:"نسبة أرباح المنشأة"}),e.jsxs(s,{variant:"h6",fontWeight:"bold",children:[l.orgProfitPercent,"%"]})]})})}),e.jsx(p,{item:!0,xs:12,md:4,children:e.jsx(Z,{sx:{width:"250px"},children:e.jsxs(J,{children:[e.jsx(s,{color:"text.secondary",variant:"body1",children:"نسبة أرباح المستثمر"}),e.jsxs(s,{variant:"h6",fontWeight:"bold",children:[l.partnerProfitPercent,"%"]})]})})})]}),e.jsxs(mt,{value:r,onChange:Fe,textColor:"primary",indicatorColor:"primary",sx:{mb:3},children:[e.jsx(ee,{label:"التفاصيل الشخصية"}),e.jsx(ee,{label:"المعلومات المالية"}),e.jsx(ee,{label:"العمليات المالية"}),e.jsx(ee,{label:"المستندات"})]}),e.jsx(re,{sx:{mb:3}}),r===0&&e.jsx(d,{children:e.jsxs(N,{sx:{p:3,mb:3},children:[e.jsx(s,{variant:"h6",mb:3,children:"المعلومات الشخصية"}),e.jsxs(p,{container:!0,spacing:3,children:[e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"الاسم الكامل"}),e.jsx(m,{value:o?C.name:l.name,onChange:t=>H("name",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"البريد الإلكتروني"}),e.jsx(m,{value:o?C.email:l.email||"لا يوجد بريد إلكتروني",onChange:t=>H("email",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"رقم الهوية الوطنية"}),e.jsx(m,{value:l.nationalId,fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"رقم الجوال"}),e.jsx(m,{value:o?C.phone:l.phone,onChange:t=>H("phone",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(p,{item:!0,xs:12,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"العنوان"}),e.jsx(m,{value:o?C.address:l.address,onChange:t=>H("address",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"تاريخ الانضمام"}),e.jsx(m,{value:l.createdAt?new Date(l.createdAt).toLocaleDateString("en-US"):"",fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"الحالة"}),e.jsx(m,{value:be(l.isActive),fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]})]})]})}),r===1&&e.jsxs(N,{sx:{p:3},children:[e.jsx(s,{variant:"h6",mb:3,children:"المعلومات المالية"}),e.jsxs(p,{container:!0,spacing:3,children:[e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"رأس المال"}),e.jsx(m,{value:o?C.capitalAmount:l.capitalAmount?.toLocaleString(),onChange:t=>H("capitalAmount",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"نسبة أرباح المنشأة"}),e.jsx(m,{value:o?C.orgProfitPercent:l.orgProfitPercent,onChange:t=>H("orgProfitPercent",t.target.value),fullWidth:!0,disabled:!o,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o?"#fff":"#f9fafb",borderRadius:"6px","&:hover fieldset":{borderColor:"#0d40a5"}}}})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"نسبة أرباح المستثمر"}),e.jsx(m,{value:l.partnerProfitPercent,fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"حساب رأس المال"}),e.jsx(m,{value:l.AccountEquity?.name,fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",mb:1,fontWeight:500,children:"حساب المستحقات"}),e.jsx(m,{value:l.AccountPayable?.name,fullWidth:!0,disabled:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f9fafb",borderRadius:"6px"}}})]})]})]}),r===2&&e.jsxs(d,{children:[e.jsx(d,{sx:{mb:3,display:"flex",justifyContent:"flex-end"},children:O.includes("partners_Add")&&e.jsx(w,{variant:"contained",startIcon:e.jsx(Pe,{sx:{marginLeft:"10px"}}),onClick:$e,sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"},fontWeight:"bold"},children:"إضافة عملية مالية"})}),e.jsxs(N,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(rt,{children:e.jsxs(nt,{stickyHeader:!0,children:[e.jsx(at,{sx:{bgcolor:"#F3F4F6"},children:e.jsxs(V,{children:[e.jsx(S,{align:"center",sx:{fontWeight:"bold"},children:"رقم المرجع"}),e.jsx(S,{align:"center",sx:{fontWeight:"bold"},children:"نوع العملية"}),e.jsx(S,{align:"center",sx:{fontWeight:"bold"},children:"المبلغ"}),e.jsx(S,{align:"center",sx:{fontWeight:"bold"},children:"التاريخ"}),e.jsx(S,{align:"center",sx:{fontWeight:"bold"},children:"الإجراءات"})]})}),e.jsx(st,{children:We?e.jsx(V,{children:e.jsx(S,{colSpan:5,align:"center",children:e.jsx(te,{size:20})})}):K?.transactions?.length===0?e.jsx(V,{children:e.jsx(S,{colSpan:5,align:"center",children:e.jsx(s,{children:"لا توجد عمليات مالية"})})}):K?.transactions?.map(t=>e.jsxs(V,{hover:!0,children:[e.jsx(S,{align:"center",children:t.reference}),e.jsx(S,{align:"center",children:e.jsx(Y,{label:Ye(t.type),color:Xe(t.type),size:"small"})}),e.jsxs(S,{align:"center",sx:{color:t.type==="DEPOSIT"?"success.main":"error.main",fontWeight:"bold"},children:[t.amount?.toLocaleString()," ريال"]}),e.jsx(S,{align:"center",children:ot(t.date).format("DD/MM/YYYY HH:mm a")}),e.jsx(S,{align:"center",children:O.includes("partners_Delete")&&e.jsx(U,{color:"error",size:"small",onClick:()=>Be(t),children:e.jsx(ye,{fontSize:"small"})})})]},t.id))})]})}),K&&K.totalPages>1&&e.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2,borderTop:"1px solid #eee"},children:e.jsx(Ie,{count:K.totalPages,page:R,onChange:ke,color:"primary",size:"small",siblingCount:1,boundaryCount:1})})]})]}),r===3&&e.jsx(d,{children:e.jsxs(d,{sx:{mb:4},children:[e.jsx(s,{variant:"h6",sx:{mb:2},children:"المستندات المرفوعة"}),l.mudarabahFileUrl?e.jsx(p,{container:!0,spacing:2,children:e.jsx(p,{item:!0,xs:12,children:e.jsxs(N,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ht,{color:"success",fontSize:"small"}),e.jsx(d,{children:e.jsx(s,{fontWeight:"500",children:"عقد المضاربة"})})]}),e.jsxs(d,{children:[e.jsx(U,{onClick:()=>Ue(l.mudarabahFileUrl),children:e.jsx(Se,{})}),e.jsx(U,{onClick:()=>He(l.mudarabahFileUrl),title:"تحميل",children:e.jsx(we,{})}),e.jsx(U,{onClick:()=>Ne(l.mudarabahFileUrl),title:"مشاركة",children:e.jsx(it,{})})]})]})})}):e.jsx(N,{sx:{p:3,textAlign:"center",mb:3},children:e.jsx(s,{color:"text.secondary",children:"لا توجد مستندات مرفوعة"})})]})})]}):e.jsxs(d,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:2},children:[e.jsx(s,{variant:"h6",color:"text.secondary",children:n?"جاري تحميل البيانات...":"اختر مستثمراً لعرض التفاصيل"}),n&&e.jsx(te,{size:40})]})]}),e.jsx(vt,{open:L,onClose:()=>T(!1),onSuccess:()=>{T(!1),ge()}}),e.jsx(Ce,{open:z,onClose:()=>{F(!1),W(null)},onConfirm:()=>{D?.id?(console.log("Delete button clicked, investor ID:",D.id),Re(D.id)):console.error("No investor ID found for deletion")},title:"حذف المستثمر",message:`هل أنت متأكد من حذف المستثمر ${D?.name}؟`,ButtonText:"حذف"}),e.jsxs(de,{open:ne,onClose:()=>k(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(xe,{children:e.jsx(s,{variant:"h6",fontWeight:"bold",children:"إضافة عملية مالية"})}),e.jsx(pe,{children:e.jsxs(lt,{spacing:3,sx:{mt:2},children:[e.jsx(ct,{fullWidth:!0,size:"small",children:e.jsxs(m,{select:!0,label:"نوع العملية",value:i.type,onChange:t=>me("type",t.target.value),children:[e.jsx(ve,{value:"DEPOSIT",children:"إيداع"}),e.jsx(ve,{value:"WITHDRAWAL",children:"سحب"})]})}),e.jsx(m,{label:"المبلغ",type:"number",value:i.amount,onChange:t=>me("amount",t.target.value),fullWidth:!0})]})}),e.jsxs(ue,{sx:{p:3,flexDirection:"row-reverse"},children:[e.jsx(w,{onClick:()=>k(!1),color:"inherit",children:"إلغاء"}),O.includes("partners_Add")&&e.jsx(w,{onClick:qe,variant:"contained",sx:{bgcolor:"#0d40a5","&:hover":{bgcolor:"#0b3589"}},children:"حفظ"})]})]}),e.jsx(Ce,{open:Te,onClose:()=>{oe(!1),se(null)},onConfirm:()=>{ae?.id&&ze(ae.id)},title:"حذف العملية المالية",message:`هل أنت متأكد من حذف العملية المالية برقم المرجع ${ae?.reference}؟`,ButtonText:"حذف"})]})}export{qt as default};
//# sourceMappingURL=Investors-BnCMSULU.js.map
